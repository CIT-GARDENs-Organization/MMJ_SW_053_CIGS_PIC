CCS PCM C Compiler, Version 5.104, 57077               01-6-25 17:42

               Filename:   build\mmj_cigs_main.lst

               ROM used:   5108 words (31%)
                           Largest free fragment is 2048
               RAM used:   1305 (64%) at main() level
                           1381 (67%) worst case
               Stack used: 5 locations (4 in main + 1 for interrupts)
               Stack size: 16

*
0000:  MOVLP  10
0001:  GOTO   397
0002:  NOP
*
0004:  CLRF   03
0005:  MOVLP  00
0006:  MOVLB  00
0007:  MOVF   77,W
0008:  MOVWF  20
0009:  MOVF   78,W
000A:  MOVWF  21
000B:  MOVF   79,W
000C:  MOVWF  22
000D:  MOVF   7A,W
000E:  MOVWF  23
000F:  MOVLB  03
0010:  MOVF   11,W
0011:  MOVLB  00
0012:  MOVWF  24
0013:  MOVLB  03
0014:  MOVF   12,W
0015:  MOVLB  00
0016:  MOVWF  25
0017:  MOVLB  03
0018:  MOVF   13,W
0019:  MOVLB  00
001A:  MOVWF  26
001B:  MOVLB  03
001C:  MOVF   14,W
001D:  MOVLB  00
001E:  MOVWF  27
001F:  BTFSS  0B.5
0020:  GOTO   023
0021:  BTFSC  0B.2
0022:  GOTO   043
0023:  CLRF   05
0024:  MOVLW  91
0025:  MOVWF  04
0026:  BTFSS  00.5
0027:  GOTO   02A
0028:  BTFSC  11.5
0029:  GOTO   045
002A:  MOVF   20,W
002B:  MOVWF  77
002C:  MOVF   21,W
002D:  MOVWF  78
002E:  MOVF   22,W
002F:  MOVWF  79
0030:  MOVF   23,W
0031:  MOVWF  7A
0032:  MOVF   24,W
0033:  MOVLB  03
0034:  MOVWF  11
0035:  MOVLB  00
0036:  MOVF   25,W
0037:  MOVLB  03
0038:  MOVWF  12
0039:  MOVLB  00
003A:  MOVF   26,W
003B:  MOVLB  03
003C:  MOVWF  13
003D:  MOVLB  00
003E:  MOVF   27,W
003F:  MOVLB  03
0040:  MOVWF  14
0041:  RETFIE
0042:  MOVLB  00
0043:  MOVLP  00
0044:  GOTO   047
0045:  MOVLP  00
0046:  GOTO   09D
.................... #include "include/mmj_cigs_main.h"
.................... #ifndef MMJ_CIGS_MAIN_H
.................... #define MMJ_CIGS_MAIN_H
.................... 
.................... 
.................... 
.................... // pin assignment etc
.................... #include "mmj_cigs_config.h"
.................... #ifndef MMJ_CIGS_CONFIG_H
.................... #define MMJ_CIGS_CONFIG_H
.................... 
.................... #include <16F1789.h>
.................... //////////// Standard Header file for the PIC16F1789 device ////////////////
.................... ///////////////////////////////////////////////////////////////////////////
.................... ////        (C) Copyright 1996, 2020 Custom Computer Services          ////
.................... //// This source code may only be used by licensed users of the CCS C  ////
.................... //// compiler.  This source code may only be distributed to other      ////
.................... //// licensed users of the CCS C compiler.  No other use, reproduction ////
.................... //// or distribution is permitted without written permission.          ////
.................... //// Derivative programs created using this software in object code    ////
.................... //// form are not restricted in any way.                               ////
.................... ///////////////////////////////////////////////////////////////////////////
.................... #device PIC16F1789
*
008D:  DATA D4,34
008E:  DATA ED,32
008F:  DATA 72,10
0090:  DATA 49,37
0091:  DATA 69,3A
0092:  DATA E9,30
0093:  DATA EC,34
0094:  DATA FA,32
0095:  DATA 0D,05
0096:  DATA 00,00
0097:  DATA 89,21
0098:  DATA EF,36
0099:  DATA 70,36
009A:  DATA 65,3A
009B:  DATA E5,06
009C:  DATA 0A,00
*
00BD:  DATA D5,20
00BE:  DATA 52,2A
00BF:  DATA A0,24
00C0:  DATA EE,34
00C1:  DATA F4,34
00C2:  DATA 61,36
00C3:  DATA 69,3D
00C4:  DATA E5,06
00C5:  DATA 0A,00
00C6:  DATA 89,21
00C7:  DATA EF,36
00C8:  DATA 70,36
00C9:  DATA 65,3A
00CA:  DATA E5,06
00CB:  DATA 0A,00
00CC:  DATA C9,27
00CD:  DATA A0,24
00CE:  DATA EE,34
00CF:  DATA F4,34
00D0:  DATA 61,36
00D1:  DATA 69,3D
00D2:  DATA E5,06
00D3:  DATA 0A,00
00D4:  DATA 89,21
00D5:  DATA EF,36
00D6:  DATA 70,36
00D7:  DATA 65,3A
00D8:  DATA E5,06
00D9:  DATA 0A,00
00DA:  DATA 41,22
00DB:  DATA 43,10
00DC:  DATA 49,37
00DD:  DATA 69,3A
00DE:  DATA E9,30
00DF:  DATA EC,34
00E0:  DATA FA,32
00E1:  DATA 0D,05
00E2:  DATA 00,01
00E3:  DATA 89,21
00E4:  DATA EF,36
00E5:  DATA 70,36
00E6:  DATA 65,3A
00E7:  DATA E5,06
00E8:  DATA 0A,00
00E9:  DATA 53,3A
00EA:  DATA 61,39
00EB:  DATA 74,10
00EC:  DATA D3,2B
00ED:  DATA C5,22
00EE:  DATA D0,06
00EF:  DATA 0A,00
00F0:  DATA 89,29
00F1:  DATA F7,32
00F2:  DATA 65,38
00F3:  DATA A0,39
00F4:  DATA F4,32
00F5:  DATA 70,10
00F6:  DATA 3A,10
00F7:  DATA A5,3A
00F8:  DATA 0D,05
00F9:  DATA 00,00
00FA:  DATA 45,27
00FB:  DATA 44,10
00FC:  DATA D3,2B
00FD:  DATA C5,22
00FE:  DATA D0,06
00FF:  DATA 0A,00
0100:  DATA CC,37
0101:  DATA E7,33
0102:  DATA 65,32
0103:  DATA A0,21
0104:  DATA C9,23
0105:  DATA 53,10
0106:  DATA E4,30
0107:  DATA F4,30
0108:  DATA 0D,05
0109:  DATA 80,00
010A:  DATA D3,26
010B:  DATA 46,10
010C:  DATA E4,30
010D:  DATA F4,30
010E:  DATA 20,36
010F:  DATA E9,39
0110:  DATA 74,10
0111:  DATA E9,39
0112:  DATA 20,33
0113:  DATA 75,36
0114:  DATA EC,10
0115:  DATA A1,10
0116:  DATA 0D,05
0117:  DATA 00,00
0118:  DATA D3,26
0119:  DATA 46,10
011A:  DATA E4,30
011B:  DATA F4,30
011C:  DATA 20,36
011D:  DATA E9,39
011E:  DATA 74,10
011F:  DATA E9,39
0120:  DATA A0,32
0121:  DATA 6D,38
0122:  DATA F4,3C
0123:  DATA 0D,05
0124:  DATA 00,00
0125:  DATA 0D,05
0126:  DATA 09,1E
0127:  DATA 2D,00
0128:  DATA 66,36
0129:  DATA E1,39
012A:  DATA 68,10
012B:  DATA E2,3A
012C:  DATA F3,3C
012D:  DATA 0D,05
012E:  DATA 00,00
012F:  DATA 09,29
0130:  DATA E5,30
0131:  DATA 64,10
0132:  DATA 49,22
0133:  DATA 3A,00
0134:  DATA 09,33
0135:  DATA EC,30
0136:  DATA 73,34
0137:  DATA A0,31
0138:  DATA 6F,37
0139:  DATA EE,32
013A:  DATA 63,3A
013B:  DATA A0,27
013C:  DATA CB,06
013D:  DATA 0A,00
013E:  DATA 09,33
013F:  DATA EC,30
0140:  DATA 73,34
0141:  DATA 20,37
0142:  DATA 6F,3A
0143:  DATA A0,31
0144:  DATA 6F,37
0145:  DATA EE,32
0146:  DATA 63,3A
0147:  DATA 0D,05
0148:  DATA 00,00
0149:  DATA 65,39
014A:  DATA F2,37
014B:  DATA 72,1D
014C:  DATA 66,36
014D:  DATA E1,39
014E:  DATA 68,10
014F:  DATA ED,37
0150:  DATA E4,32
0151:  DATA 6C,10
0152:  DATA E9,39
0153:  DATA A0,34
0154:  DATA 6E,3B
0155:  DATA 61,36
0156:  DATA 69,32
0157:  DATA 0D,05
0158:  DATA 00,01
0159:  DATA 66,36
015A:  DATA E1,39
015B:  DATA 68,10
015C:  DATA F4,34
015D:  DATA ED,32
015E:  DATA EF,3A
015F:  DATA F4,06
0160:  DATA 0A,00
0161:  DATA 66,36
0162:  DATA E1,39
0163:  DATA 68,10
0164:  DATA F3,32
0165:  DATA 63,3A
0166:  DATA 6F,39
0167:  DATA A0,32
0168:  DATA F2,30
0169:  DATA F3,32
016A:  DATA A0,31
016B:  DATA EF,36
016C:  DATA 70,36
016D:  DATA 65,3A
016E:  DATA E5,06
016F:  DATA 0A,00
0170:  DATA 65,39
0171:  DATA F2,37
0172:  DATA 72,1D
0173:  DATA 66,36
0174:  DATA E1,39
0175:  DATA 68,10
0176:  DATA ED,37
0177:  DATA E4,32
0178:  DATA 6C,10
0179:  DATA E9,39
017A:  DATA A0,34
017B:  DATA 6E,3B
017C:  DATA 61,36
017D:  DATA 69,32
017E:  DATA 0D,05
017F:  DATA 00,01
0180:  DATA 66,36
0181:  DATA E1,39
0182:  DATA 68,10
0183:  DATA F4,34
0184:  DATA ED,32
0185:  DATA EF,3A
0186:  DATA F4,06
0187:  DATA 0A,00
0188:  DATA 66,36
0189:  DATA E1,39
018A:  DATA 68,10
018B:  DATA 33,19
018C:  DATA 6B,21
018D:  DATA 79,3A
018E:  DATA 65,10
018F:  DATA F3,3A
0190:  DATA E2,39
0191:  DATA E5,31
0192:  DATA F4,37
0193:  DATA 72,10
0194:  DATA 65,39
0195:  DATA E1,39
0196:  DATA 65,10
0197:  DATA E3,37
0198:  DATA 6D,38
0199:  DATA EC,32
019A:  DATA F4,32
019B:  DATA 0D,05
019C:  DATA 00,00
019D:  DATA 65,39
019E:  DATA F2,37
019F:  DATA 72,1D
01A0:  DATA 66,36
01A1:  DATA E1,39
01A2:  DATA 68,10
01A3:  DATA ED,37
01A4:  DATA E4,32
01A5:  DATA 6C,10
01A6:  DATA E9,39
01A7:  DATA A0,34
01A8:  DATA 6E,3B
01A9:  DATA 61,36
01AA:  DATA 69,32
01AB:  DATA 0D,05
01AC:  DATA 00,01
01AD:  DATA 66,36
01AE:  DATA E1,39
01AF:  DATA 68,10
01B0:  DATA F4,34
01B1:  DATA ED,32
01B2:  DATA EF,3A
01B3:  DATA F4,06
01B4:  DATA 0A,00
01B5:  DATA 66,36
01B6:  DATA E1,39
01B7:  DATA 68,10
01B8:  DATA B4,35
01B9:  DATA C2,3C
01BA:  DATA F4,32
01BB:  DATA A0,39
01BC:  DATA 75,31
01BD:  DATA F3,32
01BE:  DATA 63,3A
01BF:  DATA 6F,39
01C0:  DATA A0,32
01C1:  DATA F2,30
01C2:  DATA F3,32
01C3:  DATA A0,31
01C4:  DATA EF,36
01C5:  DATA 70,36
01C6:  DATA 65,3A
01C7:  DATA E5,06
01C8:  DATA 0A,00
01C9:  DATA 66,36
01CA:  DATA E1,39
01CB:  DATA 68,10
01CC:  DATA F4,34
01CD:  DATA ED,32
01CE:  DATA EF,3A
01CF:  DATA F4,06
01D0:  DATA 0A,00
01D1:  DATA 66,36
01D2:  DATA E1,39
01D3:  DATA 68,10
01D4:  DATA 77,39
01D5:  DATA 69,3A
01D6:  DATA 65,10
01D7:  DATA E3,37
01D8:  DATA 6D,38
01D9:  DATA EC,32
01DA:  DATA F4,32
01DB:  DATA 0D,05
01DC:  DATA 00,00
01DD:  DATA 66,36
01DE:  DATA E1,39
01DF:  DATA 68,10
01E0:  DATA F4,34
01E1:  DATA ED,32
01E2:  DATA EF,3A
01E3:  DATA F4,06
01E4:  DATA 0A,00
01E5:  DATA 66,36
01E6:  DATA E1,39
01E7:  DATA 68,10
01E8:  DATA 77,39
01E9:  DATA 69,3A
01EA:  DATA 65,10
01EB:  DATA E3,37
01EC:  DATA 6D,38
01ED:  DATA EC,32
01EE:  DATA F4,32
01EF:  DATA 0D,05
01F0:  DATA 00,00
01F1:  DATA 53,3A
01F2:  DATA 61,39
01F3:  DATA 74,10
01F4:  DATA ED,30
01F5:  DATA EB,32
01F6:  DATA 5F,39
01F7:  DATA E5,31
01F8:  DATA E5,34
01F9:  DATA F6,32
01FA:  DATA DF,31
01FB:  DATA EF,36
01FC:  DATA ED,30
01FD:  DATA 6E,32
01FE:  DATA 0D,05
01FF:  DATA 89,16
0200:  DATA 3E,10
0201:  DATA 00,01
0202:  DATA 45,37
0203:  DATA 64,10
0204:  DATA ED,30
0205:  DATA EB,32
0206:  DATA 5F,39
0207:  DATA E5,31
0208:  DATA 69,3B
0209:  DATA E5,2F
020A:  DATA E3,37
020B:  DATA ED,36
020C:  DATA 61,37
020D:  DATA E4,06
020E:  DATA 8A,06
020F:  DATA 0A,00
0210:  DATA F3,34
0211:  DATA 67,37
0212:  DATA 61,36
0213:  DATA A0,32
0214:  DATA 6E,32
0215:  DATA A0,3B
0216:  DATA 69,3A
0217:  DATA 68,10
0218:  DATA 53,23
0219:  DATA C4,06
021A:  DATA 0A,00
021B:  DATA E4,37
021C:  DATA EE,13
021D:  DATA 74,10
021E:  DATA E6,34
021F:  DATA 6E,32
0220:  DATA A0,29
0221:  DATA 46,22
0222:  DATA 0D,05
0223:  DATA 00,00
0224:  DATA 89,16
0225:  DATA 3E,10
0226:  DATA 49,37
0227:  DATA F6,30
0228:  DATA EC,34
0229:  DATA 64,10
022A:  DATA 46,39
022B:  DATA E1,36
022C:  DATA 65,10
022D:  DATA 49,22
022E:  DATA 20,39
022F:  DATA E5,31
0230:  DATA E5,34
0231:  DATA F6,32
0232:  DATA 64,1D
0233:  DATA A0,12
0234:  DATA D8,06
0235:  DATA 0A,00
0236:  DATA 89,16
0237:  DATA 3E,10
0238:  DATA 43,29
0239:  DATA 43,10
023A:  DATA 65,39
023B:  DATA F2,37
023C:  DATA F2,10
023D:  DATA 0D,05
023E:  DATA 00,01
023F:  DATA 89,04
0240:  DATA 2D,1F
0241:  DATA 20,39
0242:  DATA E5,31
0243:  DATA E5,34
0244:  DATA F6,32
0245:  DATA 64,10
0246:  DATA 43,29
0247:  DATA 43,1D
0248:  DATA A0,12
0249:  DATA D8,06
024A:  DATA 0A,00
024B:  DATA 89,04
024C:  DATA 20,10
024D:  DATA A0,31
024E:  DATA 6F,36
024F:  DATA EC,32
0250:  DATA 63,3A
0251:  DATA A0,21
0252:  DATA D2,21
0253:  DATA 20,1D
0254:  DATA A0,12
0255:  DATA D8,06
0256:  DATA 0A,00
0257:  DATA 89,16
0258:  DATA 3E,10
0259:  DATA 49,37
025A:  DATA F6,30
025B:  DATA EC,34
025C:  DATA 64,10
025D:  DATA E4,32
025E:  DATA F6,34
025F:  DATA E3,32
0260:  DATA A0,24
0261:  DATA 44,10
0262:  DATA F2,32
0263:  DATA E3,32
0264:  DATA 69,3B
0265:  DATA 65,32
0266:  DATA 0D,05
0267:  DATA 00,01
0268:  DATA 89,04
0269:  DATA 2D,1F
026A:  DATA 20,39
026B:  DATA E5,31
026C:  DATA E5,34
026D:  DATA F6,32
026E:  DATA 64,1D
026F:  DATA 20,10
0270:  DATA 20,10
0271:  DATA A0,12
0272:  DATA D8,06
0273:  DATA 0A,00
0274:  DATA 89,04
0275:  DATA 20,10
0276:  DATA A0,26
0277:  DATA 79,10
0278:  DATA E4,32
0279:  DATA F6,34
027A:  DATA E3,32
027B:  DATA A0,24
027C:  DATA 44,1D
027D:  DATA A0,12
027E:  DATA D8,06
027F:  DATA 0A,00
0280:  DATA 54,39
0281:  DATA 61,37
0282:  DATA F3,34
0283:  DATA 74,10
0284:  DATA E3,37
0285:  DATA ED,36
0286:  DATA 61,37
0287:  DATA E4,06
0288:  DATA 8A,04
0289:  DATA 2D,1F
028A:  DATA 20,00
028B:  DATA A1,10
028C:  DATA A1,37
028D:  DATA F6,32
028E:  DATA 72,33
028F:  DATA EC,37
0290:  DATA 77,10
0291:  DATA 65,3C
0292:  DATA E5,31
0293:  DATA 75,3A
0294:  DATA 65,32
0295:  DATA DF,36
0296:  DATA E9,39
0297:  DATA F3,34
0298:  DATA 6F,37
0299:  DATA 20,36
029A:  DATA E9,39
029B:  DATA F4,06
029C:  DATA 0A,00
029D:  DATA 53,3A
029E:  DATA 61,39
029F:  DATA 74,10
02A0:  DATA D3,26
02A1:  DATA 46,10
02A2:  DATA F5,39
02A3:  DATA 69,37
02A4:  DATA 67,10
02A5:  DATA F2,32
02A6:  DATA F1,32
02A7:  DATA 73,3A
02A8:  DATA A0,39
02A9:  DATA E5,30
02AA:  DATA F1,3A
02AB:  DATA 65,37
02AC:  DATA E3,32
02AD:  DATA 0D,05
02AE:  DATA 00,01
02AF:  DATA 45,39
02B0:  DATA F2,37
02B1:  DATA F2,10
02B2:  DATA 20,29
02B3:  DATA E5,31
02B4:  DATA E5,34
02B5:  DATA F6,34
02B6:  DATA EE,33
02B7:  DATA A0,31
02B8:  DATA EF,36
02B9:  DATA ED,30
02BA:  DATA 6E,32
02BB:  DATA A0,34
02BC:  DATA EE,31
02BD:  DATA 6F,37
02BE:  DATA F3,34
02BF:  DATA 73,3A
02C0:  DATA 65,37
02C1:  DATA 74,10
02C2:  DATA F7,34
02C3:  DATA 74,34
02C4:  DATA 20,3A
02C5:  DATA E8,32
02C6:  DATA 20,32
02C7:  DATA E5,39
02C8:  DATA E9,33
02C9:  DATA EE,06
02CA:  DATA 0A,00
02CB:  DATA D3,26
02CC:  DATA 46,10
02CD:  DATA F5,39
02CE:  DATA 65,10
02CF:  DATA F2,32
02D0:  DATA F1,3A
02D1:  DATA E5,39
02D2:  DATA 74,10
02D3:  DATA 61,36
02D4:  DATA EC,37
02D5:  DATA F7,32
02D6:  DATA E4,06
02D7:  DATA 0A,00
02D8:  DATA D3,26
02D9:  DATA 46,10
02DA:  DATA F5,39
02DB:  DATA 65,10
02DC:  DATA F2,32
02DD:  DATA F1,3A
02DE:  DATA E5,39
02DF:  DATA 74,10
02E0:  DATA E4,32
02E1:  DATA EE,3C
02E2:  DATA 65,32
02E3:  DATA 0D,05
02E4:  DATA 00,01
02E5:  DATA D2,32
02E6:  DATA 74,39
02E7:  DATA 79,10
02E8:  DATA F2,32
02E9:  DATA F1,3A
02EA:  DATA E5,39
02EB:  DATA 74,10
02EC:  DATA F4,37
02ED:  DATA 20,21
02EE:  DATA CF,29
02EF:  DATA 53,10
02F0:  DATA D0,24
02F1:  DATA C3,06
02F2:  DATA 0A,00
02F3:  DATA 45,39
02F4:  DATA F2,37
02F5:  DATA F2,10
02F6:  DATA 20,29
02F7:  DATA E5,31
02F8:  DATA E5,34
02F9:  DATA F6,34
02FA:  DATA EE,33
02FB:  DATA A0,31
02FC:  DATA EF,36
02FD:  DATA ED,30
02FE:  DATA 6E,32
02FF:  DATA A0,34
0300:  DATA EE,31
0301:  DATA 6F,37
0302:  DATA F3,34
0303:  DATA 73,3A
0304:  DATA 65,37
0305:  DATA 74,10
0306:  DATA F7,34
0307:  DATA 74,34
0308:  DATA 20,3A
0309:  DATA E8,32
030A:  DATA 20,32
030B:  DATA E5,39
030C:  DATA E9,33
030D:  DATA EE,06
030E:  DATA 0A,00
030F:  DATA 45,37
0310:  DATA 64,10
0311:  DATA D3,26
0312:  DATA 46,10
0313:  DATA F5,39
0314:  DATA 69,37
0315:  DATA 67,10
0316:  DATA F2,32
0317:  DATA F1,32
0318:  DATA 73,3A
0319:  DATA A0,39
031A:  DATA E5,30
031B:  DATA F1,3A
031C:  DATA 65,37
031D:  DATA E3,32
031E:  DATA 0D,05
031F:  DATA 00,00
0320:  DATA 53,3A
0321:  DATA 61,39
0322:  DATA 74,10
0323:  DATA CD,27
0324:  DATA C4,22
0325:  DATA A0,26
0326:  DATA C5,20
0327:  DATA D3,2A
0328:  DATA D2,22
0329:  DATA 0D,05
032A:  DATA 00,00
032B:  DATA 53,3A
032C:  DATA 61,39
032D:  DATA 74,10
032E:  DATA CD,27
032F:  DATA C4,22
0330:  DATA A0,26
0331:  DATA C5,20
0332:  DATA D3,2A
0333:  DATA D2,22
0334:  DATA 20,2B
0335:  DATA 6F,36
0336:  DATA F4,30
0337:  DATA E7,32
0338:  DATA 0D,05
0339:  DATA 00,00
033A:  DATA F4,32
033B:  DATA 6D,38
033C:  DATA 5F,3A
033D:  DATA 6F,38
033E:  DATA 3A,10
033F:  DATA 25,2C
0340:  DATA 0D,05
0341:  DATA 00,01
0342:  DATA F4,32
0343:  DATA 6D,38
0344:  DATA 5F,31
0345:  DATA 6F,3A
0346:  DATA 3A,10
0347:  DATA 25,2C
0348:  DATA 0D,05
0349:  DATA 00,00
034A:  DATA 70,32
034B:  DATA 5F,3B
034C:  DATA 61,36
034D:  DATA F5,32
034E:  DATA 3A,10
034F:  DATA 25,2C
0350:  DATA 0D,05
0351:  DATA 00,00
0352:  DATA E3,34
0353:  DATA E7,39
0354:  DATA 5F,3B
0355:  DATA 61,36
0356:  DATA F5,32
0357:  DATA 3A,10
0358:  DATA 25,2C
0359:  DATA 0D,05
035A:  DATA 00,00
035B:  DATA E3,3A
035C:  DATA 72,39
035D:  DATA 65,37
035E:  DATA F4,2F
035F:  DATA F6,30
0360:  DATA EC,3A
0361:  DATA 65,1D
0362:  DATA A0,12
0363:  DATA D8,06
0364:  DATA 0A,00
0365:  DATA F6,37
0366:  DATA 6C,3A
0367:  DATA E1,33
0368:  DATA E5,2F
0369:  DATA F6,30
036A:  DATA EC,3A
036B:  DATA 65,1D
036C:  DATA A0,12
036D:  DATA D8,06
036E:  DATA 0A,00
036F:  DATA 53,3A
0370:  DATA 61,39
0371:  DATA 74,10
0372:  DATA 46,36
0373:  DATA E1,39
0374:  DATA 68,10
0375:  DATA 45,39
0376:  DATA E1,39
0377:  DATA 65,10
0378:  DATA 41,36
0379:  DATA EC,06
037A:  DATA 0A,00
037B:  DATA 45,37
037C:  DATA 64,10
037D:  DATA 46,36
037E:  DATA E1,39
037F:  DATA 68,10
0380:  DATA 45,39
0381:  DATA E1,39
0382:  DATA 65,10
0383:  DATA 41,36
0384:  DATA EC,06
0385:  DATA 0A,00
0386:  DATA 53,3A
0387:  DATA 61,39
0388:  DATA 74,10
0389:  DATA 46,36
038A:  DATA E1,39
038B:  DATA 68,10
038C:  DATA 45,39
038D:  DATA E1,39
038E:  DATA 65,10
038F:  DATA 31,10
0390:  DATA D3,32
0391:  DATA 63,3A
0392:  DATA 6F,39
0393:  DATA 0D,05
0394:  DATA 00,01
0395:  DATA 45,37
0396:  DATA 64,10
0397:  DATA 46,36
0398:  DATA E1,39
0399:  DATA 68,10
039A:  DATA 45,39
039B:  DATA E1,39
039C:  DATA 65,10
039D:  DATA 31,10
039E:  DATA D3,32
039F:  DATA 63,3A
03A0:  DATA 6F,39
03A1:  DATA 0D,05
03A2:  DATA 00,00
03A3:  DATA 53,3A
03A4:  DATA 61,39
03A5:  DATA 74,10
03A6:  DATA 46,36
03A7:  DATA E1,39
03A8:  DATA 68,10
03A9:  DATA C3,37
03AA:  DATA F0,3C
03AB:  DATA A0,18
03AC:  DATA A0,29
03AD:  DATA E5,31
03AE:  DATA F4,37
03AF:  DATA F2,06
03B0:  DATA 0A,00
03B1:  DATA 45,37
03B2:  DATA 64,10
03B3:  DATA 46,36
03B4:  DATA E1,39
03B5:  DATA 68,10
03B6:  DATA C3,37
03B7:  DATA F0,3C
03B8:  DATA A0,18
03B9:  DATA A0,29
03BA:  DATA E5,31
03BB:  DATA F4,37
03BC:  DATA F2,06
03BD:  DATA 0A,00
03BE:  DATA C4,32
03BF:  DATA 73,3A
03C0:  DATA 69,37
03C1:  DATA 61,3A
03C2:  DATA E9,37
03C3:  DATA 6E,10
03C4:  DATA 61,32
03C5:  DATA 64,39
03C6:  DATA E5,39
03C7:  DATA 73,1D
03C8:  DATA A0,04
03C9:  DATA 30,3C
03CA:  DATA 25,18
03CB:  DATA 38,26
03CC:  DATA D8,06
03CD:  DATA 0A,00
03CE:  DATA D3,37
03CF:  DATA 75,39
03D0:  DATA E3,32
03D1:  DATA A0,30
03D2:  DATA 64,32
03D3:  DATA F2,32
03D4:  DATA F3,39
03D5:  DATA 3A,10
03D6:  DATA 09,18
03D7:  DATA F8,12
03D8:  DATA 30,1C
03D9:  DATA 4C,2C
03DA:  DATA 0D,05
03DB:  DATA 00,01
03DC:  DATA C4,30
03DD:  DATA F4,30
03DE:  DATA A0,39
03DF:  DATA 69,3D
03E0:  DATA 65,1D
03E1:  DATA A0,04
03E2:  DATA 09,10
03E3:  DATA A0,12
03E4:  DATA 30,1C
03E5:  DATA 4C,2C
03E6:  DATA 0D,05
03E7:  DATA 00,01
03E8:  DATA C3,37
03E9:  DATA F0,3C
03EA:  DATA 69,37
03EB:  DATA 67,17
03EC:  DATA 00,01
03ED:  DATA DF,2F
03EE:  DATA DF,2F
03EF:  DATA DF,2F
03F0:  DATA DF,2F
03F1:  DATA DF,22
03F2:  DATA 6E,32
03F3:  DATA A0,31
03F4:  DATA 6F,38
03F5:  DATA F9,2F
03F6:  DATA E4,30
03F7:  DATA F4,30
03F8:  DATA DF,2F
03F9:  DATA DF,2F
03FA:  DATA DF,2F
03FB:  DATA DF,2F
03FC:  DATA DF,06
03FD:  DATA 8A,2F
03FE:  DATA DF,2F
03FF:  DATA DF,2F
0400:  DATA DF,2F
0401:  DATA DF,2F
0402:  DATA DF,2F
0403:  DATA DF,2F
0404:  DATA DF,2F
0405:  DATA DF,2F
0406:  DATA DF,2F
0407:  DATA DF,2F
0408:  DATA DF,2F
0409:  DATA DF,2F
040A:  DATA DF,2F
040B:  DATA DF,2F
040C:  DATA DF,06
040D:  DATA 8A,06
040E:  DATA 0A,00
040F:  DATA 53,3A
0410:  DATA 61,39
0411:  DATA 74,10
0412:  DATA 65,3C
0413:  DATA E5,31
0414:  DATA 75,3A
0415:  DATA E5,2F
0416:  DATA E3,37
0417:  DATA ED,36
0418:  DATA 61,37
0419:  DATA E4,06
041A:  DATA 0A,00
041B:  DATA 89,16
041C:  DATA 3E,10
041D:  DATA 55,38
041E:  DATA EC,34
041F:  DATA EE,35
0420:  DATA A0,31
0421:  DATA EF,36
0422:  DATA ED,30
0423:  DATA 6E,32
0424:  DATA 0D,05
0425:  DATA 00,01
0426:  DATA 09,10
0427:  DATA 20,10
0428:  DATA 54,39
0429:  DATA 61,37
042A:  DATA F3,36
042B:  DATA 69,3A
042C:  DATA A0,20
042D:  DATA E3,35
042E:  DATA EE,37
042F:  DATA 77,36
0430:  DATA 65,32
0431:  DATA E7,32
0432:  DATA 0D,05
0433:  DATA 00,00
0434:  DATA 89,16
0435:  DATA 3E,10
0436:  DATA 53,3A
0437:  DATA 61,3A
0438:  DATA F5,39
0439:  DATA A0,31
043A:  DATA E8,32
043B:  DATA E3,35
043C:  DATA 0D,05
043D:  DATA 00,01
043E:  DATA 89,04
043F:  DATA 2D,1F
0440:  DATA A0,26
0441:  DATA 79,10
0442:  DATA 73,3A
0443:  DATA 61,3A
0444:  DATA F5,39
0445:  DATA A0,34
0446:  DATA 73,10
0447:  DATA 25,32
0448:  DATA 0D,05
0449:  DATA 00,10
044A:  DATA 09,10
044B:  DATA 20,10
044C:  DATA 54,39
044D:  DATA 61,37
044E:  DATA F3,36
044F:  DATA 69,3A
0450:  DATA A0,26
0451:  DATA C9,29
0452:  DATA A0,26
0453:  DATA C3,2A
0454:  DATA A0,29
0455:  DATA F4,30
0456:  DATA F4,3A
0457:  DATA F3,06
0458:  DATA 0A,00
0459:  DATA E6,34
045A:  DATA EE,34
045B:  DATA 73,34
045C:  DATA 65,32
045D:  DATA A0,34
045E:  DATA 6E,10
045F:  DATA 73,3A
0460:  DATA 61,3A
0461:  DATA F5,39
0462:  DATA DF,31
0463:  DATA E8,32
0464:  DATA E3,35
0465:  DATA 0D,05
0466:  DATA 00,00
0467:  DATA 89,16
0468:  DATA 3E,10
0469:  DATA E9,39
046A:  DATA A0,29
046B:  DATA 4D,23
046C:  DATA A0,30
046D:  DATA F6,30
046E:  DATA 69,36
046F:  DATA 61,31
0470:  DATA EC,32
0471:  DATA 0D,05
0472:  DATA 00,01
0473:  DATA 09,10
0474:  DATA 20,10
0475:  DATA 54,39
0476:  DATA 61,37
0477:  DATA F3,36
0478:  DATA 69,3A
0479:  DATA A0,20
047A:  DATA E3,35
047B:  DATA EE,37
047C:  DATA 77,36
047D:  DATA 65,32
047E:  DATA E7,32
047F:  DATA 0D,05
0480:  DATA 00,01
0481:  DATA 89,04
0482:  DATA 2D,1F
0483:  DATA A0,30
0484:  DATA 6C,36
0485:  DATA EF,3B
0486:  DATA 65,32
0487:  DATA 0D,05
0488:  DATA 00,01
0489:  DATA 89,04
048A:  DATA 2D,1F
048B:  DATA 20,32
048C:  DATA 65,37
048D:  DATA E9,32
048E:  DATA E4,06
048F:  DATA 0A,00
0490:  DATA 0D,05
0491:  DATA 54,34
0492:  DATA E9,39
0493:  DATA 20,10
0494:  DATA ED,34
0495:  DATA F3,39
0496:  DATA E9,37
0497:  DATA 6E,10
0498:  DATA E9,39
0499:  DATA A0,32
049A:  DATA F8,32
049B:  DATA E3,3A
049C:  DATA F4,32
049D:  DATA E4,06
049E:  DATA 8A,04
049F:  DATA 2D,1F
04A0:  DATA 20,18
04A1:  DATA F8,12
04A2:  DATA E4,06
04A3:  DATA 0A,00
04A4:  DATA 0D,05
04A5:  DATA DF,2F
04A6:  DATA DF,2F
04A7:  DATA DF,2F
04A8:  DATA DF,2F
04A9:  DATA DF,2F
04AA:  DATA DF,2F
04AB:  DATA DF,2F
04AC:  DATA DF,2F
04AD:  DATA DF,2F
04AE:  DATA DF,2F
04AF:  DATA DF,2F
04B0:  DATA DF,2F
04B1:  DATA DF,2F
04B2:  DATA DF,2F
04B3:  DATA DF,2F
04B4:  DATA DF,2F
04B5:  DATA DF,2F
04B6:  DATA DF,2F
04B7:  DATA 0D,05
04B8:  DATA DF,2F
04B9:  DATA DF,2F
04BA:  DATA DF,2F
04BB:  DATA DF,2F
04BC:  DATA 53,3A
04BD:  DATA 61,39
04BE:  DATA 74,10
04BF:  DATA 65,3C
04C0:  DATA E5,31
04C1:  DATA 75,3A
04C2:  DATA E5,2F
04C3:  DATA ED,34
04C4:  DATA F3,39
04C5:  DATA E9,37
04C6:  DATA EE,2F
04C7:  DATA DF,2F
04C8:  DATA DF,2F
04C9:  DATA DF,2F
04CA:  DATA DF,06
04CB:  DATA 8A,06
04CC:  DATA 0A,00
04CD:  DATA C3,37
04CE:  DATA ED,36
04CF:  DATA 61,37
04D0:  DATA 64,10
04D1:  DATA 49,22
04D2:  DATA 3A,10
04D3:  DATA 25,2C
04D4:  DATA 0D,05
04D5:  DATA 0D,05
04D6:  DATA 00,01
04D7:  DATA 89,04
04D8:  DATA 2D,1F
04D9:  DATA A0,24
04DA:  DATA 6E,3B
04DB:  DATA 61,36
04DC:  DATA 69,32
04DD:  DATA A0,21
04DE:  DATA 4D,22
04DF:  DATA A0,24
04E0:  DATA C4,10
04E1:  DATA 0D,05
04E2:  DATA 00,01
04E3:  DATA 0D,05
04E4:  DATA DF,2F
04E5:  DATA DF,2F
04E6:  DATA DF,2F
04E7:  DATA DF,2F
04E8:  DATA DF,22
04E9:  DATA 6E,32
04EA:  DATA A0,32
04EB:  DATA F8,32
04EC:  DATA E3,3A
04ED:  DATA F4,32
04EE:  DATA DF,36
04EF:  DATA E9,39
04F0:  DATA F3,34
04F1:  DATA 6F,37
04F2:  DATA DF,2F
04F3:  DATA DF,2F
04F4:  DATA DF,2F
04F5:  DATA DF,2F
04F6:  DATA DF,06
04F7:  DATA 8A,2F
04F8:  DATA DF,2F
04F9:  DATA DF,2F
04FA:  DATA DF,2F
04FB:  DATA DF,2F
04FC:  DATA DF,2F
04FD:  DATA DF,2F
04FE:  DATA DF,2F
04FF:  DATA DF,2F
0500:  DATA DF,2F
0501:  DATA DF,2F
0502:  DATA DF,2F
0503:  DATA DF,2F
0504:  DATA DF,2F
0505:  DATA DF,2F
0506:  DATA DF,2F
0507:  DATA DF,2F
0508:  DATA DF,2F
0509:  DATA DF,06
050A:  DATA 0A,00
050B:  DATA 46,36
050C:  DATA E1,39
050D:  DATA 68,10
050E:  DATA 49,37
050F:  DATA 69,3A
0510:  DATA E9,30
0511:  DATA EC,34
0512:  DATA FA,32
0513:  DATA 0D,05
0514:  DATA 00,01
0515:  DATA 89,2D
0516:  DATA CD,24
0517:  DATA 53,23
0518:  DATA 5D,10
0519:  DATA BC,16
051A:  DATA 20,10
051B:  DATA 39,23
051C:  DATA 0D,05
051D:  DATA 00,01
051E:  DATA 89,21
051F:  DATA EF,36
0520:  DATA 70,36
0521:  DATA 65,3A
0522:  DATA E5,06
0523:  DATA 0A,00
0524:  DATA 0D,05
0525:  DATA BD,1E
0526:  DATA BD,1E
0527:  DATA BD,1E
0528:  DATA BD,1E
0529:  DATA BD,1E
052A:  DATA BD,1E
052B:  DATA BD,1E
052C:  DATA BD,1E
052D:  DATA BD,1E
052E:  DATA BD,1E
052F:  DATA BD,1E
0530:  DATA BD,1E
0531:  DATA BD,1E
0532:  DATA BD,1E
0533:  DATA BD,1E
0534:  DATA BD,1E
0535:  DATA BD,1E
0536:  DATA BD,1E
0537:  DATA BD,1E
0538:  DATA BD,1E
0539:  DATA BD,1E
053A:  DATA BD,1E
053B:  DATA BD,1E
053C:  DATA BD,1E
053D:  DATA BD,1E
053E:  DATA BD,1E
053F:  DATA BD,1E
0540:  DATA BD,1E
0541:  DATA BD,1E
0542:  DATA BD,1E
0543:  DATA 0D,05
0544:  DATA 00,01
0545:  DATA 54,34
0546:  DATA E9,39
0547:  DATA A0,34
0548:  DATA 73,10
0549:  DATA CD,27
054A:  DATA CD,24
054B:  DATA CA,24
054C:  DATA A0,21
054D:  DATA C9,23
054E:  DATA 53,10
054F:  DATA D0,24
0550:  DATA 43,10
0551:  DATA 42,21
0552:  DATA 4D,10
0553:  DATA E6,37
0554:  DATA 72,10
0555:  DATA CD,24
0556:  DATA D3,1B
0557:  DATA 5F,21
0558:  DATA C2,26
0559:  DATA 31,17
055A:  DATA 0D,05
055B:  DATA 00,01
055C:  DATA CC,30
055D:  DATA 73,3A
055E:  DATA A0,3A
055F:  DATA 70,32
0560:  DATA 61,3A
0561:  DATA 65,32
0562:  DATA A0,37
0563:  DATA 6E,10
0564:  DATA 32,18
0565:  DATA B2,1A
0566:  DATA 2F,18
0567:  DATA B4,17
0568:  DATA B2,1A
0569:  DATA 2C,10
056A:  DATA E2,3C
056B:  DATA A0,24
056C:  DATA EE,37
056D:  DATA F5,32
056E:  DATA AE,06
056F:  DATA 8A,06
0570:  DATA 0A,00
0571:  DATA DF,2F
0572:  DATA DF,2F
0573:  DATA C3,24
0574:  DATA C7,29
0575:  DATA 20,28
0576:  DATA C9,21
0577:  DATA A0,29
0578:  DATA F4,30
0579:  DATA 72,3A
057A:  DATA A0,27
057B:  DATA F0,32
057C:  DATA F2,30
057D:  DATA F4,34
057E:  DATA 6F,37
057F:  DATA DF,2F
0580:  DATA DF,2F
0581:  DATA DF,06
0582:  DATA 8A,06
0583:  DATA 0A,00
0584:  DATA F7,30
0585:  DATA 69,3A
0586:  DATA 69,37
0587:  DATA 67,10
0588:  DATA E6,37
0589:  DATA 72,10
058A:  DATA C2,27
058B:  DATA D3,29
058C:  DATA 20,28
058D:  DATA C9,21
058E:  DATA A0,31
058F:  DATA EF,36
0590:  DATA ED,30
0591:  DATA 6E,32
0592:  DATA 00,01
0593:  DATA 46,39
0594:  DATA E1,36
0595:  DATA E5,24
0596:  DATA 44,1D
0597:  DATA A0,12
0598:  DATA 31,2C
0599:  DATA 0D,05
059A:  DATA 00,01
059B:  DATA F0,30
059C:  DATA 79,36
059D:  DATA EF,30
059E:  DATA 64,10
059F:  DATA F3,34
05A0:  DATA FA,32
05A1:  DATA 3A,10
05A2:  DATA 25,32
05A3:  DATA 0D,05
05A4:  DATA 00,01
05A5:  DATA F0,30
05A6:  DATA 79,36
05A7:  DATA EF,30
05A8:  DATA 64,1D
05A9:  DATA 20,00
05AA:  DATA 0D,05
05AB:  DATA 0D,05
05AC:  DATA 00,01
05AD:  DATA 89,16
05AE:  DATA 3E,10
05AF:  DATA 49,37
05B0:  DATA F6,30
05B1:  DATA EC,34
05B2:  DATA 64,10
05B3:  DATA E3,37
05B4:  DATA ED,36
05B5:  DATA 61,37
05B6:  DATA E4,06
05B7:  DATA 0A,00
05B8:  DATA 0D,05
05B9:  DATA 0D,05
05BA:  DATA BD,1E
05BB:  DATA BD,1E
05BC:  DATA BD,1E
05BD:  DATA 0D,05
05BE:  DATA 0D,05
05BF:  DATA C6,34
05C0:  DATA EE,34
05C1:  DATA 73,34
05C2:  DATA 65,32
05C3:  DATA 20,38
05C4:  DATA F2,37
05C5:  DATA E3,32
05C6:  DATA F3,39
05C7:  DATA AE,06
05C8:  DATA 8A,2B
05C9:  DATA E1,34
05CA:  DATA 74,10
05CB:  DATA E6,37
05CC:  DATA 72,10
05CD:  DATA C2,27
05CE:  DATA D3,29
05CF:  DATA 20,28
05D0:  DATA C9,21
05D1:  DATA 20,3A
05D2:  DATA 75,39
05D3:  DATA 6E,10
05D4:  DATA 6F,33
05D5:  DATA 66,10
05D6:  DATA ED,32
05D7:  DATA 00,01
05D8:  DATA 45,37
05D9:  DATA 64,10
05DA:  DATA ED,30
05DB:  DATA 69,37
05DC:  DATA 0D,05
05DD:  DATA 00,00
*
0603:  MOVF   0B,W
0604:  BCF    0B.7
0605:  MOVLB  03
0606:  BSF    15.7
0607:  BSF    15.0
0608:  NOP
0609:  NOP
060A:  BTFSC  09.7
060B:  BSF    0B.7
060C:  MOVF   13,W
060D:  ANDLW  7F
060E:  BTFSC  03.2
060F:  GOTO   651
0610:  MOVLB  10
0611:  MOVWF  6D
0612:  MOVLB  03
0613:  MOVF   11,W
0614:  MOVLB  10
0615:  MOVWF  6E
0616:  MOVLB  03
0617:  MOVF   12,W
0618:  MOVLB  10
0619:  MOVWF  6F
061A:  MOVF   6D,W
061B:  MOVLB  11
061C:  MOVWF  20
061D:  MOVLB  00
061E:  CALL   5DE
061F:  MOVLB  10
0620:  MOVF   6E,W
0621:  MOVLB  03
0622:  MOVWF  11
0623:  MOVLB  10
0624:  MOVF   6F,W
0625:  MOVLB  03
0626:  MOVWF  12
0627:  MOVF   0B,W
0628:  BCF    0B.7
0629:  BSF    15.7
062A:  BSF    15.0
062B:  NOP
062C:  NOP
062D:  BTFSC  09.7
062E:  BSF    0B.7
062F:  RLF    13,W
0630:  RLF    14,W
0631:  ANDLW  7F
0632:  BTFSC  03.2
0633:  GOTO   651
0634:  MOVLB  10
0635:  MOVWF  6D
0636:  MOVLB  03
0637:  MOVF   11,W
0638:  MOVLB  10
0639:  MOVWF  6E
063A:  MOVLB  03
063B:  MOVF   12,W
063C:  MOVLB  10
063D:  MOVWF  6F
063E:  MOVF   6D,W
063F:  MOVLB  11
0640:  MOVWF  20
0641:  MOVLB  00
0642:  CALL   5DE
0643:  MOVLB  10
0644:  MOVF   6E,W
0645:  MOVLB  03
0646:  MOVWF  11
0647:  MOVLB  10
0648:  MOVF   6F,W
0649:  MOVLB  03
064A:  MOVWF  12
064B:  INCF   11,F
064C:  BTFSC  03.2
064D:  INCF   12,F
064E:  MOVLB  00
064F:  GOTO   603
0650:  MOVLB  03
0651:  MOVLB  00
0652:  RETURN
*
06E7:  MOVLB  10
06E8:  BTFSC  6D.7
06E9:  GOTO   6FD
06EA:  MOVLW  0F
06EB:  MOVWF  77
06EC:  SWAPF  6C,W
06ED:  ANDWF  77,F
06EE:  MOVLW  0A
06EF:  SUBWF  77,W
06F0:  BTFSC  03.0
06F1:  GOTO   6F5
06F2:  MOVLW  30
06F3:  ADDWF  77,F
06F4:  GOTO   6F7
06F5:  MOVF   6D,W
06F6:  ADDWF  77,F
06F7:  MOVF   77,W
06F8:  MOVLB  11
06F9:  MOVWF  20
06FA:  MOVLB  00
06FB:  CALL   5DE
06FC:  MOVLB  10
06FD:  MOVLW  0F
06FE:  ANDWF  6C,F
06FF:  MOVLW  0A
0700:  SUBWF  6C,W
0701:  BTFSC  03.0
0702:  GOTO   705
0703:  MOVLW  30
0704:  GOTO   707
0705:  BCF    6D.7
0706:  MOVF   6D,W
0707:  ADDWF  6C,F
0708:  MOVF   6C,W
0709:  MOVLB  11
070A:  MOVWF  20
070B:  MOVLB  00
070C:  CALL   5DE
070D:  RETURN
*
078D:  MOVF   0B,W
078E:  BCF    0B.7
078F:  MOVLB  03
0790:  BSF    15.7
0791:  BSF    15.0
0792:  NOP
0793:  NOP
0794:  BTFSC  09.7
0795:  BSF    0B.7
0796:  BTFSC  03.0
0797:  GOTO   7C1
0798:  MOVF   13,W
0799:  ANDLW  7F
079A:  MOVLB  10
079B:  MOVWF  6D
079C:  MOVLB  03
079D:  MOVF   11,W
079E:  MOVLB  10
079F:  MOVWF  6E
07A0:  MOVLB  03
07A1:  MOVF   12,W
07A2:  MOVLB  10
07A3:  MOVWF  6F
07A4:  MOVF   6D,W
07A5:  MOVLB  11
07A6:  MOVWF  20
07A7:  MOVLB  00
07A8:  CALL   5DE
07A9:  MOVLB  10
07AA:  MOVF   6E,W
07AB:  MOVLB  03
07AC:  MOVWF  11
07AD:  MOVLB  10
07AE:  MOVF   6F,W
07AF:  MOVLB  03
07B0:  MOVWF  12
07B1:  MOVF   0B,W
07B2:  BCF    0B.7
07B3:  BSF    15.7
07B4:  BSF    15.0
07B5:  NOP
07B6:  NOP
07B7:  BTFSC  09.7
07B8:  BSF    0B.7
07B9:  MOVLB  10
07BA:  DECFSZ 6C,F
07BB:  GOTO   7BD
07BC:  GOTO   7BF
07BD:  MOVLB  03
07BE:  GOTO   7C1
07BF:  GOTO   7E5
07C0:  MOVLB  03
07C1:  RLF    13,W
07C2:  RLF    14,W
07C3:  ANDLW  7F
07C4:  MOVLB  10
07C5:  MOVWF  6D
07C6:  MOVLB  03
07C7:  MOVF   11,W
07C8:  MOVLB  10
07C9:  MOVWF  6E
07CA:  MOVLB  03
07CB:  MOVF   12,W
07CC:  MOVLB  10
07CD:  MOVWF  6F
07CE:  MOVF   6D,W
07CF:  MOVLB  11
07D0:  MOVWF  20
07D1:  MOVLB  00
07D2:  CALL   5DE
07D3:  MOVLB  10
07D4:  MOVF   6E,W
07D5:  MOVLB  03
07D6:  MOVWF  11
07D7:  MOVLB  10
07D8:  MOVF   6F,W
07D9:  MOVLB  03
07DA:  MOVWF  12
07DB:  INCF   11,F
07DC:  BTFSC  03.2
07DD:  INCF   12,F
07DE:  BCF    03.0
07DF:  MOVLB  10
07E0:  DECFSZ 6C,F
07E1:  GOTO   7E3
07E2:  GOTO   7E5
07E3:  MOVLB  00
07E4:  GOTO   78D
07E5:  MOVLB  00
07E6:  RETURN
07E7:  MOVLB  10
07E8:  MOVF   49,W
07E9:  CLRF   78
07EA:  SUBWF  48,W
07EB:  BTFSC  03.0
07EC:  GOTO   7F0
07ED:  MOVF   48,W
07EE:  MOVWF  77
07EF:  GOTO   7FC
07F0:  CLRF   77
07F1:  MOVLW  08
07F2:  MOVWF  4A
07F3:  RLF    48,F
07F4:  RLF    77,F
07F5:  MOVF   49,W
07F6:  SUBWF  77,W
07F7:  BTFSC  03.0
07F8:  MOVWF  77
07F9:  RLF    78,F
07FA:  DECFSZ 4A,F
07FB:  GOTO   7F3
07FC:  MOVLB  00
07FD:  RETURN
*
0A56:  MOVLW  20
0A57:  MOVLB  10
0A58:  BTFSS  40.4
0A59:  MOVLW  30
0A5A:  MOVWF  44
0A5B:  MOVF   3F,W
0A5C:  MOVWF  77
0A5D:  BTFSS  3F.7
0A5E:  GOTO   267
0A5F:  COMF   77,F
0A60:  INCF   77,F
0A61:  MOVF   77,W
0A62:  MOVWF  3F
0A63:  MOVLW  2D
0A64:  MOVWF  44
0A65:  BSF    40.7
0A66:  BSF    40.0
0A67:  MOVF   3F,W
0A68:  MOVWF  48
0A69:  MOVLW  64
0A6A:  MOVWF  49
0A6B:  MOVLP  00
0A6C:  MOVLB  00
0A6D:  CALL   7E7
0A6E:  MOVLP  08
0A6F:  MOVF   77,W
0A70:  MOVLB  10
0A71:  MOVWF  3F
0A72:  MOVLW  30
0A73:  ADDWF  78,W
0A74:  MOVWF  45
0A75:  MOVF   3F,W
0A76:  MOVWF  48
0A77:  MOVLW  0A
0A78:  MOVWF  49
0A79:  MOVLP  00
0A7A:  MOVLB  00
0A7B:  CALL   7E7
0A7C:  MOVLP  08
0A7D:  MOVLW  30
0A7E:  ADDWF  77,W
0A7F:  MOVLB  10
0A80:  MOVWF  47
0A81:  MOVLW  30
0A82:  ADDWF  78,W
0A83:  MOVWF  46
0A84:  MOVF   44,W
0A85:  MOVWF  77
0A86:  MOVLW  30
0A87:  SUBWF  45,W
0A88:  BTFSC  03.2
0A89:  GOTO   28E
0A8A:  BSF    40.1
0A8B:  BTFSC  40.7
0A8C:  BSF    40.2
0A8D:  GOTO   2A2
0A8E:  MOVF   44,W
0A8F:  MOVWF  45
0A90:  MOVLW  20
0A91:  MOVWF  44
0A92:  MOVLW  30
0A93:  SUBWF  46,W
0A94:  BTFSC  03.2
0A95:  GOTO   29A
0A96:  BSF    40.0
0A97:  BTFSC  40.7
0A98:  BSF    40.1
0A99:  GOTO   2A2
0A9A:  BTFSS  03.2
0A9B:  BSF    40.0
0A9C:  BTFSS  03.2
0A9D:  GOTO   2A2
0A9E:  MOVF   45,W
0A9F:  MOVWF  46
0AA0:  MOVLW  20
0AA1:  MOVWF  45
0AA2:  BTFSC  40.2
0AA3:  GOTO   2A9
0AA4:  BTFSC  40.1
0AA5:  GOTO   2B1
0AA6:  BTFSC  40.0
0AA7:  GOTO   2B9
0AA8:  GOTO   2C1
0AA9:  MOVF   44,W
0AAA:  MOVLB  11
0AAB:  MOVWF  20
0AAC:  MOVLP  00
0AAD:  MOVLB  00
0AAE:  CALL   5DE
0AAF:  MOVLP  08
0AB0:  MOVLB  10
0AB1:  MOVF   45,W
0AB2:  MOVLB  11
0AB3:  MOVWF  20
0AB4:  MOVLP  00
0AB5:  MOVLB  00
0AB6:  CALL   5DE
0AB7:  MOVLP  08
0AB8:  MOVLB  10
0AB9:  MOVF   46,W
0ABA:  MOVLB  11
0ABB:  MOVWF  20
0ABC:  MOVLP  00
0ABD:  MOVLB  00
0ABE:  CALL   5DE
0ABF:  MOVLP  08
0AC0:  MOVLB  10
0AC1:  MOVF   47,W
0AC2:  MOVLB  11
0AC3:  MOVWF  20
0AC4:  MOVLP  00
0AC5:  MOVLB  00
0AC6:  CALL   5DE
0AC7:  MOVLP  08
0AC8:  RETURN
*
0AD9:  MOVF   78,W
0ADA:  BTFSC  03.2
0ADB:  GOTO   2E0
0ADC:  MOVF   77,W
0ADD:  MOVWI  W,[FSR0++]
0ADE:  DECFSZ 78,F
0ADF:  GOTO   2DC
*
0B82:  CLRF   77
0B83:  CLRF   78
0B84:  MOVLB  10
0B85:  MOVF   4C,W
0B86:  BCF    03.0
0B87:  BTFSC  4D.0
0B88:  ADDWF  77,F
0B89:  RRF    77,F
0B8A:  RRF    78,F
0B8B:  BTFSC  4D.1
0B8C:  ADDWF  77,F
0B8D:  RRF    77,F
0B8E:  RRF    78,F
0B8F:  BTFSC  4D.2
0B90:  ADDWF  77,F
0B91:  RRF    77,F
0B92:  RRF    78,F
0B93:  BTFSC  4D.3
0B94:  ADDWF  77,F
0B95:  RRF    77,F
0B96:  RRF    78,F
0B97:  BTFSC  4D.4
0B98:  ADDWF  77,F
0B99:  RRF    77,F
0B9A:  RRF    78,F
0B9B:  BTFSC  4D.5
0B9C:  ADDWF  77,F
0B9D:  RRF    77,F
0B9E:  RRF    78,F
0B9F:  BTFSC  4D.6
0BA0:  ADDWF  77,F
0BA1:  RRF    77,F
0BA2:  RRF    78,F
0BA3:  BTFSC  4D.7
0BA4:  ADDWF  77,F
0BA5:  RRF    77,F
0BA6:  RRF    78,F
0BA7:  MOVLB  00
0BA8:  RETURN
*
0BC7:  MOVF   46,W
0BC8:  MOVWF  48
0BC9:  MOVLW  64
0BCA:  MOVWF  49
0BCB:  MOVLP  00
0BCC:  MOVLB  00
0BCD:  CALL   7E7
0BCE:  MOVLP  08
0BCF:  MOVF   77,W
0BD0:  MOVLB  10
0BD1:  MOVWF  46
0BD2:  MOVF   78,W
0BD3:  MOVLW  30
0BD4:  BTFSS  03.2
0BD5:  GOTO   3DD
0BD6:  BTFSS  47.1
0BD7:  GOTO   3E9
0BD8:  BTFSC  47.3
0BD9:  GOTO   3E9
0BDA:  BTFSC  47.4
0BDB:  MOVLW  20
0BDC:  GOTO   3E0
0BDD:  BCF    47.3
0BDE:  BCF    47.4
0BDF:  BSF    47.0
0BE0:  ADDWF  78,F
0BE1:  MOVF   78,W
0BE2:  MOVLB  11
0BE3:  MOVWF  20
0BE4:  MOVLP  00
0BE5:  MOVLB  00
0BE6:  CALL   5DE
0BE7:  MOVLP  08
0BE8:  MOVLB  10
0BE9:  MOVF   46,W
0BEA:  MOVWF  48
0BEB:  MOVLW  0A
0BEC:  MOVWF  49
0BED:  MOVLP  00
0BEE:  MOVLB  00
0BEF:  CALL   7E7
0BF0:  MOVLP  08
0BF1:  MOVF   77,W
0BF2:  MOVLB  10
0BF3:  MOVWF  46
0BF4:  MOVF   78,W
0BF5:  MOVLW  30
0BF6:  BTFSS  03.2
0BF7:  GOTO   3FE
0BF8:  BTFSC  47.3
0BF9:  GOTO   407
0BFA:  BTFSS  47.0
0BFB:  GOTO   407
0BFC:  BTFSC  47.4
0BFD:  MOVLW  20
0BFE:  ADDWF  78,F
0BFF:  MOVF   78,W
0C00:  MOVLB  11
0C01:  MOVWF  20
0C02:  MOVLP  00
0C03:  MOVLB  00
0C04:  CALL   5DE
0C05:  MOVLP  08
0C06:  MOVLB  10
0C07:  MOVLW  30
0C08:  ADDWF  46,F
0C09:  MOVF   46,W
0C0A:  MOVLB  11
0C0B:  MOVWF  20
0C0C:  MOVLP  00
0C0D:  MOVLB  00
0C0E:  CALL   5DE
0C0F:  MOVLP  08
.................... 
.................... #list
.................... 
.................... 
.................... #device ADC=12
.................... #use delay(crystal=16MHz, clock=16MHz)
*
06C4:  MOVLW  25
06C5:  MOVWF  05
06C6:  MOVLW  2A
06C7:  MOVWF  04
06C8:  MOVF   00,W
06C9:  BTFSC  03.2
06CA:  GOTO   6D9
06CB:  MOVLW  05
06CC:  MOVWF  78
06CD:  CLRF   77
06CE:  DECFSZ 77,F
06CF:  GOTO   6CE
06D0:  DECFSZ 78,F
06D1:  GOTO   6CD
06D2:  MOVLW  2E
06D3:  MOVWF  77
06D4:  DECFSZ 77,F
06D5:  GOTO   6D4
06D6:  GOTO   6D7
06D7:  DECFSZ 00,F
06D8:  GOTO   6CB
06D9:  RETURN
.................... #fuses NOMCLR
.................... 
.................... 
.................... 
.................... //#define SELF_DEVICE_ID CIGS_PIC
.................... 
.................... 
.................... //-------------Serial--------------------
.................... #use rs232(baud=9600,parity=N,xmit=PIN_C6,rcv=PIN_C7,bits=8,stream=BOSS)
*
0B35:  MOVLB  00
0B36:  BTFSS  11.4
0B37:  GOTO   336
0B38:  MOVLB  03
0B39:  MOVWF  1A
.................... #use rs232(baud=9600,parity=N,xmit=PIN_B4,bits=8,stream=PC,FORCE_SW)
*
05DE:  MOVLB  01
05DF:  BCF    0D.4
05E0:  MOVLB  02
05E1:  BCF    0D.4
05E2:  MOVLW  08
05E3:  MOVWF  78
05E4:  GOTO   5E5
05E5:  NOP
05E6:  BSF    78.7
05E7:  GOTO   5F8
05E8:  BCF    78.7
05E9:  MOVLB  11
05EA:  RRF    20,F
05EB:  MOVLB  02
05EC:  BTFSC  03.0
05ED:  BSF    0D.4
05EE:  BTFSS  03.0
05EF:  BCF    0D.4
05F0:  BSF    78.6
05F1:  GOTO   5F8
05F2:  BCF    78.6
05F3:  DECFSZ 78,F
05F4:  GOTO   5E9
05F5:  GOTO   5F6
05F6:  NOP
05F7:  BSF    0D.4
05F8:  MOVLW  84
05F9:  MOVWF  04
05FA:  DECFSZ 04,F
05FB:  GOTO   5FA
05FC:  NOP
05FD:  BTFSC  78.7
05FE:  GOTO   5E8
05FF:  BTFSC  78.6
0600:  GOTO   5F2
0601:  MOVLB  00
0602:  RETURN
.................... 
.................... 
.................... #define SPI0_CS  PIN_D1
.................... #use spi(MASTER, CLK=PIN_C3, DI=PIN_C4, DO=PIN_C5, BAUD=400000, MODE=0, BITS=8, STREAM=MIS_FM_STREAM)
*
06DA:  MOVLB  04
06DB:  MOVF   11,W
06DC:  MOVLB  10
06DD:  MOVF   4C,W
06DE:  MOVLB  04
06DF:  MOVWF  11
06E0:  RRF    14,W
06E1:  BTFSS  03.0
06E2:  GOTO   6E0
06E3:  MOVF   11,W
06E4:  MOVWF  77
06E5:  MOVLB  00
06E6:  RETURN
.................... // MISO PIN_C5, MOSI PIN_C4, SCK PIN_C3
.................... 
.................... 
.................... #define SPI1_CS PIN_C2
.................... #use spi(MASTER, SPI1, BAUD=400000, MODE=0, BITS=8, STREAM=SMF_STREAM)
.................... 
.................... 
.................... 
.................... //-------------I/O port--------------------
.................... // AI/O___ADC
.................... #define TEMP_TOP PIN_A5
.................... #define TEMP_BOT PIN_A3
.................... #define CIGS_VOLT PIN_A0 //PIN_A0
.................... #define CIGS_CURR PIN_A1
.................... #define PD PIN_E0
.................... 
.................... // AI/O___DAC
.................... #define LOAD PIN_A2
.................... 
.................... // DI/O___
.................... #define CIGS_CONNECT PIN_C0
.................... #define EN_NPWR PIN_C3  //Negative Power
.................... 
.................... 
.................... #endif // MMJ_CIGS_CONFIG_H
.................... 
.................... //------------------End of File------------------
.................... 
.................... 
.................... 
.................... #include "./lib/typedef_content.h"
.................... #ifndef TYPEDEF_CONTENT_H
.................... #define TYPEDEF_CONTENT_H
.................... 
.................... // there is used in main.c
.................... 
.................... typedef enum {
....................     EXECUTING_MISSION = 0x02,
....................     IDLE              = 0x03,
....................     SMF_USE_REQ       = 0x04,
....................     COPYING           = 0x05,
....................     FINISHED          = 0x06
.................... } MisMcuStatusContent;
.................... 
.................... 
.................... typedef enum {
....................     ALLOW = 0x00,
....................     DENY  = 0x01
.................... } IsSmfAvailableContent;
.................... 
.................... 
.................... #endif
.................... 
.................... // EOF
.................... 
.................... 
.................... #include "./lib/value_status.h"
.................... #ifndef VALUE_STATUS_H
.................... #define VALUE_STATUS_H
.................... 
.................... // there is used in main.c and mission
.................... 
.................... volatile unsigned int16 duration_sec = 0;
.................... volatile int1 is_use_smf_req_in_mission = FALSE;
.................... volatile int8 status = IDLE;
.................... 
.................... 
.................... #endif
.................... 
.................... // EOF
.................... 
.................... 
.................... #include "./lib/timer.h"
.................... #ifndef TIMER_H
.................... #define TIMER_H
.................... 
.................... // __________ define _________
.................... 
.................... #define SEC_IN_A_DAY 86400
.................... 
.................... 
.................... // __________ values _________
.................... 
.................... volatile unsigned int32 subsec = 0, sec = 0; //dsec -> deci second (0.01 sec)
.................... volatile unsigned int16 day = 0;
.................... 
.................... 
.................... // __________ functions _________
.................... 
.................... #INT_TIMER0
.................... static void TIMER0_isr();
.................... 
.................... 
.................... #include "./src/timer.c"
.................... #INT_TIMER0
.................... static void TIMER0_isr(void)
.................... {
....................    // every 0.01 sec interrupts
....................    set_timer0(100);
*
0047:  MOVLW  64
0048:  MOVWF  15
.................... 
....................    if (++subsec >= 100)
0049:  MOVLW  01
004A:  ADDWF  2C,F
004B:  BTFSC  03.0
004C:  INCF   2D,F
004D:  BTFSC  03.2
004E:  INCF   2E,F
004F:  BTFSC  03.2
0050:  INCF   2F,F
0051:  MOVF   2F,F
0052:  BTFSS  03.2
0053:  GOTO   05E
0054:  MOVF   2E,F
0055:  BTFSS  03.2
0056:  GOTO   05E
0057:  MOVF   2D,F
0058:  BTFSS  03.2
0059:  GOTO   05E
005A:  MOVF   2C,W
005B:  SUBLW  63
005C:  BTFSC  03.0
005D:  GOTO   08A
....................    {
....................       subsec = 0;
005E:  CLRF   2F
005F:  CLRF   2E
0060:  CLRF   2D
0061:  CLRF   2C
....................       sec++;
0062:  MOVLW  01
0063:  ADDWF  30,F
0064:  BTFSC  03.0
0065:  INCF   31,F
0066:  BTFSC  03.2
0067:  INCF   32,F
0068:  BTFSC  03.2
0069:  INCF   33,F
.................... 
....................       if (sec >= SEC_IN_A_DAY)
006A:  MOVF   33,F
006B:  BTFSS  03.2
006C:  GOTO   07F
006D:  MOVF   32,W
006E:  SUBLW  00
006F:  BTFSC  03.0
0070:  GOTO   08A
0071:  XORLW  FF
0072:  BTFSS  03.2
0073:  GOTO   07F
0074:  MOVF   31,W
0075:  SUBLW  50
0076:  BTFSC  03.0
0077:  GOTO   08A
0078:  XORLW  FF
0079:  BTFSS  03.2
007A:  GOTO   07F
007B:  MOVF   30,W
007C:  SUBLW  7F
007D:  BTFSC  03.0
007E:  GOTO   08A
....................       {
....................          sec -= SEC_IN_A_DAY;
007F:  MOVLW  80
0080:  SUBWF  30,F
0081:  MOVLW  51
0082:  SUBWFC 31,F
0083:  MOVLW  01
0084:  SUBWFC 32,F
0085:  MOVLW  00
0086:  SUBWFC 33,F
....................          day++;
0087:  INCF   34,F
0088:  BTFSC  03.2
0089:  INCF   35,F
....................       }
....................    }
008A:  BCF    0B.2
008B:  MOVLP  00
008C:  GOTO   02A
.................... }
.................... 
.................... void timer_init()
.................... {
....................    fprintf(PC, "Timer Initialize\r\n");
*
06A7:  MOVLW  8D
06A8:  MOVLB  03
06A9:  MOVWF  11
06AA:  MOVLW  00
06AB:  MOVWF  12
06AC:  MOVLB  00
06AD:  CALL   603
....................    clear_interrupt(INT_TIMER1);
06AE:  BCF    11.0
....................    setup_timer_1(T1_EXTERNAL | T1_DIV_BY_1); //Config TMR1, external clock, prescaler=1
06AF:  MOVLW  87
06B0:  MOVWF  18
06B1:  CLRF   19
....................    set_timer1(0x8000); //timer1 for 1 second interruption
06B2:  CLRF   16
06B3:  MOVLW  80
06B4:  MOVWF  17
06B5:  CLRF   16
06B6:  NOP
....................    //T1OSCEN = 1; //Enable TMR1 Oscillator
....................    enable_interrupts(INT_TIMER1);
06B7:  MOVLB  01
06B8:  BSF    11.0
....................    enable_interrupts(GLOBAL);
06B9:  MOVLW  C0
06BA:  IORWF  0B,F
....................    fprintf(PC, "\tComplete\r\n");
06BB:  MOVLW  97
06BC:  MOVLB  03
06BD:  MOVWF  11
06BE:  MOVLW  00
06BF:  MOVWF  12
06C0:  MOVLB  00
06C1:  CALL   603
06C2:  MOVLP  10
06C3:  GOTO   449 (RETURN)
.................... }
.................... 
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... 
.................... #include "./lib/uart.h"
.................... #ifndef UART_H
.................... #define UART_H
.................... 
.................... // _________ defines ________________
.................... 
.................... #define RECEIVE_BUFFER_MAX 32
.................... 
.................... 
.................... // _____________ values _______________
.................... 
.................... volatile unsigned int8 boss_receive_buffer[RECEIVE_BUFFER_MAX] = {0x00};
.................... volatile int8 boss_receive_buffer_size = 0;
.................... 
.................... 
.................... // _______________ functions ___________
.................... 
.................... #INT_RDA
.................... static void RDA_isr(void);
.................... 
.................... void initialize_uart();
.................... 
.................... void clear_receive_signal(unsigned int8 receive_signal[], int8 *receive_signal_size);
.................... 
.................... 
.................... #include "./src/uart.c"
.................... #INT_RDA
.................... static void RDA_isr(void)
.................... {
....................    if (!(status == EXECUTING_MISSION || status == COPYING) || is_use_smf_req_in_mission)
*
009D:  MOVF   2B,W
009E:  SUBLW  02
009F:  BTFSC  03.2
00A0:  GOTO   0A5
00A1:  MOVF   2B,W
00A2:  SUBLW  05
00A3:  BTFSS  03.2
00A4:  GOTO   0A7
00A5:  BTFSS  2A.0
00A6:  GOTO   0BA
....................       if (boss_receive_buffer_size < RECEIVE_BUFFER_MAX)
00A7:  MOVF   58,W
00A8:  SUBLW  1F
00A9:  BTFSS  03.0
00AA:  GOTO   0BA
....................          boss_receive_buffer[boss_receive_buffer_size++ % RECEIVE_BUFFER_MAX] = fgetc(BOSS);
00AB:  MOVF   58,W
00AC:  INCF   58,F
00AD:  ANDLW  1F
00AE:  ADDLW  18
00AF:  MOVWF  04
00B0:  MOVLW  20
00B1:  MOVWF  05
00B2:  BTFSC  03.0
00B3:  INCF   05,F
00B4:  BTFSS  11.5
00B5:  GOTO   0B4
00B6:  MOVLB  03
00B7:  MOVF   19,W
00B8:  MOVWF  00
00B9:  MOVLB  00
00BA:  BCF    11.5
00BB:  MOVLP  00
00BC:  GOTO   02A
.................... }
.................... 
.................... void uart_init()
.................... {
....................    fprintf(PC, "UART Initialize\r\n");
*
0693:  MOVLW  BD
0694:  MOVLB  03
0695:  MOVWF  11
0696:  MOVLW  00
0697:  MOVWF  12
0698:  MOVLB  00
0699:  CALL   603
....................    enable_interrupts(INT_RDA);
069A:  MOVLB  01
069B:  BSF    11.5
....................    enable_interrupts(global);
069C:  MOVLW  C0
069D:  IORWF  0B,F
....................    fprintf(PC, "\tComplete\r\n");
069E:  MOVLW  C6
069F:  MOVLB  03
06A0:  MOVWF  11
06A1:  MOVLW  00
06A2:  MOVWF  12
06A3:  MOVLB  00
06A4:  CALL   603
06A5:  MOVLP  10
06A6:  GOTO   446 (RETURN)
.................... }
.................... 
.................... void clear_receive_signal(unsigned int8 receive_signal[], int8 *receive_signal_size)
.................... {
....................    memset(receive_signal, 0x00, *receive_signal_size);
*
0AC9:  MOVLB  10
0ACA:  MOVF   36,W
0ACB:  MOVWF  7A
0ACC:  MOVF   35,W
0ACD:  MOVWF  04
0ACE:  MOVF   7A,W
0ACF:  MOVWF  05
0AD0:  MOVF   00,W
0AD1:  MOVWF  38
0AD2:  MOVF   34,W
0AD3:  MOVWF  05
0AD4:  MOVF   33,W
0AD5:  MOVWF  04
0AD6:  CLRF   77
0AD7:  MOVF   38,W
0AD8:  MOVWF  78
....................    *receive_signal_size = 0;
*
0AE0:  MOVF   35,W
0AE1:  MOVWF  04
0AE2:  MOVF   36,W
0AE3:  MOVWF  05
0AE4:  CLRF   00
0AE5:  MOVLP  10
0AE6:  MOVLB  00
0AE7:  GOTO   50C (RETURN)
.................... }
.................... 
.................... // EOF
.................... 
.................... 
.................... #endif
.................... 
.................... // EOF
.................... 
.................... 
.................... // Missions
.................... #include "mmj_cigs_mode.h"
.................... #ifndef MMJ_CIGS_MODE_H
.................... #define MMJ_CIGS_MODE_H
.................... 
.................... 
.................... // ___________MODE FUNCTIONS____________
.................... 
.................... #Separate
.................... void mode_measure(unsigned int8 parameter[]);
.................... 
.................... // Flash command 
.................... #Separate
.................... void mode_flash_erase_all();
.................... #Separate
.................... void mode_flash_erase_1sector();
.................... #Separate
.................... void mode_flash_copy_1sector();
.................... #Separate
.................... void mode_flash_write_1sector();
.................... #Separate
.................... void mode_flash_func2();
.................... #Separate
.................... void mode_flash_read();
.................... #Separate
.................... void mode_flash_read_address();
.................... 
.................... // IV command
.................... #Separate
.................... void mode_iv_measure();
.................... #Separate
.................... void mode_iv_measure_voltage();
.................... 
.................... 
.................... 
.................... // Development command
.................... #Separate
.................... void mode_dev_vol();
.................... #Separate
.................... void mode_dev_cur();
.................... #Separate
.................... void mode_dev_temp();   
.................... #Separate
.................... void mode_dev_pd();
.................... #Separate
.................... void mode_dev_cigs();
.................... #Separate
.................... void mode_dev_time();
.................... #Separate
.................... void mode_dev_sweep();
.................... 
.................... // ______________CMD ID________________
.................... #define ID_SWEEP 0x01
.................... 
.................... // Flash command 
.................... #define ID_FLASH_ERASE_ALL 0xA0
.................... #define ID_FLASH_ERASE_1SECTOR 0xA1
.................... #define ID_FLASH_COPY_1SECTOR 0xA2
.................... #define ID_FLASH_WRITE_1SECTOR 0xA3
.................... #define ID_FLASH_FUNC2 0xA4
.................... #define ID_FLASH_READ 0xA5
.................... #define ID_FLASH_READ_ADDRESS 0xA6
.................... 
.................... // IV command
.................... #define ID_IV_MEASURE 0xB0
.................... #define ID_IV_MEASURE_VOLTAGE 0xB1
.................... 
.................... // Development command
.................... #define ID_DEV_VOL 0xC0
.................... #define ID_DEV_CUR 0xC1
.................... #define ID_DEV_TEMP 0xC1
.................... #define ID_DEV_PD 0xC2
.................... #define ID_DEV_CIGS 0xC3
.................... #define ID_DEV_TIME 0xC4
.................... #define ID_DEV_SWEEP 0xC5
.................... 
.................... #include "../mmj_cigs_mode.c"
.................... #include "include/mmj_cigs_func.h"
.................... #ifndef MMJ_CIGS_FUNC_H
.................... #define MMJ_CIGS_FUNC_H
.................... 
.................... /*
.................... // _________ values _________
.................... #define MISSION_DATA_SIZE 64
.................... volatile unsigned int8 mission_datas[MISSION_DATA_SIZE] = {0x00};
.................... volatile int8 executed_mission_count = 0;
.................... */
.................... 
.................... /*
.................... 
.................... // Packet format
.................... #define PACKET_SIZE 64
.................... #define CHECKSUM
.................... //volatile unsigned int8 PACKET_DATA[MISSION_DATA_SIZE] = {0x00};
.................... */
.................... 
.................... 
.................... 
.................... // _________ functions ____________
.................... #define DATA_BUFFER_SIZE 150
.................... #define HEADER_SIZE 12
.................... volatile unsigned int16 data_buffer[DATA_BUFFER_SIZE*2] = {0x00};
.................... volatile unsigned int8 cigs_data[DATA_BUFFER_SIZE*2] = {0x00};
.................... volatile unsigned int8 cigs_data_header[HEADER_SIZE] = {0x00};
.................... volatile unsigned int32 measured_time = 0;
.................... volatile unsigned int16 measured_pd_start = 0;
.................... volatile unsigned int16 measured_pd_end = 0;
.................... volatile unsigned int16 measured_temp_top = 0;
.................... volatile unsigned int16 measured_temp_bot = 0;
.................... 
.................... volatile unsigned int8 packet_data[64] = {0x00};
.................... 
.................... #separate
.................... void sweep(unsigned int8 parameter[]);
.................... 
.................... void convert_cigs_data(unsigned int8 measurement_step);
.................... void convert_header_data(void); 
.................... 
.................... 
.................... #include "../mmj_cigs_func.c"
.................... #include "include/mmj_cigs_config.h"
.................... #ifndef MMJ_CIGS_CONFIG_H
.................... #define MMJ_CIGS_CONFIG_H
.................... 
.................... #include <16F1789.h>
.................... 
.................... #device ADC=12
.................... #use delay(crystal=16MHz, clock=16MHz)
.................... #fuses NOMCLR
.................... 
.................... 
.................... 
.................... //#define SELF_DEVICE_ID CIGS_PIC
.................... 
.................... 
.................... //-------------Serial--------------------
.................... #use rs232(baud=9600,parity=N,xmit=PIN_C6,rcv=PIN_C7,bits=8,stream=BOSS)
.................... #use rs232(baud=9600,parity=N,xmit=PIN_B4,bits=8,stream=PC,FORCE_SW)
.................... 
.................... 
.................... #define SPI0_CS  PIN_D1
.................... #use spi(MASTER, CLK=PIN_C3, DI=PIN_C4, DO=PIN_C5, BAUD=400000, MODE=0, BITS=8, STREAM=MIS_FM_STREAM)
.................... // MISO PIN_C5, MOSI PIN_C4, SCK PIN_C3
.................... 
.................... 
.................... #define SPI1_CS PIN_C2
.................... #use spi(MASTER, SPI1, BAUD=400000, MODE=0, BITS=8, STREAM=SMF_STREAM)
.................... 
.................... 
.................... 
.................... //-------------I/O port--------------------
.................... // AI/O___ADC
.................... #define TEMP_TOP PIN_A5
.................... #define TEMP_BOT PIN_A3
.................... #define CIGS_VOLT PIN_A0 //PIN_A0
.................... #define CIGS_CURR PIN_A1
.................... #define PD PIN_E0
.................... 
.................... // AI/O___DAC
.................... #define LOAD PIN_A2
.................... 
.................... // DI/O___
.................... #define CIGS_CONNECT PIN_C0
.................... #define EN_NPWR PIN_C3  //Negative Power
.................... 
.................... 
.................... #endif // MMJ_CIGS_CONFIG_H
.................... 
.................... //------------------End of File------------------
.................... 
.................... //#include "include/mmj_cigs_func.h"
.................... 
.................... void io_init()
.................... {
....................     fprintf(PC, "IO Initialize\r\n");
*
0653:  MOVLW  CC
0654:  MOVLB  03
0655:  MOVWF  11
0656:  MOVLW  00
0657:  MOVWF  12
0658:  MOVLB  00
0659:  CALL   603
....................     output_low(CIGS_CONNECT);
065A:  MOVLB  01
065B:  BCF    0E.0
065C:  MOVLB  02
065D:  BCF    0E.0
....................     output_low(EN_NPWR);
065E:  MOVLB  01
065F:  BCF    0E.3
0660:  MOVLB  02
0661:  BCF    0E.3
....................     fprintf(PC, "\tComplete\r\n");
0662:  MOVLW  D4
0663:  MOVLB  03
0664:  MOVWF  11
0665:  MOVLW  00
0666:  MOVWF  12
0667:  MOVLB  00
0668:  CALL   603
0669:  MOVLP  10
066A:  GOTO   440 (RETURN)
.................... }
.................... 
.................... void adc_init()
.................... {
....................    fprintf(PC, "ADC Initialize\r\n");
066B:  MOVLW  DA
066C:  MOVLB  03
066D:  MOVWF  11
066E:  MOVLW  00
066F:  MOVWF  12
0670:  MOVLB  00
0671:  CALL   603
....................     //setup ADC
....................    setup_oscillator(OSC_16MHZ);   //oscillator speed (crystal)
0672:  MOVLW  78
0673:  MOVLB  01
0674:  MOVWF  19
....................    setup_adc_ports(CIGS_VOLT | CIGS_CURR | TEMP_BOT | TEMP_TOP | PD , VSS_VDD);
0675:  BCF    1E.0
0676:  BCF    1E.1
0677:  BCF    1E.2
0678:  MOVLW  00
0679:  MOVLB  03
067A:  MOVWF  0C
067B:  MOVWF  10
067C:  MOVWF  0D
067D:  MOVLW  E7
067E:  MOVWF  0F
....................    setup_adc(ADC_CLOCK_DIV_64);
067F:  MOVLB  01
0680:  BCF    1E.4
0681:  BSF    1E.5
0682:  BSF    1E.6
0683:  BSF    1E.7
0684:  BSF    1D.0
.................... 
....................    //setup DAC
....................    setup_dac(DAC_OUTPUT1 | DAC_VSS_VDD);                                        //DAC output at pin DAC output1 from 0-VDD volts  
0685:  MOVLW  A0
0686:  MOVLB  02
0687:  MOVWF  18
....................    dac_write(50);                                                               
0688:  MOVLW  32
0689:  MOVWF  19
....................    fprintf(PC, "\tComplete\r\n");
068A:  MOVLW  E3
068B:  MOVLB  03
068C:  MOVWF  11
068D:  MOVLW  00
068E:  MOVWF  12
068F:  MOVLB  00
0690:  CALL   603
0691:  MOVLP  10
0692:  GOTO   443 (RETURN)
.................... }
.................... 
.................... #Separate
.................... void sweep(unsigned int8 parameter)
.................... {
.................... 
....................     fprintf(PC, "Start SWEEP\r\n");
*
0BA9:  MOVLW  E9
0BAA:  MOVLB  03
0BAB:  MOVWF  11
0BAC:  MOVLW  00
0BAD:  MOVWF  12
0BAE:  MOVLP  00
0BAF:  MOVLB  00
0BB0:  CALL   603
0BB1:  MOVLP  08
....................     unsigned int8 measurement_step = parameter; // Get the measurement step from the parameter array
0BB2:  MOVLB  10
0BB3:  MOVF   42,W
0BB4:  MOVWF  43
....................     fprintf(PC, "\tSweep step : %u\r\n", measurement_step);
0BB5:  MOVLW  F0
0BB6:  MOVLB  03
0BB7:  MOVWF  11
0BB8:  MOVLW  00
0BB9:  MOVWF  12
0BBA:  BCF    03.0
0BBB:  MOVLW  0E
0BBC:  MOVLB  10
0BBD:  MOVWF  6C
0BBE:  MOVLP  00
0BBF:  MOVLB  00
0BC0:  CALL   78D
0BC1:  MOVLP  08
0BC2:  MOVLB  10
0BC3:  MOVF   43,W
0BC4:  MOVWF  46
0BC5:  MOVLW  1B
0BC6:  MOVWF  47
*
0C10:  MOVLW  0D
0C11:  MOVLB  11
0C12:  MOVWF  20
0C13:  MOVLP  00
0C14:  MOVLB  00
0C15:  CALL   5DE
0C16:  MOVLP  08
0C17:  MOVLW  0A
0C18:  MOVLB  11
0C19:  MOVWF  20
0C1A:  MOVLP  00
0C1B:  MOVLB  00
0C1C:  CALL   5DE
0C1D:  MOVLP  08
....................     output_high(CIGS_CONNECT);
0C1E:  MOVLB  01
0C1F:  BCF    0E.0
0C20:  MOVLB  02
0C21:  BSF    0E.0
.................... 
....................     // read temperature
....................     set_adc_channel(TEMP_TOP);
0C22:  MOVLW  14
0C23:  MOVWF  78
0C24:  MOVLB  01
0C25:  MOVF   1D,W
0C26:  ANDLW  83
0C27:  IORWF  78,W
0C28:  MOVWF  1D
0C29:  MOVLW  0F
0C2A:  MOVWF  78
0C2B:  MOVF   1F,W
0C2C:  ANDLW  F0
0C2D:  IORWF  78,W
0C2E:  MOVWF  1F
....................     delay_us(10); // wait for the ADC to stabilize
0C2F:  MOVLW  0D
0C30:  MOVWF  77
0C31:  DECFSZ 77,F
0C32:  GOTO   431
....................     measured_temp_top = read_adc(ADC_START_AND_READ); // read voltage at adc pin
0C33:  BSF    1D.1
0C34:  BTFSC  1D.1
0C35:  GOTO   434
0C36:  MOVF   1B,W
0C37:  MOVWF  78
0C38:  MOVF   1C,W
0C39:  MOVLB  0C
0C3A:  MOVWF  32
0C3B:  MOVF   78,W
0C3C:  MOVWF  31
....................     set_adc_channel(TEMP_BOT);
0C3D:  MOVLW  0C
0C3E:  MOVWF  78
0C3F:  MOVLB  01
0C40:  MOVF   1D,W
0C41:  ANDLW  83
0C42:  IORWF  78,W
0C43:  MOVWF  1D
0C44:  MOVLW  0F
0C45:  MOVWF  78
0C46:  MOVF   1F,W
0C47:  ANDLW  F0
0C48:  IORWF  78,W
0C49:  MOVWF  1F
....................     delay_us(10); // wait for the ADC to stabilize
0C4A:  MOVLW  0D
0C4B:  MOVWF  77
0C4C:  DECFSZ 77,F
0C4D:  GOTO   44C
....................     measured_temp_bot = read_adc(ADC_START_AND_READ); // read voltage at adc pin
0C4E:  BSF    1D.1
0C4F:  BTFSC  1D.1
0C50:  GOTO   44F
0C51:  MOVF   1B,W
0C52:  MOVWF  78
0C53:  MOVF   1C,W
0C54:  MOVLB  0C
0C55:  MOVWF  34
0C56:  MOVF   78,W
0C57:  MOVWF  33
.................... 
....................     // read PD value
....................     set_adc_channel(PD);
0C58:  MOVLW  00
0C59:  MOVWF  78
0C5A:  MOVLB  01
0C5B:  MOVF   1D,W
0C5C:  ANDLW  83
0C5D:  IORWF  78,W
0C5E:  MOVWF  1D
0C5F:  MOVLW  0F
0C60:  MOVWF  78
0C61:  MOVF   1F,W
0C62:  ANDLW  F0
0C63:  IORWF  78,W
0C64:  MOVWF  1F
....................     delay_us(10); // wait for the ADC to stabilize
0C65:  MOVLW  0D
0C66:  MOVWF  77
0C67:  DECFSZ 77,F
0C68:  GOTO   467
....................     measured_pd_start = read_adc(ADC_START_AND_READ); // read voltage at adc pin
0C69:  BSF    1D.1
0C6A:  BTFSC  1D.1
0C6B:  GOTO   46A
0C6C:  MOVF   1B,W
0C6D:  MOVWF  78
0C6E:  MOVF   1C,W
0C6F:  MOVLB  0C
0C70:  MOVWF  2E
0C71:  MOVF   78,W
0C72:  MOVWF  2D
....................     
....................     // read timestamp
....................     //measured_time = timer0_get_time(); // read time from timer0
.................... 
....................     // CIGS value
....................     for (unsigned int16 count = 0; count < measurement_step; count++)
0C73:  MOVLB  10
0C74:  CLRF   45
0C75:  CLRF   44
0C76:  MOVF   45,F
0C77:  BTFSS  03.2
0C78:  GOTO   4E0
0C79:  MOVF   43,W
0C7A:  SUBWF  44,W
0C7B:  BTFSC  03.0
0C7C:  GOTO   4E0
....................     {    
....................         // set DAC value
....................         dac_write(count);
0C7D:  MOVF   44,W
0C7E:  MOVLB  02
0C7F:  MOVWF  19
....................         delay_us(100); // wait for the DAC to stabilize
0C80:  MOVLW  85
0C81:  MOVWF  77
0C82:  DECFSZ 77,F
0C83:  GOTO   482
.................... 
....................         // read CIGS voltage and current
....................         set_adc_channel(CIGS_VOLT);       
0C84:  MOVLW  00
0C85:  MOVWF  78
0C86:  MOVLB  01
0C87:  MOVF   1D,W
0C88:  ANDLW  83
0C89:  IORWF  78,W
0C8A:  MOVWF  1D
0C8B:  MOVLW  0F
0C8C:  MOVWF  78
0C8D:  MOVF   1F,W
0C8E:  ANDLW  F0
0C8F:  IORWF  78,W
0C90:  MOVWF  1F
....................         delay_us(10); // wait for the ADC to stabilize
0C91:  MOVLW  0D
0C92:  MOVWF  77
0C93:  DECFSZ 77,F
0C94:  GOTO   493
....................         data_buffer[count*2] = read_adc(ADC_START_AND_READ);  // read voltage at adc pin
0C95:  BCF    03.0
0C96:  MOVLB  10
0C97:  RLF    44,W
0C98:  MOVWF  46
0C99:  RLF    45,W
0C9A:  MOVWF  47
0C9B:  BCF    03.0
0C9C:  RLF    46,W
0C9D:  MOVWF  79
0C9E:  RLF    47,W
0C9F:  MOVWF  7A
0CA0:  MOVF   79,W
0CA1:  ADDLW  39
0CA2:  MOVWF  04
0CA3:  MOVLW  20
0CA4:  ADDWFC 7A,W
0CA5:  MOVWF  05
0CA6:  MOVLB  01
0CA7:  BSF    1D.1
0CA8:  BTFSC  1D.1
0CA9:  GOTO   4A8
0CAA:  MOVF   1B,W
0CAB:  MOVWF  00
0CAC:  MOVF   1C,W
0CAD:  MOVWI  W,[FSR0+01]
....................         set_adc_channel(CIGS_CURR);
0CAE:  MOVLW  04
0CAF:  MOVWF  78
0CB0:  MOVF   1D,W
0CB1:  ANDLW  83
0CB2:  IORWF  78,W
0CB3:  MOVWF  1D
0CB4:  MOVLW  0F
0CB5:  MOVWF  78
0CB6:  MOVF   1F,W
0CB7:  ANDLW  F0
0CB8:  IORWF  78,W
0CB9:  MOVWF  1F
....................         delay_us(10); // wait for the ADC to stabilize
0CBA:  MOVLW  0D
0CBB:  MOVWF  77
0CBC:  DECFSZ 77,F
0CBD:  GOTO   4BC
....................         data_buffer[count*2+1] = read_adc(ADC_START_AND_READ); // read voltage at adc pin
0CBE:  BCF    03.0
0CBF:  MOVLB  10
0CC0:  RLF    44,W
0CC1:  MOVWF  46
0CC2:  RLF    45,W
0CC3:  MOVWF  47
0CC4:  MOVLW  01
0CC5:  ADDWF  46,F
0CC6:  MOVLW  00
0CC7:  ADDWFC 47,F
0CC8:  BCF    03.0
0CC9:  RLF    46,W
0CCA:  MOVWF  79
0CCB:  RLF    47,W
0CCC:  MOVWF  7A
0CCD:  MOVF   79,W
0CCE:  ADDLW  39
0CCF:  MOVWF  04
0CD0:  MOVLW  20
0CD1:  ADDWFC 7A,W
0CD2:  MOVWF  05
0CD3:  MOVLB  01
0CD4:  BSF    1D.1
0CD5:  BTFSC  1D.1
0CD6:  GOTO   4D5
0CD7:  MOVF   1B,W
0CD8:  MOVWF  00
0CD9:  MOVF   1C,W
0CDA:  MOVWI  W,[FSR0+01]
0CDB:  MOVLB  10
0CDC:  INCF   44,F
0CDD:  BTFSC  03.2
0CDE:  INCF   45,F
0CDF:  GOTO   476
....................     }
.................... 
....................     fprintf(PC, "END SWEEP\r\n");
0CE0:  MOVLW  FA
0CE1:  MOVLB  03
0CE2:  MOVWF  11
0CE3:  MOVLW  00
0CE4:  MOVWF  12
0CE5:  MOVLP  00
0CE6:  MOVLB  00
0CE7:  CALL   603
0CE8:  MOVLP  08
....................     // read PD value
....................     set_adc_channel(PD);
0CE9:  MOVLW  00
0CEA:  MOVWF  78
0CEB:  MOVLB  01
0CEC:  MOVF   1D,W
0CED:  ANDLW  83
0CEE:  IORWF  78,W
0CEF:  MOVWF  1D
0CF0:  MOVLW  0F
0CF1:  MOVWF  78
0CF2:  MOVF   1F,W
0CF3:  ANDLW  F0
0CF4:  IORWF  78,W
0CF5:  MOVWF  1F
....................     measured_pd_end = read_adc(ADC_START_AND_READ); // read voltage at adc pin
0CF6:  BSF    1D.1
0CF7:  BTFSC  1D.1
0CF8:  GOTO   4F7
0CF9:  MOVF   1B,W
0CFA:  MOVWF  78
0CFB:  MOVF   1C,W
0CFC:  MOVLB  0C
0CFD:  MOVWF  30
0CFE:  MOVF   78,W
0CFF:  MOVWF  2F
.................... 
....................     convert_cigs_data(measurement_step);
0D00:  MOVLB  10
0D01:  MOVF   43,W
0D02:  MOVWF  46
....................     //convert_header_data();    
....................     output_low(CIGS_CONNECT);
*
0E4B:  MOVLB  01
0E4C:  BCF    0E.0
0E4D:  MOVLB  02
0E4E:  BCF    0E.0
0E4F:  MOVLP  08
0E50:  MOVLB  00
0E51:  GOTO   666 (RETURN)
.................... }
.................... 
.................... 
.................... void convert_cigs_data(unsigned int8 measurement_step)
.................... {
....................     fprintf(PC, "Logged CIGS data\r\n");
*
0D03:  MOVLW  00
0D04:  MOVLB  03
0D05:  MOVWF  11
0D06:  MOVLW  01
0D07:  MOVWF  12
0D08:  MOVLP  00
0D09:  MOVLB  00
0D0A:  CALL   603
0D0B:  MOVLP  08
....................     // unsigned int8 measurement_step = 100;
....................     // Save CIGS data to memory
....................     for (unsigned int8 i = 0; i < measurement_step; i++)
0D0C:  MOVLB  10
0D0D:  CLRF   47
0D0E:  MOVF   46,W
0D0F:  SUBWF  47,W
0D10:  BTFSC  03.0
0D11:  GOTO   63D
....................     {
....................         cigs_data[i*3]      = (data_buffer[i*2] >> 4) & 0xFF;
0D12:  MOVF   47,W
0D13:  MOVWF  4C
0D14:  MOVLW  03
0D15:  MOVWF  4D
0D16:  MOVLB  00
0D17:  CALL   382
0D18:  MOVLW  91
0D19:  ADDWF  78,W
0D1A:  MOVWF  78
0D1B:  MOVLW  22
0D1C:  MOVWF  7A
0D1D:  BTFSC  03.0
0D1E:  INCF   7A,F
0D1F:  MOVF   78,W
0D20:  MOVLB  10
0D21:  MOVWF  4C
0D22:  MOVF   7A,W
0D23:  MOVWF  4D
0D24:  BCF    03.0
0D25:  RLF    47,W
0D26:  CLRF   7A
0D27:  MOVWF  79
0D28:  BCF    03.0
0D29:  RLF    79,F
0D2A:  RLF    7A,F
0D2B:  MOVF   79,W
0D2C:  ADDLW  39
0D2D:  MOVWF  04
0D2E:  MOVLW  20
0D2F:  ADDWFC 7A,W
0D30:  MOVWF  05
0D31:  MOVF   00,W
0D32:  MOVWF  4E
0D33:  ADDFSR 01,FSR0
0D34:  MOVF   00,W
0D35:  MOVWF  4F
0D36:  ADDFSR 3F,FSR0
0D37:  RRF    4F,F
0D38:  RRF    4E,F
0D39:  RRF    4F,F
0D3A:  RRF    4E,F
0D3B:  RRF    4F,F
0D3C:  RRF    4E,F
0D3D:  RRF    4F,F
0D3E:  RRF    4E,F
0D3F:  MOVLW  0F
0D40:  ANDWF  4F,F
0D41:  MOVF   4E,W
0D42:  MOVWF  77
0D43:  CLRF   7A
0D44:  MOVF   7A,W
0D45:  MOVWF  4F
0D46:  MOVF   4D,W
0D47:  MOVWF  05
0D48:  MOVF   4C,W
0D49:  MOVWF  04
0D4A:  MOVF   4E,W
0D4B:  MOVWF  00
....................         fprintf(PC, "%X ", cigs_data[i*3]);
0D4C:  MOVF   47,W
0D4D:  MOVWF  4C
0D4E:  MOVLW  03
0D4F:  MOVWF  4D
0D50:  MOVLB  00
0D51:  CALL   382
0D52:  MOVLW  91
0D53:  ADDWF  78,W
0D54:  MOVWF  04
0D55:  MOVLW  22
0D56:  MOVWF  05
0D57:  BTFSC  03.0
0D58:  INCF   05,F
0D59:  MOVF   00,W
0D5A:  MOVLB  10
0D5B:  MOVWF  4C
0D5C:  MOVWF  6C
0D5D:  MOVLW  37
0D5E:  MOVWF  6D
0D5F:  MOVLP  00
0D60:  MOVLB  00
0D61:  CALL   6E7
0D62:  MOVLP  08
0D63:  MOVLW  20
0D64:  MOVLB  11
0D65:  MOVWF  20
0D66:  MOVLP  00
0D67:  MOVLB  00
0D68:  CALL   5DE
0D69:  MOVLP  08
....................         cigs_data[i*3+1]    = (data_buffer[i*2] & 0x0F) << 4 | (data_buffer[i*2+1] >>8 )& 0x0F;
0D6A:  MOVLB  10
0D6B:  MOVF   47,W
0D6C:  MOVWF  4C
0D6D:  MOVLW  03
0D6E:  MOVWF  4D
0D6F:  MOVLB  00
0D70:  CALL   382
0D71:  MOVLW  01
0D72:  ADDWF  78,W
0D73:  ADDLW  91
0D74:  MOVWF  78
0D75:  MOVLW  22
0D76:  MOVWF  7A
0D77:  BTFSC  03.0
0D78:  INCF   7A,F
0D79:  MOVF   78,W
0D7A:  MOVLB  10
0D7B:  MOVWF  4C
0D7C:  MOVF   7A,W
0D7D:  MOVWF  4D
0D7E:  BCF    03.0
0D7F:  RLF    47,W
0D80:  CLRF   7A
0D81:  MOVWF  79
0D82:  BCF    03.0
0D83:  RLF    79,F
0D84:  RLF    7A,F
0D85:  MOVF   79,W
0D86:  ADDLW  39
0D87:  MOVWF  04
0D88:  MOVLW  20
0D89:  ADDWFC 7A,W
0D8A:  MOVWF  05
0D8B:  MOVF   00,W
0D8C:  MOVWF  4E
0D8D:  ADDFSR 01,FSR0
0D8E:  MOVF   00,W
0D8F:  MOVWF  4F
0D90:  ADDFSR 3F,FSR0
0D91:  MOVLW  0F
0D92:  ANDWF  4E,F
0D93:  CLRF   4F
0D94:  RLF    4E,F
0D95:  RLF    4F,F
0D96:  RLF    4E,F
0D97:  RLF    4F,F
0D98:  RLF    4E,F
0D99:  RLF    4F,F
0D9A:  RLF    4E,F
0D9B:  RLF    4F,F
0D9C:  MOVLW  F0
0D9D:  ANDWF  4E,F
0D9E:  BCF    03.0
0D9F:  RLF    47,W
0DA0:  ADDLW  01
0DA1:  CLRF   7A
0DA2:  MOVWF  79
0DA3:  BCF    03.0
0DA4:  RLF    79,F
0DA5:  RLF    7A,F
0DA6:  MOVF   79,W
0DA7:  ADDLW  39
0DA8:  MOVWF  04
0DA9:  MOVLW  20
0DAA:  ADDWFC 7A,W
0DAB:  MOVWF  05
0DAC:  MOVF   00,W
0DAD:  MOVWF  50
0DAE:  ADDFSR 01,FSR0
0DAF:  MOVF   00,W
0DB0:  MOVWF  51
0DB1:  ADDFSR 3F,FSR0
0DB2:  MOVF   51,W
0DB3:  MOVWF  50
0DB4:  CLRF   51
0DB5:  MOVF   50,W
0DB6:  ANDLW  0F
0DB7:  MOVWF  77
0DB8:  CLRF   7A
0DB9:  MOVF   77,W
0DBA:  IORWF  4E,W
0DBB:  MOVWF  77
0DBC:  MOVF   7A,W
0DBD:  IORWF  4F,W
0DBE:  MOVWF  7A
0DBF:  MOVF   77,W
0DC0:  MOVWF  4E
0DC1:  MOVF   7A,W
0DC2:  MOVWF  4F
0DC3:  MOVF   4D,W
0DC4:  MOVWF  05
0DC5:  MOVF   4C,W
0DC6:  MOVWF  04
0DC7:  MOVF   4E,W
0DC8:  MOVWF  00
....................         fprintf(PC, "%X ", cigs_data[i*3+1]);
0DC9:  MOVF   47,W
0DCA:  MOVWF  4C
0DCB:  MOVLW  03
0DCC:  MOVWF  4D
0DCD:  MOVLB  00
0DCE:  CALL   382
0DCF:  MOVLW  01
0DD0:  ADDWF  78,W
0DD1:  ADDLW  91
0DD2:  MOVWF  04
0DD3:  MOVLW  22
0DD4:  MOVWF  05
0DD5:  BTFSC  03.0
0DD6:  INCF   05,F
0DD7:  MOVF   00,W
0DD8:  MOVLB  10
0DD9:  MOVWF  4C
0DDA:  MOVWF  6C
0DDB:  MOVLW  37
0DDC:  MOVWF  6D
0DDD:  MOVLP  00
0DDE:  MOVLB  00
0DDF:  CALL   6E7
0DE0:  MOVLP  08
0DE1:  MOVLW  20
0DE2:  MOVLB  11
0DE3:  MOVWF  20
0DE4:  MOVLP  00
0DE5:  MOVLB  00
0DE6:  CALL   5DE
0DE7:  MOVLP  08
....................         cigs_data[i*3+2]    = data_buffer[i*2+1] & 0xFF;
0DE8:  MOVLB  10
0DE9:  MOVF   47,W
0DEA:  MOVWF  4C
0DEB:  MOVLW  03
0DEC:  MOVWF  4D
0DED:  MOVLB  00
0DEE:  CALL   382
0DEF:  MOVLW  02
0DF0:  ADDWF  78,W
0DF1:  ADDLW  91
0DF2:  MOVWF  78
0DF3:  MOVLW  22
0DF4:  MOVWF  7A
0DF5:  BTFSC  03.0
0DF6:  INCF   7A,F
0DF7:  MOVF   78,W
0DF8:  MOVLB  10
0DF9:  MOVWF  4C
0DFA:  MOVF   7A,W
0DFB:  MOVWF  4D
0DFC:  BCF    03.0
0DFD:  RLF    47,W
0DFE:  ADDLW  01
0DFF:  CLRF   7A
0E00:  MOVWF  79
0E01:  BCF    03.0
0E02:  RLF    79,F
0E03:  RLF    7A,F
0E04:  MOVF   79,W
0E05:  ADDLW  39
0E06:  MOVWF  04
0E07:  MOVLW  20
0E08:  ADDWFC 7A,W
0E09:  MOVWF  05
0E0A:  MOVF   00,W
0E0B:  MOVWF  4E
0E0C:  ADDFSR 01,FSR0
0E0D:  MOVF   00,W
0E0E:  MOVWF  4F
0E0F:  ADDFSR 3F,FSR0
0E10:  MOVF   4E,W
0E11:  MOVWF  77
0E12:  CLRF   7A
0E13:  MOVF   7A,W
0E14:  MOVWF  4F
0E15:  MOVF   4D,W
0E16:  MOVWF  05
0E17:  MOVF   4C,W
0E18:  MOVWF  04
0E19:  MOVF   4E,W
0E1A:  MOVWF  00
....................         fprintf(PC, "%X ", cigs_data[i*3+2]);
0E1B:  MOVF   47,W
0E1C:  MOVWF  4C
0E1D:  MOVLW  03
0E1E:  MOVWF  4D
0E1F:  MOVLB  00
0E20:  CALL   382
0E21:  MOVLW  02
0E22:  ADDWF  78,W
0E23:  ADDLW  91
0E24:  MOVWF  04
0E25:  MOVLW  22
0E26:  MOVWF  05
0E27:  BTFSC  03.0
0E28:  INCF   05,F
0E29:  MOVF   00,W
0E2A:  MOVLB  10
0E2B:  MOVWF  4C
0E2C:  MOVWF  6C
0E2D:  MOVLW  37
0E2E:  MOVWF  6D
0E2F:  MOVLP  00
0E30:  MOVLB  00
0E31:  CALL   6E7
0E32:  MOVLP  08
0E33:  MOVLW  20
0E34:  MOVLB  11
0E35:  MOVWF  20
0E36:  MOVLP  00
0E37:  MOVLB  00
0E38:  CALL   5DE
0E39:  MOVLP  08
0E3A:  MOVLB  10
0E3B:  INCF   47,F
0E3C:  GOTO   50E
....................     }
....................     /*
....................     fprintf(PC, "Logging CIGS data\r\n");
....................     for (unsigned int16 j = 0; j < measurement_step*3; j++)
....................     {
....................         fprintf(PC, "%X ", cigs_data[j]);
....................     }
....................     */
....................    fprintf(PC, "\r\n");
0E3D:  MOVLW  0D
0E3E:  MOVLB  11
0E3F:  MOVWF  20
0E40:  MOVLP  00
0E41:  MOVLB  00
0E42:  CALL   5DE
0E43:  MOVLP  08
0E44:  MOVLW  0A
0E45:  MOVLB  11
0E46:  MOVWF  20
0E47:  MOVLP  00
0E48:  MOVLB  00
0E49:  CALL   5DE
0E4A:  MOVLP  08
.................... }
.................... 
.................... 
.................... void convert_header_data()
.................... {    
....................     // Save CIGS data header
....................     cigs_data_header[0] = 0xFF; // Header start
....................     cigs_data_header[1] = 0x0F; // Header start
.................... 
....................     // Save measurement start time
....................     cigs_data_header[2] = measured_time & 0xFF;         // Extract the lower 8 bits
....................     cigs_data_header[3] = (measured_time >> 8) & 0xFF;  //
....................     cigs_data_header[4] = (measured_time >> 16) & 0xFF;
.................... 
.................... 
....................     // Save measurement PD value & Mode Data 
....................     cigs_data_header[5] = measured_pd_start & 0xFF;
....................     cigs_data_header[6] = ((measured_pd_start & 0x0F) << 4) | ((measured_pd_end >> 8) & 0x0F);
....................     cigs_data_header[7] = measured_pd_end >> 4 & 0xFF;
....................     
....................     // Save measurement Temp value
....................     cigs_data_header[8] = measured_pd_start & 0xFF;
....................     cigs_data_header[9] = ((measured_pd_start & 0x0F) << 4) | ((measured_pd_end >> 8) & 0x0F);
....................     cigs_data_header[10] = measured_pd_end >> 4 & 0xFF;
.................... 
....................     cigs_data_header[11] = 0x00; // Header end
.................... }
.................... 
.................... 
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... #include "./lib/smf_queue.h"
.................... #ifndef SMF_QUEUE_H
.................... #define SMF_QUEUE_H
.................... 
.................... // ______________ defines (typedef) ____________
.................... 
.................... typedef struct {
....................     unsigned int32 src;
....................     unsigned int32 dest;
....................     unsigned int32 size;
.................... } SmfDataStruct;
.................... 
.................... #define SMF_DATA_SIZE 16
.................... typedef struct {
....................    SmfDataStruct smf_data[SMF_DATA_SIZE];
....................    int8 smf_data_head;
....................    int8 smf_data_tail;
.................... } SmfQueueStruct;
.................... 
.................... // _____________________ values _________________
.................... 
.................... volatile SmfQueueStruct smf_queue = {0};
.................... 
.................... 
.................... // ___________________ functions ________________
.................... 
.................... void enqueue_smf_data(SmfDataStruct *data);
.................... 
.................... SmfDataStruct *dequeue_smf_data();
.................... 
.................... int1 is_empty_smf_data(void);
.................... 
.................... 
.................... 
.................... #include "src/smf_queue.c"
.................... void enqueue_smf_data(SmfDataStruct *data)
.................... {   
....................    int8 next_tail = (smf_queue.smf_data_tail + 1) % SMF_DATA_SIZE;
.................... 
....................    if(next_tail == smf_queue.smf_data_head)
....................       fprintf(PC, "SMF data list is full!!!\r\n");
....................       
....................    else
....................    {
....................       smf_queue.smf_data[smf_queue.smf_data_tail].dest = data->dest;
....................       smf_queue.smf_data[smf_queue.smf_data_tail].src = data->src;
....................       smf_queue.smf_data[smf_queue.smf_data_tail].size = data->size;
.................... 
....................       smf_queue.smf_data_tail = next_tail;
....................    }
.................... }
.................... 
.................... SmfDataStruct *dequeue_smf_data()
.................... {
....................    if (smf_queue.smf_data_head == smf_queue.smf_data_tail)
*
11E2:  MOVLB  0F
11E3:  MOVF   46,W
11E4:  SUBWF  45,W
11E5:  BTFSS  03.2
11E6:  GOTO   1F6
....................    {
....................       fprintf(PC, "SMF data list is empty\r\n");
11E7:  MOVLW  18
11E8:  MOVLB  03
11E9:  MOVWF  11
11EA:  MOVLW  01
11EB:  MOVWF  12
11EC:  MOVLP  00
11ED:  MOVLB  00
11EE:  CALL   603
11EF:  MOVLP  10
....................       return 0x00;
11F0:  MOVLW  00
11F1:  MOVWF  78
11F2:  MOVWF  79
11F3:  GOTO   211
....................    }
11F4:  GOTO   211
11F5:  MOVLB  0F
....................    else
....................    {
....................       int8 current_head = smf_queue.smf_data_head;
11F6:  MOVF   45,W
11F7:  MOVLB  10
11F8:  MOVWF  3C
....................       smf_queue.smf_data_head = (smf_queue.smf_data_head + 1) % SMF_DATA_SIZE;
11F9:  MOVLW  01
11FA:  MOVLB  0F
11FB:  ADDWF  45,W
11FC:  ANDLW  0F
11FD:  MOVWF  45
....................       return &smf_queue.smf_data[current_head];
11FE:  MOVLB  10
11FF:  MOVF   3C,W
1200:  MOVWF  4C
1201:  MOVLW  0C
1202:  MOVWF  4D
1203:  MOVLP  08
1204:  MOVLB  00
1205:  CALL   382
1206:  MOVLP  10
1207:  MOVF   78,W
1208:  ADDLW  15
1209:  MOVWF  78
120A:  MOVLW  24
120B:  MOVWF  7A
120C:  BTFSC  03.0
120D:  INCF   7A,F
120E:  MOVF   7A,W
120F:  MOVWF  79
1210:  GOTO   211
....................    }
.................... }
.................... 
.................... int1 is_empty_smf_data(void)
.................... {
....................    return smf_queue.smf_data_head == smf_queue.smf_data_tail;
*
0E68:  MOVLB  0F
0E69:  MOVF   46,W
0E6A:  SUBWF  45,W
0E6B:  BTFSC  03.2
0E6C:  GOTO   66F
0E6D:  MOVLW  00
0E6E:  GOTO   670
0E6F:  MOVLW  01
0E70:  MOVWF  78
0E71:  MOVLB  00
0E72:  RETURN
.................... }
.................... 
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... #include "./lib/flash.h"
.................... #ifndef FLASH_H
.................... #define FLASH_H
.................... ///////////////////////////////////////////////////////////////////////////////
.................... /////////////////////////GDNS_226_FlashOperation.h/////////////////////////////
.................... //////////////////////////////////ver 2.0//////////////////////////////////////
.................... /////////////////////////////last editor:T Kawai///////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... #define DEBUG
.................... //////////////////////////////port select//////////////////////////////////////
.................... #ifdef DEBUG
....................    #define DEBUG_PORT pc
.................... #endif
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define SPI STREAM////////////////////////////////
.................... #define FLASH_STREAM0 MIS_FM_STREAM     // <- Align the names to `config.h` Stream name
.................... #define FLASH_STREAM1 SMF_STREAM
.................... #define FLASH_STREAM2 SMF_STREAM // dont use
.................... #define FLASH_STREAM3 SMF_STREAM // dont use
.................... typedef enum spi_stream{
....................    SPI_0,
....................    SPI_1,
....................    SPI_2,
....................    SPI_3,
.................... }SpiStreamId;
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define Model name////////////////////////////////
.................... #define MT25QL128ABA 0x00     //Mission Flash
.................... #define MT25QL01GBBB 0x01     //SMF,CF
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////define structure member/////////////////////////////
.................... typedef struct select_stream_to_flash{
....................    SpiStreamId spi_stream_id;
....................    unsigned int8 flash_model;
....................    int16 cs_pin;
.................... }Flash;
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////    values    //////////////////////////////////////
.................... 
.................... Flash mis_fm = {SPI_0, MT25QL128ABA, SPI0_CS};
.................... Flash smf = {SPI_1, MT25QL01GBBB, SPI1_CS};
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////////////////CMD List///////////////////////////////////////
.................... #define CMD_READ_ID                     0x9F
.................... #define CMD_READ_STATUS_REGISTER        0x05
.................... #define CMD_READ                        0x03//for MT25QL128ABA
.................... #define CMD_4BYTE_READ                  0x13//for MT25QL01GBBB
.................... #define CMD_WRITE_ENABLE                0x06
.................... #define CMD_PAGE_PROGRAM                0x02//for MT25QL128ABA
.................... #define CMD_4BYTE_PAGE_PROGRAM          0x12//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_4KB_ERASE         0x20//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_4KB_ERASE   0x21//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_32KB_ERASE        0x52//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_32KB_ERASE  0x5C//for MT25QL01GBBB
.................... #define CMD_SECTOR_ERASE                0xD8//for MT25QL128ABA
.................... #define CMD_4BYTE_SECTOR_ERASE          0xDC//for MT25QL01GBBB
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////function List///////////////////////////////////////
.................... //higher all spi csPINs
.................... void flash_setting(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //bit[7:2]status register control bit,bit[1]write enable bit T:ennable F:disable,bit[0]write in progress bit T:busy F:ready
.................... int8 status_register(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //T:Flash id read successfully(connect OK),F:Flash id read failed
.................... int8 read_id(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //64kByte erase
.................... void sector_erase(Flash flash_stream, unsigned int32 sector_address);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //32kByte erase
.................... void subsector_32kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //4kByte erase
.................... void subsector_4kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                  
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read 1 Byte data
.................... int8 read_data_byte(Flash flash_stream, unsigned int32 read_address);                                               
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read multi Bytes data(max 128 MByte) and store to "read_data"
.................... void read_data_bytes(Flash flash_stream, unsigned int32 read_start_address, int8 *read_data, unsigned int32 read_amount);        
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write 1 Byte data to flash
.................... void write_data_byte(Flash flash_stream, unsigned int32 write_address,int8 write_data);                             
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write multi Bytes data(max256 Byte) in "write_data" to flash
.................... void write_data_bytes(Flash flash_stream, unsigned int32 write_start_address, int8 *write_data, unsigned int16 write_amount);              
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////end of GDNS_226_FlashOperation.h///////////////////////////
.................... #include "src/flash.c"
.................... #include "../flash.h"
.................... #ifndef FLASH_H
.................... #define FLASH_H
.................... ///////////////////////////////////////////////////////////////////////////////
.................... /////////////////////////GDNS_226_FlashOperation.h/////////////////////////////
.................... //////////////////////////////////ver 2.0//////////////////////////////////////
.................... /////////////////////////////last editor:T Kawai///////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... #define DEBUG
.................... //////////////////////////////port select//////////////////////////////////////
.................... #ifdef DEBUG
....................    #define DEBUG_PORT pc
.................... #endif
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define SPI STREAM////////////////////////////////
.................... #define FLASH_STREAM0 MIS_FM_STREAM     // <- Align the names to `config.h` Stream name
.................... #define FLASH_STREAM1 SMF_STREAM
.................... #define FLASH_STREAM2 SMF_STREAM // dont use
.................... #define FLASH_STREAM3 SMF_STREAM // dont use
.................... typedef enum spi_stream{
....................    SPI_0,
....................    SPI_1,
....................    SPI_2,
....................    SPI_3,
.................... }SpiStreamId;
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define Model name////////////////////////////////
.................... #define MT25QL128ABA 0x00     //Mission Flash
.................... #define MT25QL01GBBB 0x01     //SMF,CF
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////define structure member/////////////////////////////
.................... typedef struct select_stream_to_flash{
....................    SpiStreamId spi_stream_id;
....................    unsigned int8 flash_model;
....................    int16 cs_pin;
.................... }Flash;
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////    values    //////////////////////////////////////
.................... 
.................... Flash mis_fm = {SPI_0, MT25QL128ABA, SPI0_CS};
.................... Flash smf = {SPI_1, MT25QL01GBBB, SPI1_CS};
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////////////////CMD List///////////////////////////////////////
.................... #define CMD_READ_ID                     0x9F
.................... #define CMD_READ_STATUS_REGISTER        0x05
.................... #define CMD_READ                        0x03//for MT25QL128ABA
.................... #define CMD_4BYTE_READ                  0x13//for MT25QL01GBBB
.................... #define CMD_WRITE_ENABLE                0x06
.................... #define CMD_PAGE_PROGRAM                0x02//for MT25QL128ABA
.................... #define CMD_4BYTE_PAGE_PROGRAM          0x12//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_4KB_ERASE         0x20//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_4KB_ERASE   0x21//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_32KB_ERASE        0x52//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_32KB_ERASE  0x5C//for MT25QL01GBBB
.................... #define CMD_SECTOR_ERASE                0xD8//for MT25QL128ABA
.................... #define CMD_4BYTE_SECTOR_ERASE          0xDC//for MT25QL01GBBB
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////function List///////////////////////////////////////
.................... //higher all spi csPINs
.................... void flash_setting(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //bit[7:2]status register control bit,bit[1]write enable bit T:ennable F:disable,bit[0]write in progress bit T:busy F:ready
.................... int8 status_register(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //T:Flash id read successfully(connect OK),F:Flash id read failed
.................... int8 read_id(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //64kByte erase
.................... void sector_erase(Flash flash_stream, unsigned int32 sector_address);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //32kByte erase
.................... void subsector_32kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //4kByte erase
.................... void subsector_4kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                  
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read 1 Byte data
.................... int8 read_data_byte(Flash flash_stream, unsigned int32 read_address);                                               
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read multi Bytes data(max 128 MByte) and store to "read_data"
.................... void read_data_bytes(Flash flash_stream, unsigned int32 read_start_address, int8 *read_data, unsigned int32 read_amount);        
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write 1 Byte data to flash
.................... void write_data_byte(Flash flash_stream, unsigned int32 write_address,int8 write_data);                             
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write multi Bytes data(max256 Byte) in "write_data" to flash
.................... void write_data_bytes(Flash flash_stream, unsigned int32 write_start_address, int8 *write_data, unsigned int16 write_amount);              
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////end of GDNS_226_FlashOperation.h///////////////////////////
.................... #include "src/flash.c"
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////GDNS_226_FlashOperation.c////////////////////////////
.................... //////////////////////////////////ver 2.2//////////////////////////////////////
.................... /////////////////////////////last editor:T Kawai///////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////redefinition of spi communication///////////////////////
.................... //send multi bytes
.................... void spi_xfer_select_stream(Flash flash_stream, int8 *write_data, unsigned int16 write_amount){
....................    switch(flash_stream.spi_stream_id){
....................       case SPI_0:
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM0,write_data[spi_xfer_num]);
....................          break;
....................          
....................       case SPI_1:
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM1,write_data[spi_xfer_num]);
....................          break;
....................    
....................       case SPI_2:
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM2,write_data[spi_xfer_num]);
....................          break;
....................    
....................       case SPI_3:
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM3,write_data[spi_xfer_num]);
....................          break;
....................          
....................       default:
....................          break;
....................    }
....................    return;
.................... }
.................... 
.................... //send multi bytes then receive multi bytes 
.................... void spi_xfer_and_read_select_stream(Flash flash_stream, int8 *write_data, unsigned int16 write_amount, int8 *read_data, unsigned int32 read_amount){
....................    switch(flash_stream.spi_stream_id){
....................       case SPI_0:
....................          fprintf(PC, "\t->");
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................          {
....................             spi_xfer(FLASH_STREAM0, write_data[spi_xfer_num]);
....................             fprintf(PC, "%X ", write_data[spi_xfer_num]);
....................          }   
....................          fprintf(PC, "\r\n\t<-");
....................          for(unsigned int32 spi_rcv_num = 0;spi_rcv_num < read_amount;spi_rcv_num++)
....................          {
....................             read_data[spi_rcv_num] = spi_xfer(FLASH_STREAM0);
....................             fprintf(PC, "%X ", read_data[spi_rcv_num]);
....................          }
....................          fprintf(PC, "\r\n");
....................          break;
....................             
....................       case SPI_1:
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM1, write_data[spi_xfer_num]);
....................          for(unsigned int32 spi_rcv_num = 0;spi_rcv_num < read_amount;spi_rcv_num++)
....................             read_data[spi_rcv_num] = spi_xfer(FLASH_STREAM1);
....................          break;
....................    
....................       case SPI_2:
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM2, write_data[spi_xfer_num]);
....................          for(unsigned int32 spi_rcv_num = 0;spi_rcv_num < read_amount;spi_rcv_num++)
....................             read_data[spi_rcv_num] = spi_xfer(FLASH_STREAM2);
....................          break;
....................    
....................       case SPI_3:
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM3, write_data[spi_xfer_num]);
....................          for(unsigned int32 spi_rcv_num = 0;spi_rcv_num < read_amount;spi_rcv_num++)
....................             read_data[spi_rcv_num] = spi_xfer(FLASH_STREAM3);
....................          break;
....................          
....................       default:
....................          break;
....................    }
....................    return;
.................... }
.................... 
.................... //send multi bytes(ex:cmd) then send other multi bytes(for write multi bytes) 
.................... void spi_xfer_two_datas_select_stream(Flash flash_stream, int8 *cmd_data, unsigned int8 cmd_amount, int8 *write_data, unsigned int16 write_amount){
....................    switch(flash_stream.spi_stream_id){
....................       case SPI_0:
....................       for(unsigned int8 spi_xfer_num = 0;spi_xfer_num < cmd_amount;spi_xfer_num++)
....................          spi_xfer(FLASH_STREAM0, cmd_data[spi_xfer_num]);
....................       for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................          spi_xfer(FLASH_STREAM0, write_data[spi_xfer_num]);
....................          break;
....................          
....................       case SPI_1:
....................          for(unsigned int8 spi_xfer_num = 0;spi_xfer_num < cmd_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM1, cmd_data[spi_xfer_num]);
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM1, write_data[spi_xfer_num]);
....................          break;
....................    
....................       case SPI_2:
....................          for(unsigned int8 spi_xfer_num = 0;spi_xfer_num < cmd_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM2, cmd_data[spi_xfer_num]);
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM2, write_data[spi_xfer_num]);
....................          break;
....................    
....................       case SPI_3:
....................          for(unsigned int8 spi_xfer_num = 0;spi_xfer_num < cmd_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM3, cmd_data[spi_xfer_num]);
....................          for(unsigned int16 spi_xfer_num = 0;spi_xfer_num < write_amount;spi_xfer_num++)
....................             spi_xfer(FLASH_STREAM3, write_data[spi_xfer_num]);
....................          break;
....................          
....................       default:
....................          break;
....................    }
....................    return;
.................... }
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... 
.................... void flash_setting(Flash flash_stream){
....................    output_high(flash_stream.cs_pin);
.................... }
.................... 
.................... int8 status_register(Flash flash_stream){
....................    int8 flash_cmd = CMD_READ_STATUS_REGISTER;
....................    int8 status_reg;
....................    output_low(flash_stream.cs_pin);                                              //lower the CS PIN
....................    spi_xfer_and_read_select_stream(flash_stream, &flash_cmd, 1, &status_reg, 1);
....................    output_high(flash_stream.cs_pin);                                             //take CS PIN higher back
....................    #ifdef DEBUG
....................       if((status_reg & 0x01) == true)                                          //masking status bit   
....................          fprintf(DEBUG_PORT,"flash busy\r\n");
....................    #endif
....................    return status_reg;  
.................... }
.................... 
.................... //
.................... //->success:True,fail:false
.................... int8 read_id(Flash flash_stream){
....................    int8 flash_cmd = CMD_READ_ID;
....................    int8 chip_id[20];
....................    output_low(flash_stream.cs_pin);
....................    spi_xfer_and_read_select_stream(flash_stream, &flash_cmd, 1, chip_id, 20);
....................    output_high(flash_stream.cs_pin);
....................    #ifdef DEBUG
....................       fprintf(DEBUG_PORT,"\tRead ID:");
....................       for(int8 print_counter = 0;print_counter < 20;print_counter++)
....................          fprintf(DEBUG_PORT,"%x ",chip_id[print_counter]);
....................       fprintf(DEBUG_PORT,"\r\n");
....................    #endif
....................    //chip id check
....................    if(chip_id[0] == 0x20){  
....................       #ifdef DEBUG
....................          fprintf(DEBUG_PORT,"\tflash connect OK\r\n");
....................       #endif
....................       return true;
....................    }
....................    else{
....................       #ifdef DEBUG
....................          fprintf(DEBUG_PORT,"\tflash not connect\r\n");
....................       #endif
....................       return false;
....................    }
.................... }
.................... 
.................... void sector_erase(Flash flash_stream, unsigned int32 sector_address){
.................... //!   #ifdef DEBUG
.................... //!      fprintf(DEBUG_PORT,"Sector Erase\r\n");
.................... //!   #endif
....................    if(flash_stream.flash_model == MT25QL128ABA){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[4];
.................... //!      #ifdef DEBUG
.................... //!         fprintf(DEBUG_PORT,"FLASH MODEL:MT25QL128ABA\r\n");
.................... //!      #endif
....................       flash_cmd[0] = CMD_SECTOR_ERASE;
....................       flash_cmd[1] = (unsigned int8)((sector_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[2] = (unsigned int8)((sector_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[3] = (unsigned int8)((sector_address) & 0xff);       // 0x 00 00 00 _ _
....................             
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_select_stream(flash_stream, flash_cmd, 4);
....................       //////////////////////////////////////////////////////////////////
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    else if(flash_stream.flash_model == MT25QL01GBBB){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[5];
.................... //!      #ifdef DEBUG
.................... //!         fprintf(DEBUG_PORT,"FLASH MODEL:MT25QL01GBBB\r\n");
.................... //!      #endif
....................       flash_cmd[0] = CMD_4BYTE_SECTOR_ERASE;
....................       flash_cmd[1] = (unsigned int8)((sector_address>>24) & 0xff);   // 0x _ _ 00 00 00
....................       flash_cmd[2] = (unsigned int8)((sector_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[3] = (unsigned int8)((sector_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[4] = (unsigned int8)((sector_address) & 0xff);       // 0x 00 00 00 _ _
....................       
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_select_stream(flash_stream, flash_cmd, 5);
....................       //////////////////////////////////////////////////////////////////
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    
....................    else{
....................       #ifdef DEBUG
....................          fprintf(DEBUG_PORT,"error:flash model is invalid\r\n");
....................       #endif
....................    }
....................    
....................    //wait process finished
....................    unsigned int8 timeout_counter = 0;
....................    while((status_register(flash_stream) & 0x01) == 1){      //masking status bit
....................       if(timeout_counter > 10)
....................          delay_ms(200);
....................       else
....................          delay_ms(10);   
....................       
....................       if(timeout_counter > 100){
....................          #ifdef DEBUG
....................             fprintf(DEBUG_PORT,"flash timeout\r\n");
....................          #endif
....................          break;
....................       }  
....................       timeout_counter++;
....................    }
....................    #ifdef DEBUG
....................       fprintf(DEBUG_PORT,"flash sector erase complete\r\n");
....................    #endif
....................    return;
.................... }
.................... 
.................... void subsector_32kByte_erase(Flash flash_stream, unsigned int32 subsector_address){
....................    if(flash_stream.flash_model == MT25QL128ABA){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[4];
....................       
....................       flash_cmd[0] = CMD_SUBSECTOR_32KB_ERASE;
....................       flash_cmd[1] = (unsigned int8)((subsector_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[2] = (unsigned int8)((subsector_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[3] = (unsigned int8)((subsector_address) & 0xff);       // 0x 00 00 00 _ _
....................             
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_select_stream(flash_stream, flash_cmd, 4);
....................       //////////////////////////////////////////////////////////////////
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    else if(flash_stream.flash_model == MT25QL01GBBB){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[5];
....................       
....................       flash_cmd[0] = CMD_4BYTE_SUBSECTOR_32KB_ERASE;
....................       flash_cmd[1] = (unsigned int8)((subsector_address>>24) & 0xff);   // 0x _ _ 00 00 00
....................       flash_cmd[2] = (unsigned int8)((subsector_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[3] = (unsigned int8)((subsector_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[4] = (unsigned int8)((subsector_address) & 0xff);       // 0x 00 00 00 _ _
....................       
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_select_stream(flash_stream, flash_cmd, 5);
....................       //////////////////////////////////////////////////////////////////
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    
....................    else{
....................       #ifdef DEBUG
....................          fprintf(DEBUG_PORT,"error:flash model is invalid\r\n");
....................       #endif
....................    }
....................    
....................    //wait process finished
....................    unsigned int8 timeout_counter = 0;
....................    while((status_register(flash_stream) & 0x01) == 1){                  //masking status bit
....................       if(timeout_counter > 10)
....................          delay_ms(200);
....................       else
....................          delay_ms(10);   
....................       
....................       if(timeout_counter > 100){
....................          #ifdef DEBUG
....................             fprintf(DEBUG_PORT,"flash timeout\r\n");
....................          #endif
....................          break;
....................       }  
....................       timeout_counter++;
....................    }
....................    #ifdef DEBUG
....................       fprintf(DEBUG_PORT,"flash 32kByte subsector erase complete\r\n");
....................    #endif
....................    return;
.................... }
.................... 
.................... void subsector_4kByte_erase(Flash flash_stream, unsigned int32 subsector_address){
....................    if(flash_stream.flash_model == MT25QL128ABA){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[4];
....................       
....................       flash_cmd[0] = CMD_SUBSECTOR_4KB_ERASE;
....................       flash_cmd[1] = (unsigned int8)((subsector_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[2] = (unsigned int8)((subsector_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[3] = (unsigned int8)((subsector_address) & 0xff);       // 0x 00 00 00 _ _
....................             
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_select_stream(flash_stream, flash_cmd, 4);
....................       //////////////////////////////////////////////////////////////////
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    else if(flash_stream.flash_model == MT25QL01GBBB){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[5];
....................       
....................       flash_cmd[0] = CMD_4BYTE_SUBSECTOR_4KB_ERASE;
....................       flash_cmd[1] = (unsigned int8)((subsector_address>>24) & 0xff);   // 0x _ _ 00 00 00
....................       flash_cmd[2] = (unsigned int8)((subsector_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[3] = (unsigned int8)((subsector_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[4] = (unsigned int8)((subsector_address) & 0xff);       // 0x 00 00 00 _ _
....................       
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_select_stream(flash_stream, flash_cmd, 5);
....................       //////////////////////////////////////////////////////////////////
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    
....................    else{
....................       #ifdef DEBUG
....................          fprintf(DEBUG_PORT,"error:flash model is invalid\r\n");
....................       #endif
....................    }
....................    
....................    //wait process finished
....................    unsigned int8 timeout_counter = 0;
....................    while((status_register(flash_stream) & 0x01) == 1){                           //masking status bit
....................       if(timeout_counter > 10)
....................          delay_ms(200);
....................       else
....................          delay_ms(10);   
....................       
....................       if(timeout_counter > 100){
....................          #ifdef DEBUG
....................             fprintf(DEBUG_PORT,"flash timeout\r\n");
....................          #endif
....................          break;
....................       }  
....................       timeout_counter++;
....................    }
....................    #ifdef DEBUG
....................       fprintf(DEBUG_PORT,"flash 4kByte subsector erase complete\r\n");
....................    #endif
....................    return;
.................... }
....................    
.................... int8 read_data_byte(Flash flash_stream, unsigned int32 read_address){
....................    int8 read_data;
....................    if(flash_stream.flash_model == MT25QL128ABA){
....................       unsigned int8 flash_cmd[4];
....................       
....................       flash_cmd[0] = CMD_READ;
....................       flash_cmd[1] = (unsigned int8)((read_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[2] = (unsigned int8)((read_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[3] = (unsigned int8)((read_address) & 0xff);       // 0x 00 00 00 _ _
....................             
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_and_read_select_stream(flash_stream, flash_cmd, 4, &read_data, 1);
....................       //////////////////////////////////////////////////////////////////
....................       delay_us(2);
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    else if(flash_stream.flash_model == MT25QL01GBBB){
....................       unsigned int8 flash_cmd[5];
....................       
....................       flash_cmd[0] = CMD_4BYTE_READ;
....................       flash_cmd[1] = (unsigned int8)((read_address>>24) & 0xff);   // 0x _ _ 00 00 00
....................       flash_cmd[2] = (unsigned int8)((read_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[3] = (unsigned int8)((read_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[4] = (unsigned int8)((read_address) & 0xff);       // 0x 00 00 00 _ _
....................    
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_and_read_select_stream(flash_stream, flash_cmd, 5, &read_data, 1);
....................       //////////////////////////////////////////////////////////////////
....................       delay_us(2);
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    return read_data;
.................... }
....................    
.................... void read_data_bytes(Flash flash_stream, unsigned int32 read_start_address, int8 *read_data, unsigned int32 read_amount)
.................... {
....................    if(flash_stream.flash_model == MT25QL128ABA){
....................       unsigned int8 flash_cmd[4];
....................       
....................       flash_cmd[0] = CMD_READ;
....................       flash_cmd[1] = (unsigned int8)((read_start_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[2] = (unsigned int8)((read_start_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[3] = (unsigned int8)((read_start_address) & 0xff);       // 0x 00 00 00 _ _
....................             
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_and_read_select_stream(flash_stream, flash_cmd, 4, read_data, read_amount);
....................       //////////////////////////////////////////////////////////////////
....................       delay_us(2);
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    else if(flash_stream.flash_model == MT25QL01GBBB){
....................       unsigned int8 flash_cmd[5];
....................       
....................       flash_cmd[0] = CMD_4BYTE_READ;
....................       flash_cmd[1] = (unsigned int8)((read_start_address>>24) & 0xff);   // 0x _ _ 00 00 00
....................       flash_cmd[2] = (unsigned int8)((read_start_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[3] = (unsigned int8)((read_start_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[4] = (unsigned int8)((read_start_address) & 0xff);       // 0x 00 00 00 _ _
....................    
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_and_read_select_stream(flash_stream, flash_cmd, 5, read_data, read_amount);
....................       //////////////////////////////////////////////////////////////////
....................       delay_us(2);
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    return;
.................... }
....................    
.................... void write_data_byte(Flash flash_stream, unsigned int32 write_address,int8 write_data)
.................... {
....................    if(flash_stream.flash_model == MT25QL128ABA){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[5];
....................       
....................       flash_cmd[0] = CMD_PAGE_PROGRAM;
....................       flash_cmd[1] = (unsigned int8)((write_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[2] = (unsigned int8)((write_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[3] = (unsigned int8)((write_address) & 0xff);       // 0x 00 00 00 _ _
....................       flash_cmd[4] = write_data;
.................... 
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_select_stream(flash_stream, flash_cmd, 5);
....................       //////////////////////////////////////////////////////////////////
....................       delay_us(2);
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    else if(flash_stream.flash_model == MT25QL01GBBB){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[6];
....................       
....................       flash_cmd[0] = CMD_4BYTE_PAGE_PROGRAM;
....................       flash_cmd[1] = (unsigned int8)((write_address>>24) & 0xff);   // 0x _ _ 00 00 00
....................       flash_cmd[2] = (unsigned int8)((write_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[3] = (unsigned int8)((write_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[4] = (unsigned int8)((write_address) & 0xff);       // 0x 00 00 00 _ _
....................       flash_cmd[5] = write_data;
....................    
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_select_stream(flash_stream, flash_cmd, 6);
....................       //////////////////////////////////////////////////////////////////
....................       delay_us(2);
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    
....................    //wait process finished
....................    unsigned int8 timeout_counter = 0;
....................    while((status_register(flash_stream) & 0x01) == 1){                           //masking status bit
....................       if(timeout_counter > 10)
....................          delay_ms(200);
....................       else
....................          delay_ms(10);   
....................       
....................       if(timeout_counter > 100){
....................          #ifdef DEBUG
....................             fprintf(DEBUG_PORT,"flash timeout\r\n");
....................          #endif
....................          break;
....................       }  
....................       timeout_counter++;
....................    }
....................    #ifdef DEBUG
....................       fprintf(DEBUG_PORT,"flash write complete\r\n");
....................    #endif
....................    return;
.................... }
.................... 
.................... void write_data_bytes(Flash flash_stream, unsigned int32 write_start_address, int8 *write_data, unsigned int16 write_amount){
....................    if(flash_stream.flash_model == MT25QL128ABA){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[4];
....................       
....................       flash_cmd[0] = CMD_PAGE_PROGRAM;
....................       flash_cmd[1] = (unsigned int8)((write_start_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[2] = (unsigned int8)((write_start_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[3] = (unsigned int8)((write_start_address) & 0xff);       // 0x 00 00 00 _ _
.................... 
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_two_datas_select_stream(flash_stream, flash_cmd, 4, write_data, write_amount);
....................       //////////////////////////////////////////////////////////////////
....................       delay_us(2);
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    else if(flash_stream.flash_model == MT25QL01GBBB){
....................       int8 write_enable_cmd = CMD_WRITE_ENABLE;
....................       unsigned int8 flash_cmd[5];
....................       
....................       flash_cmd[0] = CMD_4BYTE_PAGE_PROGRAM;
....................       flash_cmd[1] = (unsigned int8)((write_start_address>>24) & 0xff);   // 0x _ _ 00 00 00
....................       flash_cmd[2] = (unsigned int8)((write_start_address>>16) & 0xff);   // 0x 00 _ _ 00 00
....................       flash_cmd[3] = (unsigned int8)((write_start_address>>8) & 0xff);    // 0x 00 00 _ _ 00
....................       flash_cmd[4] = (unsigned int8)((write_start_address) & 0xff);       // 0x 00 00 00 _ _
....................    
....................       //Write enable sequence
....................       output_low(flash_stream.cs_pin);
....................       spi_xfer_select_stream(flash_stream, &write_enable_cmd, 1);
....................       output_high(flash_stream.cs_pin);
....................       //Write enabled
....................       output_low(flash_stream.cs_pin);
....................       ///////////////////////////////////////////////////////////////////
....................       spi_xfer_two_datas_select_stream(flash_stream, flash_cmd, 5, write_data, write_amount);
....................       //////////////////////////////////////////////////////////////////
....................       delay_us(2);
....................       output_high(flash_stream.cs_pin);            //take CS PIN higher back
....................    }
....................    
....................    //wait process finished
....................    unsigned int8 timeout_counter = 0;
....................    while((status_register(flash_stream) & 0x01) == 1){                           //masking status bit
....................       if(timeout_counter > 10)
....................          delay_ms(200);
....................       else
....................          delay_ms(10);   
....................       
....................       if(timeout_counter > 100){
....................          #ifdef DEBUG
....................             fprintf(DEBUG_PORT,"flash timeout\r\n");
....................          #endif
....................          break;
....................       }  
....................       timeout_counter++;
....................    }
....................    #ifdef DEBUG
....................       fprintf(DEBUG_PORT,"flash write complete\r\n");
....................    #endif
....................    return;
.................... }
.................... 
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... #include "./lib/mission_tools.h"
.................... #ifndef MISSION_TOOLS_H
.................... #define MISSION_TOOLS_H
.................... 
.................... #include "communication_driver.h"
.................... #ifndef COMMUNICATION_DRIVER_H
.................... #define COMMUNICATION_DRIVER_H
.................... 
.................... #include "communication.h"
.................... #ifndef COMMUNICATION_H
.................... #define COMMUNICATION_H
.................... 
.................... // __________ device IDs ______________
.................... 
.................... #define MAIN_PIC  0x00
.................... #define COM_PIC   0x01
.................... #define RESET_PIC 0x02
.................... #define FAB_PIC   0x03
.................... #define BOSS_PIC  0x04
.................... #define APRS_PIC  0x05
.................... #define CAM_MCU   0x06
.................... #define CHO_MCU   0x07
.................... #define NAKA_PIC  0x08
.................... #define SATO_PIC  0x09
.................... #define BHU_MCU   0x0A
.................... #define CIGS_PIC  0x0B
.................... 
.................... #define SELF_DEVICE_ID CIGS_PIC // <- change to your device name
.................... 
.................... 
.................... // ____________ SFD ______________
.................... 
.................... #define SFD 0xAA
.................... 
.................... 
.................... // ____________ typedef _____________
.................... 
.................... typedef struct {
....................     int8 id;
....................     int8 length;
.................... } FrameID;
.................... 
.................... #define CONTENT_MAX 32
.................... typedef struct {
....................     int8 frame_id;
....................     unsigned int8 content[CONTENT_MAX];
....................     int8 size;
....................     int1 is_exist;
.................... } Command;
.................... 
.................... #include "./frame.h"
.................... #ifndef FRAME_CONTENT_H
.................... #define FRAME_CONTENT_H
.................... 
.................... 
.................... // __________ Receives _________
.................... 
.................... #define UPLINK_COMMAND        0x00
.................... #define STATUS_CHECK          0x01
.................... #define IS_SMF_AVAILABLE      0x02
.................... 
.................... #define UPLINK_COMMAND_LENGTH     9
.................... #define STATUS_CHECK_LENGTH       0
.................... #define IS_SMF_AVAILABLE_LENGTH   1
.................... 
.................... volatile FrameID frame_ids[] = {
....................    {UPLINK_COMMAND, UPLINK_COMMAND_LENGTH}, 
....................    {STATUS_CHECK, STATUS_CHECK_LENGTH}, 
....................    {IS_SMF_AVAILABLE, IS_SMF_AVAILABLE_LENGTH}
.................... };
.................... 
.................... 
.................... // __________ Transmits _____________
.................... 
.................... typedef enum {
....................    MIS_MCU_STATUS = 0x01,
....................    ACK = 0x0F
.................... } TransmitFrameId;
.................... 
.................... #endif
.................... 
.................... 
.................... // ______ Receive _______
.................... 
.................... Command make_receive_command(unsigned int8 receive_signal[], int8 receive_signal_size);
.................... 
.................... static int8 trim_receive_signal_header(unsigned int8 receive_signal[], int8 receive_signal_size);
.................... 
.................... static int8 get_content_size(unsigned int8 frame_id);
.................... 
.................... static int1 check_crc(unsigned int8 frame[], int8 receive_frame_size);
.................... 
.................... static int1 check_device_id(unsigned int8 device_id);
.................... 
.................... 
.................... // ______ Transmit _______
.................... 
.................... void transmit_command(TransmitFrameId frame_id, unsigned int8 content[], int8 size);
.................... 
.................... static void transmit(unsigned int8 data[], int8 data_size);
.................... 
.................... // ______ Common _________
.................... 
.................... static unsigned int8 calc_crc8(unsigned int8 frame[], int8 payload_size);
.................... 
.................... #include "./src/communication.c"
.................... Command make_receive_command(unsigned int8 receive_signal[], int8 receive_signal_size)
.................... {
....................    Command command = {0, {0x00}, 0, FALSE};
*
0820:  MOVLB  10
0821:  CLRF   3C
0822:  CLRF   3D
0823:  CLRF   3E
0824:  CLRF   3F
0825:  CLRF   40
0826:  CLRF   41
0827:  CLRF   42
0828:  CLRF   43
0829:  CLRF   44
082A:  CLRF   45
082B:  CLRF   46
082C:  CLRF   47
082D:  CLRF   48
082E:  CLRF   49
082F:  CLRF   4A
0830:  CLRF   4B
0831:  CLRF   4C
0832:  CLRF   4D
0833:  CLRF   4E
0834:  CLRF   4F
0835:  CLRF   50
0836:  CLRF   51
0837:  CLRF   52
0838:  CLRF   53
0839:  CLRF   54
083A:  CLRF   55
083B:  CLRF   56
083C:  CLRF   57
083D:  CLRF   58
083E:  CLRF   59
083F:  CLRF   5A
0840:  CLRF   5B
0841:  CLRF   5C
0842:  CLRF   5D
0843:  CLRF   5E
....................    fprintf(PC, "Start make_receive_command\r\n\t-> ");
0844:  MOVLW  F1
0845:  MOVLB  03
0846:  MOVWF  11
0847:  MOVLW  01
0848:  MOVWF  12
0849:  MOVLP  00
084A:  MOVLB  00
084B:  CALL   603
084C:  MOVLP  08
....................    for (int8 i = 0; i < receive_signal_size; i++)
084D:  MOVLB  10
084E:  CLRF   5F
084F:  MOVF   3B,W
0850:  SUBWF  5F,W
0851:  BTFSC  03.0
0852:  GOTO   06C
....................       fprintf(PC, "%X ", receive_signal[i]);
0853:  MOVF   5F,W
0854:  ADDWF  39,W
0855:  MOVWF  04
0856:  MOVLW  00
0857:  ADDWFC 3A,W
0858:  MOVWF  05
0859:  MOVF   00,W
085A:  MOVWF  67
085B:  MOVWF  6C
085C:  MOVLW  37
085D:  MOVWF  6D
085E:  MOVLP  00
085F:  MOVLB  00
0860:  CALL   6E7
0861:  MOVLP  08
0862:  MOVLW  20
0863:  MOVLB  11
0864:  MOVWF  20
0865:  MOVLP  00
0866:  MOVLB  00
0867:  CALL   5DE
0868:  MOVLP  08
0869:  MOVLB  10
086A:  INCF   5F,F
086B:  GOTO   04F
....................    fprintf(PC, "\r\n");
086C:  MOVLW  0D
086D:  MOVLB  11
086E:  MOVWF  20
086F:  MOVLP  00
0870:  MOVLB  00
0871:  CALL   5DE
0872:  MOVLP  08
0873:  MOVLW  0A
0874:  MOVLB  11
0875:  MOVWF  20
0876:  MOVLP  00
0877:  MOVLB  00
0878:  CALL   5DE
0879:  MOVLP  08
.................... 
....................    int8 frame_start_position = trim_receive_signal_header(receive_signal, receive_signal_size);
087A:  MOVLB  10
087B:  MOVF   3A,W
087C:  MOVWF  68
087D:  MOVF   39,W
087E:  MOVWF  67
087F:  MOVF   3B,W
0880:  MOVWF  69
*
08BC:  MOVF   78,W
08BD:  MOVWF  60
....................    if (frame_start_position == -1)
08BE:  MOVF   60,W
08BF:  SUBLW  FF
08C0:  BTFSS  03.2
08C1:  GOTO   0C7
....................       return command;
08C2:  MOVLW  3C
08C3:  MOVWF  78
08C4:  MOVLW  08
08C5:  MOVWF  79
08C6:  GOTO   253
....................       
....................    unsigned int8 *frame = &receive_signal[frame_start_position];
....................    
....................    int8 frame_id = frame[0] & 0x0F;
....................    int8 content_size = get_content_size(frame_id);
08C7:  MOVF   60,W
08C8:  ADDWF  39,W
08C9:  MOVWF  78
08CA:  MOVLW  00
08CB:  ADDWFC 3A,W
08CC:  MOVWF  7A
08CD:  MOVF   78,W
08CE:  MOVWF  61
08CF:  MOVF   7A,W
08D0:  MOVWF  62
08D1:  MOVF   61,W
08D2:  MOVWF  04
08D3:  MOVF   62,W
08D4:  MOVWF  05
08D5:  ADDFSR 00,FSR0
08D6:  MOVF   00,W
08D7:  ANDLW  0F
08D8:  MOVWF  63
08D9:  MOVF   63,W
08DA:  MOVWF  67
*
0921:  MOVF   78,W
0922:  MOVWF  64
....................    if (content_size == -1)
0923:  MOVF   64,W
0924:  SUBLW  FF
0925:  BTFSS  03.2
0926:  GOTO   12C
....................       return command;
0927:  MOVLW  3C
0928:  MOVWF  78
0929:  MOVLW  08
092A:  MOVWF  79
092B:  GOTO   253
....................       
....................    int8 receive_frame_size = receive_signal_size - frame_start_position;
092C:  MOVF   60,W
092D:  SUBWF  3B,W
092E:  MOVWF  65
....................    
....................    if (!check_crc(frame, receive_frame_size))
092F:  MOVF   62,W
0930:  MOVWF  68
0931:  MOVF   61,W
0932:  MOVWF  67
0933:  MOVF   65,W
0934:  MOVWF  69
*
09A8:  MOVF   78,F
09A9:  BTFSS  03.2
09AA:  GOTO   1B0
....................       return command;
09AB:  MOVLW  3C
09AC:  MOVWF  78
09AD:  MOVLW  08
09AE:  MOVWF  79
09AF:  GOTO   253
....................    
....................    if(!check_device_id((frame[0] & 0xF0) >> 4))
09B0:  MOVF   61,W
09B1:  MOVWF  04
09B2:  MOVF   62,W
09B3:  MOVWF  05
09B4:  ADDFSR 00,FSR0
09B5:  MOVF   00,W
09B6:  ANDLW  F0
09B7:  MOVWF  77
09B8:  SWAPF  77,W
09B9:  MOVWF  67
09BA:  MOVLW  0F
09BB:  ANDWF  67,F
09BC:  MOVF   67,W
09BD:  MOVWF  68
*
0A1A:  MOVF   78,F
0A1B:  BTFSS  03.2
0A1C:  GOTO   222
....................       return command;
0A1D:  MOVLW  3C
0A1E:  MOVWF  78
0A1F:  MOVLW  08
0A20:  MOVWF  79
0A21:  GOTO   253
.................... 
....................    command.frame_id = frame_id;
0A22:  MOVF   63,W
0A23:  MOVWF  3C
....................    memcpy(command.content, &frame[1], receive_frame_size-2); // '2' is for Decive ID, Frame ID and CRC
0A24:  MOVLW  01
0A25:  ADDWF  61,W
0A26:  MOVWF  78
0A27:  MOVLW  00
0A28:  ADDWFC 62,W
0A29:  MOVWF  7A
0A2A:  MOVF   78,W
0A2B:  MOVWF  67
0A2C:  MOVF   7A,W
0A2D:  MOVWF  68
0A2E:  MOVLW  02
0A2F:  SUBWF  65,W
0A30:  MOVWF  69
0A31:  MOVF   68,W
0A32:  MOVWF  05
0A33:  MOVF   67,W
0A34:  MOVWF  04
0A35:  MOVF   69,W
0A36:  MOVWF  78
0A37:  BTFSC  03.2
0A38:  GOTO   241
0A39:  MOVLW  25
0A3A:  MOVWF  07
0A3B:  MOVLW  1D
0A3C:  MOVWF  06
0A3D:  MOVIW  [FSR0++],W
0A3E:  MOVWI  W,[FSR1++]
0A3F:  DECFSZ 78,F
0A40:  GOTO   23D
....................    command.size = receive_frame_size-2;
0A41:  MOVLW  02
0A42:  SUBWF  65,W
0A43:  MOVWF  5D
....................    //fprintf(PC, "\tcommand.size: %d\r\n", command.size);
....................    command.is_exist = TRUE;
0A44:  BSF    5E.0
....................    //fprintf(PC, "\tcommand.is_exist: %X\r\n", command.is_exist);
....................    fprintf(PC, "End make_recive_command\r\n\r\n");
0A45:  MOVLW  02
0A46:  MOVLB  03
0A47:  MOVWF  11
0A48:  MOVLW  02
0A49:  MOVWF  12
0A4A:  MOVLP  00
0A4B:  MOVLB  00
0A4C:  CALL   603
0A4D:  MOVLP  08
....................    return command;
0A4E:  MOVLW  3C
0A4F:  MOVWF  78
0A50:  MOVLW  08
0A51:  MOVWF  79
0A52:  MOVLB  10
0A53:  MOVLP  10
0A54:  MOVLB  00
0A55:  GOTO   474 (RETURN)
.................... }
.................... 
.................... static int8 trim_receive_signal_header(unsigned int8 receive_signal[], int8 receive_signal_size)
*
0881:  CLRF   6A
.................... {
....................    int8 i = 0;
....................    for(i = 0; i < receive_signal_size-1; i++) // if SFD find 
0882:  CLRF   6A
0883:  MOVLW  01
0884:  SUBWF  69,W
0885:  SUBWF  6A,W
0886:  BTFSC  03.0
0887:  GOTO   098
....................       if(receive_signal[i] == SFD)
0888:  MOVF   6A,W
0889:  ADDWF  67,W
088A:  MOVWF  04
088B:  MOVLW  00
088C:  ADDWFC 68,W
088D:  MOVWF  05
088E:  MOVF   00,W
088F:  SUBLW  AA
0890:  BTFSS  03.2
0891:  GOTO   096
....................          return i+1;
0892:  MOVLW  01
0893:  ADDWF  6A,W
0894:  MOVWF  78
0895:  GOTO   0BC
0896:  INCF   6A,F
0897:  GOTO   083
....................    if (receive_signal[i] == SFD)
0898:  MOVF   6A,W
0899:  ADDWF  67,W
089A:  MOVWF  04
089B:  MOVLW  00
089C:  ADDWFC 68,W
089D:  MOVWF  05
089E:  MOVF   00,W
089F:  SUBLW  AA
08A0:  BTFSS  03.2
08A1:  GOTO   0B0
....................    {
....................       fprintf(PC, "signal end with SFD\r\n");
08A2:  MOVLW  10
08A3:  MOVLB  03
08A4:  MOVWF  11
08A5:  MOVLW  02
08A6:  MOVWF  12
08A7:  MOVLP  00
08A8:  MOVLB  00
08A9:  CALL   603
08AA:  MOVLP  08
....................       return -1;
08AB:  MOVLW  FF
08AC:  MOVWF  78
08AD:  MOVLB  10
08AE:  GOTO   0BC
....................    }
08AF:  GOTO   0BC
....................    else
....................    {
....................       fprintf(PC, "don't find SFD\r\n");
08B0:  MOVLW  1B
08B1:  MOVLB  03
08B2:  MOVWF  11
08B3:  MOVLW  02
08B4:  MOVWF  12
08B5:  MOVLP  00
08B6:  MOVLB  00
08B7:  CALL   603
08B8:  MOVLP  08
....................       return -1;
08B9:  MOVLW  FF
08BA:  MOVWF  78
08BB:  MOVLB  10
....................    }
....................    
.................... }
.................... 
.................... static int8 get_content_size(unsigned int8 frame_id)
.................... {
....................    for (int i = 0; i < (sizeof(frame_ids) / sizeof(frame_ids[0])); i++)
*
08DB:  CLRF   68
08DC:  MOVF   68,W
08DD:  SUBLW  02
08DE:  BTFSS  03.0
08DF:  GOTO   0FA
....................       if (frame_id == frame_ids[i].id)
08E0:  BCF    03.0
08E1:  RLF    68,W
08E2:  ADDLW  DF
08E3:  MOVWF  04
08E4:  MOVLW  24
08E5:  MOVWF  05
08E6:  BTFSC  03.0
08E7:  INCF   05,F
08E8:  MOVF   00,W
08E9:  SUBWF  67,W
08EA:  BTFSS  03.2
08EB:  GOTO   0F8
....................          return frame_ids[i].length;
08EC:  BCF    03.0
08ED:  RLF    68,W
08EE:  ADDLW  01
08EF:  ADDLW  DF
08F0:  MOVWF  04
08F1:  MOVLW  24
08F2:  MOVWF  05
08F3:  BTFSC  03.0
08F4:  INCF   05,F
08F5:  MOVF   00,W
08F6:  MOVWF  78
08F7:  GOTO   121
08F8:  INCF   68,F
08F9:  GOTO   0DC
....................          
....................    fprintf(PC, "\t-> Invalid Frame ID received: %X\r\n", frame_id);
08FA:  MOVLW  24
08FB:  MOVLB  03
08FC:  MOVWF  11
08FD:  MOVLW  02
08FE:  MOVWF  12
08FF:  BCF    03.0
0900:  MOVLW  1F
0901:  MOVLB  10
0902:  MOVWF  6C
0903:  MOVLP  00
0904:  MOVLB  00
0905:  CALL   78D
0906:  MOVLP  08
0907:  MOVLB  10
0908:  MOVF   67,W
0909:  MOVWF  6C
090A:  MOVLW  37
090B:  MOVWF  6D
090C:  MOVLP  00
090D:  MOVLB  00
090E:  CALL   6E7
090F:  MOVLP  08
0910:  MOVLW  0D
0911:  MOVLB  11
0912:  MOVWF  20
0913:  MOVLP  00
0914:  MOVLB  00
0915:  CALL   5DE
0916:  MOVLP  08
0917:  MOVLW  0A
0918:  MOVLB  11
0919:  MOVWF  20
091A:  MOVLP  00
091B:  MOVLB  00
091C:  CALL   5DE
091D:  MOVLP  08
....................    return -1;
091E:  MOVLW  FF
091F:  MOVWF  78
0920:  MOVLB  10
.................... }
.................... 
.................... static int1 check_crc(unsigned int8 frame[], int8 receive_frame_size)
*
0935:  MOVLW  01
0936:  SUBWF  69,W
0937:  ADDWF  67,W
0938:  MOVWF  04
0939:  MOVLW  00
093A:  ADDWFC 68,W
093B:  MOVWF  05
093C:  MOVF   00,W
093D:  MOVWF  6A
093E:  MOVLW  01
093F:  SUBWF  69,W
0940:  MOVWF  6C
0941:  MOVF   68,W
0942:  MOVWF  6E
0943:  MOVF   67,W
0944:  MOVWF  6D
0945:  MOVF   6C,W
0946:  MOVWF  6F
0947:  MOVLB  00
0948:  CALL   000
0949:  MOVF   78,W
094A:  MOVLB  10
094B:  MOVWF  6B
.................... {
....................    unsigned int8 received_crc = frame[receive_frame_size-1]; // '1' is for crc
....................    unsigned int8 collect_crc = calc_crc8(frame, receive_frame_size-1);
....................    if (received_crc == collect_crc)
094C:  MOVF   6B,W
094D:  SUBWF  6A,W
094E:  BTFSS  03.2
094F:  GOTO   154
....................       return TRUE;
0950:  MOVLW  01
0951:  MOVWF  78
0952:  GOTO   1A8
0953:  GOTO   1A8
....................    else
....................    {
....................       fprintf(PC, "\t-> CRC error!\r\n");
0954:  MOVLW  36
0955:  MOVLB  03
0956:  MOVWF  11
0957:  MOVLW  02
0958:  MOVWF  12
0959:  MOVLP  00
095A:  MOVLB  00
095B:  CALL   603
095C:  MOVLP  08
....................       fprintf(PC, "\t\t-> received CRC: %X\r\n", received_crc);
095D:  MOVLW  3F
095E:  MOVLB  03
095F:  MOVWF  11
0960:  MOVLW  02
0961:  MOVWF  12
0962:  BCF    03.0
0963:  MOVLW  13
0964:  MOVLB  10
0965:  MOVWF  6C
0966:  MOVLP  00
0967:  MOVLB  00
0968:  CALL   78D
0969:  MOVLP  08
096A:  MOVLB  10
096B:  MOVF   6A,W
096C:  MOVWF  6C
096D:  MOVLW  37
096E:  MOVWF  6D
096F:  MOVLP  00
0970:  MOVLB  00
0971:  CALL   6E7
0972:  MOVLP  08
0973:  MOVLW  0D
0974:  MOVLB  11
0975:  MOVWF  20
0976:  MOVLP  00
0977:  MOVLB  00
0978:  CALL   5DE
0979:  MOVLP  08
097A:  MOVLW  0A
097B:  MOVLB  11
097C:  MOVWF  20
097D:  MOVLP  00
097E:  MOVLB  00
097F:  CALL   5DE
0980:  MOVLP  08
....................       fprintf(PC, "\t\t   collect CRC : %X\r\n", collect_crc);
0981:  MOVLW  4B
0982:  MOVLB  03
0983:  MOVWF  11
0984:  MOVLW  02
0985:  MOVWF  12
0986:  BCF    03.0
0987:  MOVLW  13
0988:  MOVLB  10
0989:  MOVWF  6C
098A:  MOVLP  00
098B:  MOVLB  00
098C:  CALL   78D
098D:  MOVLP  08
098E:  MOVLB  10
098F:  MOVF   6B,W
0990:  MOVWF  6C
0991:  MOVLW  37
0992:  MOVWF  6D
0993:  MOVLP  00
0994:  MOVLB  00
0995:  CALL   6E7
0996:  MOVLP  08
0997:  MOVLW  0D
0998:  MOVLB  11
0999:  MOVWF  20
099A:  MOVLP  00
099B:  MOVLB  00
099C:  CALL   5DE
099D:  MOVLP  08
099E:  MOVLW  0A
099F:  MOVLB  11
09A0:  MOVWF  20
09A1:  MOVLP  00
09A2:  MOVLB  00
09A3:  CALL   5DE
09A4:  MOVLP  08
....................       return FALSE;
09A5:  MOVLW  00
09A6:  MOVWF  78
09A7:  MOVLB  10
....................    }
.................... }
.................... 
.................... static int1 check_device_id(unsigned int8 device_id)
.................... {
....................    if (SELF_DEVICE_ID == device_id)
*
09BE:  MOVF   68,W
09BF:  SUBLW  0B
09C0:  BTFSS  03.2
09C1:  GOTO   1C6
....................       return TRUE;
09C2:  MOVLW  01
09C3:  MOVWF  78
09C4:  GOTO   21A
09C5:  GOTO   21A
....................    else
....................    {
....................       fprintf(PC, "\t-> Invalid device ID received\r\n");
09C6:  MOVLW  57
09C7:  MOVLB  03
09C8:  MOVWF  11
09C9:  MOVLW  02
09CA:  MOVWF  12
09CB:  MOVLP  00
09CC:  MOVLB  00
09CD:  CALL   603
09CE:  MOVLP  08
....................       fprintf(PC, "\t\t-> received:     %X\r\n", device_id);
09CF:  MOVLW  68
09D0:  MOVLB  03
09D1:  MOVWF  11
09D2:  MOVLW  02
09D3:  MOVWF  12
09D4:  BCF    03.0
09D5:  MOVLW  13
09D6:  MOVLB  10
09D7:  MOVWF  6C
09D8:  MOVLP  00
09D9:  MOVLB  00
09DA:  CALL   78D
09DB:  MOVLP  08
09DC:  MOVLB  10
09DD:  MOVF   68,W
09DE:  MOVWF  6C
09DF:  MOVLW  37
09E0:  MOVWF  6D
09E1:  MOVLP  00
09E2:  MOVLB  00
09E3:  CALL   6E7
09E4:  MOVLP  08
09E5:  MOVLW  0D
09E6:  MOVLB  11
09E7:  MOVWF  20
09E8:  MOVLP  00
09E9:  MOVLB  00
09EA:  CALL   5DE
09EB:  MOVLP  08
09EC:  MOVLW  0A
09ED:  MOVLB  11
09EE:  MOVWF  20
09EF:  MOVLP  00
09F0:  MOVLB  00
09F1:  CALL   5DE
09F2:  MOVLP  08
....................       fprintf(PC, "\t\t   My device ID: %X\r\n", SELF_DEVICE_ID);
09F3:  MOVLW  74
09F4:  MOVLB  03
09F5:  MOVWF  11
09F6:  MOVLW  02
09F7:  MOVWF  12
09F8:  BCF    03.0
09F9:  MOVLW  13
09FA:  MOVLB  10
09FB:  MOVWF  6C
09FC:  MOVLP  00
09FD:  MOVLB  00
09FE:  CALL   78D
09FF:  MOVLP  08
0A00:  MOVLW  0B
0A01:  MOVLB  10
0A02:  MOVWF  6C
0A03:  MOVLW  37
0A04:  MOVWF  6D
0A05:  MOVLP  00
0A06:  MOVLB  00
0A07:  CALL   6E7
0A08:  MOVLP  08
0A09:  MOVLW  0D
0A0A:  MOVLB  11
0A0B:  MOVWF  20
0A0C:  MOVLP  00
0A0D:  MOVLB  00
0A0E:  CALL   5DE
0A0F:  MOVLP  08
0A10:  MOVLW  0A
0A11:  MOVLB  11
0A12:  MOVWF  20
0A13:  MOVLP  00
0A14:  MOVLB  00
0A15:  CALL   5DE
0A16:  MOVLP  08
....................       return FALSE;  
0A17:  MOVLW  00
0A18:  MOVWF  78
0A19:  MOVLB  10
....................    }
.................... }
.................... 
.................... 
.................... // _______ Transmit _______
.................... 
.................... void transmit_command(TransmitFrameId frame_id, unsigned int8 content[], int8 size)
.................... {
....................    unsigned int8 data[16];
....................    data[0] = SFD;
*
0AE8:  MOVLW  AA
0AE9:  MOVLB  10
0AEA:  MOVWF  3C
....................    data[1] = (BOSS_PIC << 4) | frame_id;
0AEB:  MOVF   38,W
0AEC:  IORLW  40
0AED:  MOVWF  3D
....................    memcpy(&data[2], content, size);
0AEE:  MOVF   3A,W
0AEF:  MOVWF  05
0AF0:  MOVF   39,W
0AF1:  MOVWF  04
0AF2:  MOVF   3B,W
0AF3:  MOVWF  78
0AF4:  BTFSC  03.2
0AF5:  GOTO   2FE
0AF6:  MOVLW  25
0AF7:  MOVWF  07
0AF8:  MOVLW  1E
0AF9:  MOVWF  06
0AFA:  MOVIW  [FSR0++],W
0AFB:  MOVWI  W,[FSR1++]
0AFC:  DECFSZ 78,F
0AFD:  GOTO   2FA
....................    int8 payload_size = 2 + size; // '2' is for Device ID and Frame ID plus CRC
0AFE:  MOVLW  02
0AFF:  ADDWF  3B,W
0B00:  MOVWF  4C
....................    data[payload_size] = calc_crc8(&data[1], payload_size-1); // '1' is for CRC
0B01:  MOVLW  1C
0B02:  ADDWF  4C,W
0B03:  MOVWF  78
0B04:  MOVLW  25
0B05:  MOVWF  7A
0B06:  BTFSC  03.0
0B07:  INCF   7A,F
0B08:  MOVF   78,W
0B09:  MOVWF  4F
0B0A:  MOVF   7A,W
0B0B:  MOVWF  50
0B0C:  MOVLW  01
0B0D:  SUBWF  4C,W
0B0E:  MOVWF  51
0B0F:  MOVLW  25
0B10:  MOVWF  6E
0B11:  MOVLW  1D
0B12:  MOVWF  6D
0B13:  MOVF   51,W
0B14:  MOVWF  6F
0B15:  MOVLB  00
0B16:  CALL   000
0B17:  MOVLB  10
0B18:  MOVF   50,W
0B19:  MOVWF  05
0B1A:  MOVF   4F,W
0B1B:  MOVWF  04
0B1C:  MOVF   78,W
0B1D:  MOVWF  00
....................    int8 data_size = payload_size + 1; // '1' is for CRC
0B1E:  MOVLW  01
0B1F:  ADDWF  4C,W
0B20:  MOVWF  4D
....................    
....................    transmit(data, data_size);
0B21:  MOVLW  25
0B22:  MOVWF  50
0B23:  MOVLW  1C
0B24:  MOVWF  4F
0B25:  MOVF   4D,W
0B26:  MOVWF  51
*
0B73:  RETURN
.................... }
.................... 
.................... static void transmit(unsigned int8 data[], int8 data_size)
.................... {
....................    for(int i = 0; i < data_size; i++)
*
0B27:  CLRF   52
0B28:  MOVF   51,W
0B29:  SUBWF  52,W
0B2A:  BTFSC  03.0
0B2B:  GOTO   33D
....................       fputc(data[i], BOSS);
0B2C:  MOVF   52,W
0B2D:  ADDWF  4F,W
0B2E:  MOVWF  04
0B2F:  MOVLW  00
0B30:  ADDWFC 50,W
0B31:  MOVWF  05
0B32:  MOVF   00,W
0B33:  MOVWF  54
0B34:  MOVF   54,W
*
0B3A:  MOVLB  10
0B3B:  INCF   52,F
0B3C:  GOTO   328
....................       
....................    fprintf(PC, "Transit command\r\n\t-> ");
0B3D:  MOVLW  80
0B3E:  MOVLB  03
0B3F:  MOVWF  11
0B40:  MOVLW  02
0B41:  MOVWF  12
0B42:  MOVLP  00
0B43:  MOVLB  00
0B44:  CALL   603
0B45:  MOVLP  08
....................    for(int i = 0; i < data_size; i++)
0B46:  MOVLB  10
0B47:  CLRF   53
0B48:  MOVF   51,W
0B49:  SUBWF  53,W
0B4A:  BTFSC  03.0
0B4B:  GOTO   365
....................       fprintf(PC, "%X ", data[i]);
0B4C:  MOVF   53,W
0B4D:  ADDWF  4F,W
0B4E:  MOVWF  04
0B4F:  MOVLW  00
0B50:  ADDWFC 50,W
0B51:  MOVWF  05
0B52:  MOVF   00,W
0B53:  MOVWF  54
0B54:  MOVWF  6C
0B55:  MOVLW  37
0B56:  MOVWF  6D
0B57:  MOVLP  00
0B58:  MOVLB  00
0B59:  CALL   6E7
0B5A:  MOVLP  08
0B5B:  MOVLW  20
0B5C:  MOVLB  11
0B5D:  MOVWF  20
0B5E:  MOVLP  00
0B5F:  MOVLB  00
0B60:  CALL   5DE
0B61:  MOVLP  08
0B62:  MOVLB  10
0B63:  INCF   53,F
0B64:  GOTO   348
....................    fprintf(PC, "\r\n");
0B65:  MOVLW  0D
0B66:  MOVLB  11
0B67:  MOVWF  20
0B68:  MOVLP  00
0B69:  MOVLB  00
0B6A:  CALL   5DE
0B6B:  MOVLP  08
0B6C:  MOVLW  0A
0B6D:  MOVLB  11
0B6E:  MOVWF  20
0B6F:  MOVLP  00
0B70:  MOVLB  00
0B71:  CALL   5DE
0B72:  MOVLP  08
.................... }
.................... 
.................... 
.................... // ______ Common _______
.................... 
.................... static unsigned int8 calc_crc8(unsigned int8 frame[], int8 payload_size)
*
0800:  MOVLB  10
0801:  MOVF   6D,W
0802:  MOVWF  04
0803:  MOVF   6E,W
0804:  MOVWF  05
0805:  MOVIW  [FSR0+00],W
0806:  MOVLB  11
0807:  MOVWF  20
0808:  MOVLW  01
0809:  MOVWF  21
.................... {
....................    unsigned int8 crc = frame[0], i = 1;
....................    while(i < payload_size)
080A:  MOVLB  10
080B:  MOVF   6F,W
080C:  MOVLB  11
080D:  SUBWF  21,W
080E:  BTFSC  03.0
080F:  GOTO   01C
....................       crc ^= frame[i++];
0810:  MOVF   21,W
0811:  INCF   21,F
0812:  MOVLB  10
0813:  ADDWF  6D,W
0814:  MOVWF  04
0815:  MOVLW  00
0816:  ADDWFC 6E,W
0817:  MOVWF  05
0818:  MOVF   00,W
0819:  MOVLB  11
081A:  XORWF  20,F
081B:  GOTO   00A
....................    return crc;
081C:  MOVF   20,W
081D:  MOVWF  78
081E:  MOVLB  00
081F:  RETURN
.................... }
.................... 
.................... 
.................... #endif
.................... 
.................... // EOF
.................... 
.................... 
.................... 
.................... // This is redundant, but it is a process to hide the Communication library as a driver.
.................... Command make_command(unsigned int8 receive_signal[], int8 receive_signal_size);
.................... 
.................... void transmit_ack();
.................... 
.................... void transmit_status();
.................... 
.................... int1 req_use_smf();
.................... 
.................... 
.................... #include "./src/communication_driver.c"
.................... Command make_command(unsigned int8 receive_signal[], int8 receive_signal_size)
.................... {
....................    volatile Command command = make_receive_command(receive_signal, receive_signal_size);
....................    //fprintf(PC, "--Communication drier--\r\n");
....................    //fprintf(PC, "command.size: %d\r\n", command.size);
....................    //fprintf(PC, "command.frame_id: %X\r\n", command.frame_id);
....................    //fprintf(PC, "command.content: ");
....................    for (int8 i = 0; i < command.size; i++)
....................       //fprintf(PC, "%X ", command.content[i]);
....................    //fprintf(PC, "\r\n");
....................    //fprintf(PC, "command.is_exist: %X\r\n", command.is_exist);
....................    return command;
.................... }
.................... 
.................... void transmit_ack()
.................... {
....................    transmit_command(ACK, 0, 0);
*
0B74:  MOVLW  0F
0B75:  MOVLB  10
0B76:  MOVWF  38
0B77:  CLRF   3A
0B78:  CLRF   39
0B79:  CLRF   3B
0B7A:  MOVLB  00
0B7B:  CALL   2E8
0B7C:  RETURN
.................... }
.................... 
.................... void transmit_status()
.................... {
....................    transmit_command(MIS_MCU_STATUS, &status, 1);
*
118D:  MOVLW  01
118E:  MOVLB  10
118F:  MOVWF  38
1190:  MOVLW  20
1191:  MOVWF  3A
1192:  MOVLW  0B
1193:  MOVWF  39
1194:  MOVLW  01
1195:  MOVWF  3B
1196:  MOVLP  08
1197:  MOVLB  00
1198:  CALL   2E8
1199:  MOVLP  10
.................... }
.................... 
.................... // EOF
.................... 
.................... 
.................... #endif
.................... 
.................... // EOF
.................... 
.................... 
.................... 
.................... // _____________ define _______________
.................... 
.................... #define EXECUTED_MISSION_SIZE 8
.................... 
.................... 
.................... // _____________ typedef ________________
.................... 
.................... typedef struct {
....................    unsigned int8 executed_mission[EXECUTED_MISSION_SIZE];
....................    int8 executed_mission_count;
.................... } ExecutedMission;
.................... 
.................... 
.................... // ________________ fuctions ____________
.................... 
.................... // Value management using the Singleton pattern
.................... ExecutedMission get_executed_mission();
.................... 
.................... int1 is_executed_mission(unsigned int8 command_id);
.................... 
.................... void add_executed_mission(unsigned int8 command_id);
.................... 
.................... // Use in missions you want to execute consecutively
.................... void executed_mission_pop(void);
.................... 
.................... 
.................... 
.................... // Check and reply to messages received from BOSS PIC
.................... void check_and_respond_to_boss();
.................... 
.................... // MIS MCU will be up and running duration_second seconds after mission completion
.................... void continue_mis_mcu(int16 duration_second);
.................... 
.................... 
.................... 
.................... // Request using SMF to BOSS PIC
.................... // !!!After use, you must call `void finished_use_smf()`
.................... int1 req_use_smf();
.................... 
.................... // Call after using SMF
.................... void finished_use_smf();
.................... 
.................... 
.................... #include "./src/mission_tools.c"
.................... ExecutedMission get_executed_mission()
.................... {
....................    static ExecutedMission executed_mission = {0};
....................    return executed_mission;
*
0B7D:  MOVLW  D5
0B7E:  MOVWF  78
0B7F:  MOVLW  07
0B80:  MOVWF  79
0B81:  RETURN
.................... }
.................... 
.................... int1 is_executed_mission(unsigned int8 command_id)
*
1058:  MOVLP  08
1059:  MOVLB  00
105A:  CALL   37D
105B:  MOVLP  10
105C:  MOVF   79,W
105D:  MOVWF  7A
105E:  MOVF   78,W
105F:  MOVWF  04
1060:  MOVF   7A,W
1061:  MOVWF  05
1062:  MOVLW  09
1063:  MOVWF  78
1064:  MOVLW  25
1065:  MOVWF  07
1066:  MOVLW  20
1067:  MOVWF  06
1068:  MOVIW  [FSR0++],W
1069:  MOVWI  W,[FSR1++]
106A:  DECFSZ 78,F
106B:  GOTO   068
.................... {
....................    ExecutedMission executed_mission = get_executed_mission();
....................    
....................    for (int i = 0; i < executed_mission.executed_mission_count; i++)
106C:  MOVLB  10
106D:  CLRF   49
106E:  MOVF   48,W
106F:  SUBWF  49,W
1070:  BTFSC  03.0
1071:  GOTO   082
....................       if (command_id == executed_mission.executed_mission[i])
1072:  MOVLW  20
1073:  ADDWF  49,W
1074:  MOVWF  04
1075:  MOVLW  25
1076:  MOVWF  05
1077:  BTFSC  03.0
1078:  INCF   05,F
1079:  MOVF   00,W
107A:  SUBWF  3F,W
107B:  BTFSS  03.2
107C:  GOTO   080
....................          return TRUE;
107D:  MOVLW  01
107E:  MOVWF  78
107F:  GOTO   084
1080:  INCF   49,F
1081:  GOTO   06E
....................       
....................    return FALSE;
1082:  MOVLW  00
1083:  MOVWF  78
.................... }
.................... 
.................... void add_executed_mission(unsigned int8 command_id)
*
10AF:  MOVLP  08
10B0:  MOVLB  00
10B1:  CALL   37D
10B2:  MOVLP  10
10B3:  MOVF   79,W
10B4:  MOVWF  7A
10B5:  MOVF   78,W
10B6:  MOVWF  04
10B7:  MOVF   7A,W
10B8:  MOVWF  05
10B9:  MOVLW  09
10BA:  MOVWF  78
10BB:  MOVLW  25
10BC:  MOVWF  07
10BD:  MOVLW  20
10BE:  MOVWF  06
10BF:  MOVIW  [FSR0++],W
10C0:  MOVWI  W,[FSR1++]
10C1:  DECFSZ 78,F
10C2:  GOTO   0BF
.................... {
....................    ExecutedMission executed_mission = get_executed_mission();
....................    
....................    if (executed_mission.executed_mission_count != EXECUTED_MISSION_SIZE)
10C3:  MOVLB  10
10C4:  MOVF   48,W
10C5:  SUBLW  08
10C6:  BTFSC  03.2
10C7:  GOTO   0D3
....................       executed_mission.executed_mission[executed_mission.executed_mission_count++] = command_id;
10C8:  MOVF   48,W
10C9:  INCF   48,F
10CA:  ADDLW  20
10CB:  MOVWF  04
10CC:  MOVLW  25
10CD:  MOVWF  05
10CE:  BTFSC  03.0
10CF:  INCF   05,F
10D0:  MOVF   3F,W
10D1:  MOVWF  00
10D2:  GOTO   0DD
....................    else
....................       fprintf(PC, "!!!overflow executed_mission list\r\n");
10D3:  MOVLW  8B
10D4:  MOVLB  03
10D5:  MOVWF  11
10D6:  MOVLW  02
10D7:  MOVWF  12
10D8:  MOVLP  00
10D9:  MOVLB  00
10DA:  CALL   603
10DB:  MOVLP  10
10DC:  MOVLB  10
.................... }
.................... 
.................... 
.................... int1 req_use_smf()
.................... {
....................    fprintf(PC, "Start SMF using reqest seaquence\r\n");
....................    status = SMF_USE_REQ;
....................    is_use_smf_req_in_mission = TRUE;
....................    
....................    while (TRUE)
....................    {
....................       for (int16 i = 0; i < 1200; i++) // 10 min
....................       {
....................          if (boss_receive_buffer_size > 0)
....................          {
....................             Command command = make_receive_command(boss_receive_buffer, boss_receive_buffer_size);
....................             clear_receive_signal(boss_receive_buffer, &boss_receive_buffer_size);
....................             if (command.frame_id == STATUS_CHECK)
....................             {
....................                transmit_status();
....................                break;
....................             }
....................             else
....................             {
....................                fprintf(PC, "Error! Receiving command inconsistent with the design\r\n");
....................             }
....................          }
....................          delay_ms(500);
....................       }
....................       
....................       for (int16 i = 0; i < 1200; i++) // 10 min
....................       {
....................          if (boss_receive_buffer_size > 0)
....................          {
....................             Command command = make_receive_command(boss_receive_buffer, boss_receive_buffer_size); 
....................             clear_receive_signal(boss_receive_buffer, &boss_receive_buffer_size);
....................             if (command.frame_id == IS_SMF_AVAILABLE)
....................             {
....................                if (command.content[0] == ALLOW)
....................                {
....................                   fprintf(PC, "SMF use request allowed\r\n");
....................                   transmit_ack();
....................                   goto NEXT;
....................                }
....................                else
....................                {
....................                   fprintf(PC, "SMF use request denyed\r\n");
....................                   fprintf(PC, "Retry request to BOSS PIC\r\n");
....................                   transmit_ack();
....................                   break;
....................                }
....................             }
....................             else
....................             {
....................                fprintf(PC, "Error! Receiving command inconsistent with the design\r\n");
....................             }
....................          }
....................          delay_ms(500);
....................       }
....................    }
....................    
.................... NEXT:
....................    is_use_smf_req_in_mission = FALSE;
....................    status = COPYING;
....................    return TRUE;
....................    fprintf(PC, "End SMF using reqest seaquence\r\n");
.................... }
.................... 
.................... 
.................... void finished_use_smf()
.................... {
....................    status = EXECUTING_MISSION;
.................... }
.................... 
.................... void executed_mission_pop(void)
.................... {
....................    ExecutedMission executed_mission = get_executed_mission();
....................    executed_mission.executed_mission[executed_mission.executed_mission_count--] = 0x00;
.................... }
.................... 
.................... void continue_mis_mcu(int16 duration_second)
.................... {  
....................    duration_sec = duration_second + sec;
.................... }
.................... 
.................... void check_and_respond_to_boss()
.................... {
....................    if (kbhit())
....................    {
....................       fgetc(BOSS);
....................       transmit_status();
....................    }
.................... }
.................... 
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... 
.................... // _________________ Oparation Mode ______________________
.................... #Separate
.................... void mode_measure(unsigned int8 parameter[])
.................... {
....................    fprintf(PC, "Start MODE MEASURE\r\n");
*
0E52:  MOVLW  20
0E53:  MOVLB  03
0E54:  MOVWF  11
0E55:  MOVLW  03
0E56:  MOVWF  12
0E57:  MOVLP  00
0E58:  MOVLB  00
0E59:  CALL   603
0E5A:  MOVLP  08
....................    unsigned int8 sweep_step = parameter[0]; // Get the measurement step from the parameter array
0E5B:  MOVLB  10
0E5C:  MOVF   3F,W
0E5D:  MOVWF  04
0E5E:  MOVF   40,W
0E5F:  MOVWF  05
0E60:  MOVIW  [FSR0+00],W
0E61:  MOVWF  41
....................    
....................    //adc_init();
....................    sweep(sweep_step);
0E62:  MOVF   41,W
0E63:  MOVWF  42
0E64:  MOVLB  00
0E65:  GOTO   3A9
0E66:  MOVLP  10
0E67:  GOTO   127 (RETURN)
....................    //copy_data();
.................... 
.................... }
.................... 
.................... #Separate
.................... void mode_measure_voltage()
.................... {
....................    fprintf(PC, "Start MODE MEASURE Voltage\r\n");
....................    while(TRUE)
....................    {
....................       unsigned int16 cigs_value;
....................       set_adc_channel(CIGS_VOLT);
....................       cigs_value = read_adc(ADC_START_AND_READ); // read voltage at adc pin
....................       //fprintf(PC, "cigs_value: %04X\r\n", cigs_value);
....................       delay_ms(1000); // wait for the ADC to stabilize
....................    }
.................... }
.................... 
.................... #Separate
.................... void mode_copy_SMF()
.................... {
....................    /*
....................    unsigned int8 smf_data[SMF_DATA_SIZE] = {0x00};
....................    unsigned int32 src = 0x00000000;
....................    unsigned int32 dest = 0x00000000;
....................    unsigned int32 size = 0x00000000;
....................    for (int i = 0; i < SMF_DATA_SIZE; i++)
....................    {
....................       smf_data[i] = read_data_byte_spi_id(src + i);
....................       fprintf(PC, "smf_data[%d]: %X\r\n", i, smf_data[i]);
....................    }
....................    enqueue_smf_data(src, dest, size);
....................    fprintf(PC, "enqueue_smf_data\r\n");
....................    */
.................... }
.................... 
.................... 
.................... //___________________ Debug Mode _______________
.................... #Separate
.................... void mode_test_temp()
.................... {
....................    while (TRUE)
....................    {   
....................       set_adc_channel(TEMP_TOP);
....................       unsigned int16 temp_top_value = read_adc(ADC_START_AND_READ); // read voltage at adc pin
....................       set_adc_channel(TEMP_BOT);
....................       unsigned int16 temp_bot_value = read_adc(ADC_START_AND_READ); // read voltage at adc pin
....................       fprintf(PC, "temp_top: %X\r\n", temp_top_value);
....................       fprintf(PC, "temp_bot: %X\r\n", temp_bot_value);
....................       delay_ms(1000);
....................    }
.................... }
.................... 
.................... #Separate
.................... void mode_test_PD()
.................... {
....................    while (TRUE)
....................    {
....................       unsigned int16 pd_value;
....................       set_adc_channel(PD);
....................       pd_value = read_adc(ADC_START_AND_READ); // read voltage at adc pin
....................       fprintf(PC, "pd_value: %X\r\n", pd_value);
....................       delay_ms(1000);
....................    }
.................... }
.................... 
.................... #Separate
.................... void mode_test_CIGS()
.................... {
....................    unsigned int16 cigs_value = 0;
....................    set_adc_channel(3);
....................    cigs_value = read_adc(ADC_START_AND_READ); // read voltage at adc pin
....................    fprintf(PC, "cigs_value: %X\r\n", cigs_value);
.................... }
.................... 
.................... #Separate
.................... void mode_test_current()
.................... {
....................    unsigned int16 current_value = 0;
....................    set_adc_channel(3);
....................    current_value = read_adc(ADC_START_AND_READ); // read voltage at adc pin
....................    fprintf(PC, "current_value: %X\r\n", current_value);
.................... }
.................... 
.................... #Separate
.................... void mode_test_voltage()
.................... {
....................    unsigned int16 voltage_value = 0;
....................    set_adc_channel(3);
....................    voltage_value = read_adc(ADC_START_AND_READ); // read voltage at adc pin
....................    fprintf(PC, "voltage_value: %X\r\n", voltage_value);
.................... }
.................... 
.................... // Flash command 
.................... #Separate
.................... void mode_flash_erase_all()
.................... {
....................    fprintf(PC, "Start Flash Erase All\r\n");
....................    flash_setting(mis_fm);
....................    sector_erase(mis_fm, 0x00000000);
....................    fprintf(PC, "End Flash Erase All\r\n");
.................... }
.................... 
.................... #Separate
.................... void mode_flash_erase_1sector()
.................... {
....................    fprintf(PC, "Start Flash Erase 1 Sector\r\n");
....................    flash_setting(mis_fm);
....................    sector_erase(mis_fm, 0x00000000);
....................    fprintf(PC, "End Flash Erase 1 Sector\r\n");
.................... }
.................... 
.................... #Separate
.................... void mode_flash_copy_1sector()
.................... {
....................    fprintf(PC, "Start Flash Copy 1 Sector\r\n");
....................    flash_setting(mis_fm);
....................    sector_erase(mis_fm, 0x00000000);
....................    fprintf(PC, "End Flash Copy 1 Sector\r\n");
.................... }
.................... 
.................... 
.................... #endif // MMJ_CIGS_MODE_H
.................... 
.................... //------------------End of File------------------
.................... 
.................... 
.................... // SerialCommunication
.................... #include "./lib/communication_driver.h"
.................... #ifndef COMMUNICATION_DRIVER_H
.................... #define COMMUNICATION_DRIVER_H
.................... 
.................... #include "communication.h"
.................... 
.................... 
.................... // This is redundant, but it is a process to hide the Communication library as a driver.
.................... Command make_command(unsigned int8 receive_signal[], int8 receive_signal_size);
.................... 
.................... void transmit_ack();
.................... 
.................... void transmit_status();
.................... 
.................... int1 req_use_smf();
.................... 
.................... 
.................... #include "./src/communication_driver.c"
.................... 
.................... #endif
.................... 
.................... // EOF
.................... 
.................... 
.................... // Copy to SMF
.................... #include "./lib/data_copy.h"
.................... #ifndef DATA_COPY_H
.................... #define DATA_COPY_H
.................... 
.................... #include "smf_queue.h"
.................... #ifndef SMF_QUEUE_H
.................... #define SMF_QUEUE_H
.................... 
.................... // ______________ defines (typedef) ____________
.................... 
.................... typedef struct {
....................     unsigned int32 src;
....................     unsigned int32 dest;
....................     unsigned int32 size;
.................... } SmfDataStruct;
.................... 
.................... #define SMF_DATA_SIZE 16
.................... typedef struct {
....................    SmfDataStruct smf_data[SMF_DATA_SIZE];
....................    int8 smf_data_head;
....................    int8 smf_data_tail;
.................... } SmfQueueStruct;
.................... 
.................... // _____________________ values _________________
.................... 
.................... volatile SmfQueueStruct smf_queue = {0};
.................... 
.................... 
.................... // ___________________ functions ________________
.................... 
.................... void enqueue_smf_data(SmfDataStruct *data);
.................... 
.................... SmfDataStruct *dequeue_smf_data();
.................... 
.................... int1 is_empty_smf_data(void);
.................... 
.................... 
.................... 
.................... #include "src/smf_queue.c"
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... #include "flash.h"
.................... #ifndef FLASH_H
.................... #define FLASH_H
.................... ///////////////////////////////////////////////////////////////////////////////
.................... /////////////////////////GDNS_226_FlashOperation.h/////////////////////////////
.................... //////////////////////////////////ver 2.0//////////////////////////////////////
.................... /////////////////////////////last editor:T Kawai///////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... #define DEBUG
.................... //////////////////////////////port select//////////////////////////////////////
.................... #ifdef DEBUG
....................    #define DEBUG_PORT pc
.................... #endif
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define SPI STREAM////////////////////////////////
.................... #define FLASH_STREAM0 MIS_FM_STREAM     // <- Align the names to `config.h` Stream name
.................... #define FLASH_STREAM1 SMF_STREAM
.................... #define FLASH_STREAM2 SMF_STREAM // dont use
.................... #define FLASH_STREAM3 SMF_STREAM // dont use
.................... typedef enum spi_stream{
....................    SPI_0,
....................    SPI_1,
....................    SPI_2,
....................    SPI_3,
.................... }SpiStreamId;
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define Model name////////////////////////////////
.................... #define MT25QL128ABA 0x00     //Mission Flash
.................... #define MT25QL01GBBB 0x01     //SMF,CF
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////define structure member/////////////////////////////
.................... typedef struct select_stream_to_flash{
....................    SpiStreamId spi_stream_id;
....................    unsigned int8 flash_model;
....................    int16 cs_pin;
.................... }Flash;
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////    values    //////////////////////////////////////
.................... 
.................... Flash mis_fm = {SPI_0, MT25QL128ABA, SPI0_CS};
.................... Flash smf = {SPI_1, MT25QL01GBBB, SPI1_CS};
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////////////////CMD List///////////////////////////////////////
.................... #define CMD_READ_ID                     0x9F
.................... #define CMD_READ_STATUS_REGISTER        0x05
.................... #define CMD_READ                        0x03//for MT25QL128ABA
.................... #define CMD_4BYTE_READ                  0x13//for MT25QL01GBBB
.................... #define CMD_WRITE_ENABLE                0x06
.................... #define CMD_PAGE_PROGRAM                0x02//for MT25QL128ABA
.................... #define CMD_4BYTE_PAGE_PROGRAM          0x12//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_4KB_ERASE         0x20//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_4KB_ERASE   0x21//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_32KB_ERASE        0x52//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_32KB_ERASE  0x5C//for MT25QL01GBBB
.................... #define CMD_SECTOR_ERASE                0xD8//for MT25QL128ABA
.................... #define CMD_4BYTE_SECTOR_ERASE          0xDC//for MT25QL01GBBB
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////function List///////////////////////////////////////
.................... //higher all spi csPINs
.................... void flash_setting(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //bit[7:2]status register control bit,bit[1]write enable bit T:ennable F:disable,bit[0]write in progress bit T:busy F:ready
.................... int8 status_register(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //T:Flash id read successfully(connect OK),F:Flash id read failed
.................... int8 read_id(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //64kByte erase
.................... void sector_erase(Flash flash_stream, unsigned int32 sector_address);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //32kByte erase
.................... void subsector_32kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //4kByte erase
.................... void subsector_4kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                  
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read 1 Byte data
.................... int8 read_data_byte(Flash flash_stream, unsigned int32 read_address);                                               
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read multi Bytes data(max 128 MByte) and store to "read_data"
.................... void read_data_bytes(Flash flash_stream, unsigned int32 read_start_address, int8 *read_data, unsigned int32 read_amount);        
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write 1 Byte data to flash
.................... void write_data_byte(Flash flash_stream, unsigned int32 write_address,int8 write_data);                             
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write multi Bytes data(max256 Byte) in "write_data" to flash
.................... void write_data_bytes(Flash flash_stream, unsigned int32 write_start_address, int8 *write_data, unsigned int16 write_amount);              
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////end of GDNS_226_FlashOperation.h///////////////////////////
.................... #include "src/flash.c"
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... 
.................... void copy_data();
.................... 
.................... 
.................... #include "./src/data_copy.c"
.................... #include "smf_queue.h"
.................... #ifndef SMF_QUEUE_H
.................... #define SMF_QUEUE_H
.................... 
.................... // ______________ defines (typedef) ____________
.................... 
.................... typedef struct {
....................     unsigned int32 src;
....................     unsigned int32 dest;
....................     unsigned int32 size;
.................... } SmfDataStruct;
.................... 
.................... #define SMF_DATA_SIZE 16
.................... typedef struct {
....................    SmfDataStruct smf_data[SMF_DATA_SIZE];
....................    int8 smf_data_head;
....................    int8 smf_data_tail;
.................... } SmfQueueStruct;
.................... 
.................... // _____________________ values _________________
.................... 
.................... volatile SmfQueueStruct smf_queue = {0};
.................... 
.................... 
.................... // ___________________ functions ________________
.................... 
.................... void enqueue_smf_data(SmfDataStruct *data);
.................... 
.................... SmfDataStruct *dequeue_smf_data();
.................... 
.................... int1 is_empty_smf_data(void);
.................... 
.................... 
.................... 
.................... #include "src/smf_queue.c"
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... #include "flash.h"
.................... #ifndef FLASH_H
.................... #define FLASH_H
.................... ///////////////////////////////////////////////////////////////////////////////
.................... /////////////////////////GDNS_226_FlashOperation.h/////////////////////////////
.................... //////////////////////////////////ver 2.0//////////////////////////////////////
.................... /////////////////////////////last editor:T Kawai///////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... #define DEBUG
.................... //////////////////////////////port select//////////////////////////////////////
.................... #ifdef DEBUG
....................    #define DEBUG_PORT pc
.................... #endif
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define SPI STREAM////////////////////////////////
.................... #define FLASH_STREAM0 MIS_FM_STREAM     // <- Align the names to `config.h` Stream name
.................... #define FLASH_STREAM1 SMF_STREAM
.................... #define FLASH_STREAM2 SMF_STREAM // dont use
.................... #define FLASH_STREAM3 SMF_STREAM // dont use
.................... typedef enum spi_stream{
....................    SPI_0,
....................    SPI_1,
....................    SPI_2,
....................    SPI_3,
.................... }SpiStreamId;
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define Model name////////////////////////////////
.................... #define MT25QL128ABA 0x00     //Mission Flash
.................... #define MT25QL01GBBB 0x01     //SMF,CF
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////define structure member/////////////////////////////
.................... typedef struct select_stream_to_flash{
....................    SpiStreamId spi_stream_id;
....................    unsigned int8 flash_model;
....................    int16 cs_pin;
.................... }Flash;
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////    values    //////////////////////////////////////
.................... 
.................... Flash mis_fm = {SPI_0, MT25QL128ABA, SPI0_CS};
.................... Flash smf = {SPI_1, MT25QL01GBBB, SPI1_CS};
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////////////////CMD List///////////////////////////////////////
.................... #define CMD_READ_ID                     0x9F
.................... #define CMD_READ_STATUS_REGISTER        0x05
.................... #define CMD_READ                        0x03//for MT25QL128ABA
.................... #define CMD_4BYTE_READ                  0x13//for MT25QL01GBBB
.................... #define CMD_WRITE_ENABLE                0x06
.................... #define CMD_PAGE_PROGRAM                0x02//for MT25QL128ABA
.................... #define CMD_4BYTE_PAGE_PROGRAM          0x12//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_4KB_ERASE         0x20//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_4KB_ERASE   0x21//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_32KB_ERASE        0x52//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_32KB_ERASE  0x5C//for MT25QL01GBBB
.................... #define CMD_SECTOR_ERASE                0xD8//for MT25QL128ABA
.................... #define CMD_4BYTE_SECTOR_ERASE          0xDC//for MT25QL01GBBB
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////function List///////////////////////////////////////
.................... //higher all spi csPINs
.................... void flash_setting(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //bit[7:2]status register control bit,bit[1]write enable bit T:ennable F:disable,bit[0]write in progress bit T:busy F:ready
.................... int8 status_register(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //T:Flash id read successfully(connect OK),F:Flash id read failed
.................... int8 read_id(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //64kByte erase
.................... void sector_erase(Flash flash_stream, unsigned int32 sector_address);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //32kByte erase
.................... void subsector_32kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //4kByte erase
.................... void subsector_4kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                  
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read 1 Byte data
.................... int8 read_data_byte(Flash flash_stream, unsigned int32 read_address);                                               
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read multi Bytes data(max 128 MByte) and store to "read_data"
.................... void read_data_bytes(Flash flash_stream, unsigned int32 read_start_address, int8 *read_data, unsigned int32 read_amount);        
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write 1 Byte data to flash
.................... void write_data_byte(Flash flash_stream, unsigned int32 write_address,int8 write_data);                             
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write multi Bytes data(max256 Byte) in "write_data" to flash
.................... void write_data_bytes(Flash flash_stream, unsigned int32 write_start_address, int8 *write_data, unsigned int16 write_amount);              
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////end of GDNS_226_FlashOperation.h///////////////////////////
.................... #include "src/flash.c"
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... 
.................... 
.................... void copy_data()
.................... {   
....................    while (!is_empty_smf_data())
*
11DC:  MOVLP  08
11DD:  CALL   668
11DE:  MOVLP  10
11DF:  MOVF   78,F
11E0:  BTFSS  03.2
11E1:  GOTO   379
....................    {
....................       SmfDataStruct *smf_data = dequeue_smf_data();
*
1211:  MOVF   79,W
1212:  MOVLB  10
1213:  MOVWF  38
1214:  MOVF   78,W
1215:  MOVWF  37
....................       fprintf(PC, "Destination address: \t0x%08LX\r\n", smf_data->dest);
1216:  MOVF   37,W
1217:  MOVWF  04
1218:  MOVF   38,W
1219:  MOVWF  05
121A:  ADDFSR 04,FSR0
121B:  MOVF   00,W
121C:  MOVWF  3C
121D:  ADDFSR 01,FSR0
121E:  MOVF   00,W
121F:  MOVWF  3D
1220:  ADDFSR 01,FSR0
1221:  MOVF   00,W
1222:  MOVWF  3E
1223:  ADDFSR 01,FSR0
1224:  MOVF   00,W
1225:  MOVWF  3F
1226:  ADDFSR 3D,FSR0
1227:  MOVLW  BE
1228:  MOVLB  03
1229:  MOVWF  11
122A:  MOVLW  03
122B:  MOVWF  12
122C:  BCF    03.0
122D:  MOVLW  18
122E:  MOVLB  10
122F:  MOVWF  6C
1230:  MOVLP  00
1231:  MOVLB  00
1232:  CALL   78D
1233:  MOVLP  10
1234:  MOVLB  10
1235:  MOVF   3F,W
1236:  MOVWF  6C
1237:  MOVLW  37
1238:  MOVWF  6D
1239:  MOVLP  00
123A:  MOVLB  00
123B:  CALL   6E7
123C:  MOVLP  10
123D:  MOVLB  10
123E:  MOVF   3E,W
123F:  MOVWF  6C
1240:  MOVLW  37
1241:  MOVWF  6D
1242:  MOVLP  00
1243:  MOVLB  00
1244:  CALL   6E7
1245:  MOVLP  10
1246:  MOVLB  10
1247:  MOVF   3D,W
1248:  MOVWF  6C
1249:  MOVLW  37
124A:  MOVWF  6D
124B:  MOVLP  00
124C:  MOVLB  00
124D:  CALL   6E7
124E:  MOVLP  10
124F:  MOVLB  10
1250:  MOVF   3C,W
1251:  MOVWF  6C
1252:  MOVLW  37
1253:  MOVWF  6D
1254:  MOVLP  00
1255:  MOVLB  00
1256:  CALL   6E7
1257:  MOVLP  10
1258:  MOVLW  0D
1259:  MOVLB  11
125A:  MOVWF  20
125B:  MOVLP  00
125C:  MOVLB  00
125D:  CALL   5DE
125E:  MOVLP  10
125F:  MOVLW  0A
1260:  MOVLB  11
1261:  MOVWF  20
1262:  MOVLP  00
1263:  MOVLB  00
1264:  CALL   5DE
1265:  MOVLP  10
....................       fprintf(PC, "Source address: \t0x%08LX\r\n", smf_data->src);
1266:  MOVLB  10
1267:  MOVF   37,W
1268:  MOVWF  04
1269:  MOVF   38,W
126A:  MOVWF  05
126B:  ADDFSR 00,FSR0
126C:  MOVF   00,W
126D:  MOVWF  3C
126E:  ADDFSR 01,FSR0
126F:  MOVF   00,W
1270:  MOVWF  3D
1271:  ADDFSR 01,FSR0
1272:  MOVF   00,W
1273:  MOVWF  3E
1274:  ADDFSR 01,FSR0
1275:  MOVF   00,W
1276:  MOVWF  3F
1277:  ADDFSR 3D,FSR0
1278:  MOVLW  CE
1279:  MOVLB  03
127A:  MOVWF  11
127B:  MOVLW  03
127C:  MOVWF  12
127D:  BCF    03.0
127E:  MOVLW  13
127F:  MOVLB  10
1280:  MOVWF  6C
1281:  MOVLP  00
1282:  MOVLB  00
1283:  CALL   78D
1284:  MOVLP  10
1285:  MOVLB  10
1286:  MOVF   3F,W
1287:  MOVWF  6C
1288:  MOVLW  37
1289:  MOVWF  6D
128A:  MOVLP  00
128B:  MOVLB  00
128C:  CALL   6E7
128D:  MOVLP  10
128E:  MOVLB  10
128F:  MOVF   3E,W
1290:  MOVWF  6C
1291:  MOVLW  37
1292:  MOVWF  6D
1293:  MOVLP  00
1294:  MOVLB  00
1295:  CALL   6E7
1296:  MOVLP  10
1297:  MOVLB  10
1298:  MOVF   3D,W
1299:  MOVWF  6C
129A:  MOVLW  37
129B:  MOVWF  6D
129C:  MOVLP  00
129D:  MOVLB  00
129E:  CALL   6E7
129F:  MOVLP  10
12A0:  MOVLB  10
12A1:  MOVF   3C,W
12A2:  MOVWF  6C
12A3:  MOVLW  37
12A4:  MOVWF  6D
12A5:  MOVLP  00
12A6:  MOVLB  00
12A7:  CALL   6E7
12A8:  MOVLP  10
12A9:  MOVLW  0D
12AA:  MOVLB  11
12AB:  MOVWF  20
12AC:  MOVLP  00
12AD:  MOVLB  00
12AE:  CALL   5DE
12AF:  MOVLP  10
12B0:  MOVLW  0A
12B1:  MOVLB  11
12B2:  MOVWF  20
12B3:  MOVLP  00
12B4:  MOVLB  00
12B5:  CALL   5DE
12B6:  MOVLP  10
....................       fprintf(PC, "Data size: \t\t  %08LX\r\n", smf_data->size);
12B7:  MOVLB  10
12B8:  MOVF   37,W
12B9:  MOVWF  04
12BA:  MOVF   38,W
12BB:  MOVWF  05
12BC:  ADDFSR 08,FSR0
12BD:  MOVF   00,W
12BE:  MOVWF  3C
12BF:  ADDFSR 01,FSR0
12C0:  MOVF   00,W
12C1:  MOVWF  3D
12C2:  ADDFSR 01,FSR0
12C3:  MOVF   00,W
12C4:  MOVWF  3E
12C5:  ADDFSR 01,FSR0
12C6:  MOVF   00,W
12C7:  MOVWF  3F
12C8:  ADDFSR 3D,FSR0
12C9:  MOVLW  DC
12CA:  MOVLB  03
12CB:  MOVWF  11
12CC:  MOVLW  03
12CD:  MOVWF  12
12CE:  BCF    03.0
12CF:  MOVLW  0F
12D0:  MOVLB  10
12D1:  MOVWF  6C
12D2:  MOVLP  00
12D3:  MOVLB  00
12D4:  CALL   78D
12D5:  MOVLP  10
12D6:  MOVLB  10
12D7:  MOVF   3F,W
12D8:  MOVWF  6C
12D9:  MOVLW  37
12DA:  MOVWF  6D
12DB:  MOVLP  00
12DC:  MOVLB  00
12DD:  CALL   6E7
12DE:  MOVLP  10
12DF:  MOVLB  10
12E0:  MOVF   3E,W
12E1:  MOVWF  6C
12E2:  MOVLW  37
12E3:  MOVWF  6D
12E4:  MOVLP  00
12E5:  MOVLB  00
12E6:  CALL   6E7
12E7:  MOVLP  10
12E8:  MOVLB  10
12E9:  MOVF   3D,W
12EA:  MOVWF  6C
12EB:  MOVLW  37
12EC:  MOVWF  6D
12ED:  MOVLP  00
12EE:  MOVLB  00
12EF:  CALL   6E7
12F0:  MOVLP  10
12F1:  MOVLB  10
12F2:  MOVF   3C,W
12F3:  MOVWF  6C
12F4:  MOVLW  37
12F5:  MOVWF  6D
12F6:  MOVLP  00
12F7:  MOVLB  00
12F8:  CALL   6E7
12F9:  MOVLP  10
12FA:  MOVLW  0D
12FB:  MOVLB  11
12FC:  MOVWF  20
12FD:  MOVLP  00
12FE:  MOVLB  00
12FF:  CALL   5DE
1300:  MOVLP  10
1301:  MOVLW  0A
1302:  MOVLB  11
1303:  MOVWF  20
1304:  MOVLP  00
1305:  MOVLB  00
1306:  CALL   5DE
1307:  MOVLP  10
....................       fprintf(PC, "Copying.");
1308:  MOVLW  E8
1309:  MOVLB  03
130A:  MOVWF  11
130B:  MOVLW  03
130C:  MOVWF  12
130D:  MOVLP  00
130E:  MOVLB  00
130F:  CALL   603
1310:  MOVLP  10
....................       delay_ms(1000);
1311:  MOVLW  04
1312:  MOVLB  10
1313:  MOVWF  3C
1314:  MOVLW  FA
1315:  MOVWF  4A
1316:  MOVLP  00
1317:  MOVLB  00
1318:  CALL   6C4
1319:  MOVLP  10
131A:  MOVLB  10
131B:  DECFSZ 3C,F
131C:  GOTO   314
....................       fprintf(PC, ".");
131D:  MOVLW  2E
131E:  MOVLB  11
131F:  MOVWF  20
1320:  MOVLP  00
1321:  MOVLB  00
1322:  CALL   5DE
1323:  MOVLP  10
....................       delay_ms(1000);
1324:  MOVLW  04
1325:  MOVLB  10
1326:  MOVWF  3C
1327:  MOVLW  FA
1328:  MOVWF  4A
1329:  MOVLP  00
132A:  MOVLB  00
132B:  CALL   6C4
132C:  MOVLP  10
132D:  MOVLB  10
132E:  DECFSZ 3C,F
132F:  GOTO   327
....................       fprintf(PC, ".");
1330:  MOVLW  2E
1331:  MOVLB  11
1332:  MOVWF  20
1333:  MOVLP  00
1334:  MOVLB  00
1335:  CALL   5DE
1336:  MOVLP  10
....................       delay_ms(1000);
1337:  MOVLW  04
1338:  MOVLB  10
1339:  MOVWF  3C
133A:  MOVLW  FA
133B:  MOVWF  4A
133C:  MOVLP  00
133D:  MOVLB  00
133E:  CALL   6C4
133F:  MOVLP  10
1340:  MOVLB  10
1341:  DECFSZ 3C,F
1342:  GOTO   33A
....................       fprintf(PC, ".");   
1343:  MOVLW  2E
1344:  MOVLB  11
1345:  MOVWF  20
1346:  MOVLP  00
1347:  MOVLB  00
1348:  CALL   5DE
1349:  MOVLP  10
....................       delay_ms(1000);
134A:  MOVLW  04
134B:  MOVLB  10
134C:  MOVWF  3C
134D:  MOVLW  FA
134E:  MOVWF  4A
134F:  MOVLP  00
1350:  MOVLB  00
1351:  CALL   6C4
1352:  MOVLP  10
1353:  MOVLB  10
1354:  DECFSZ 3C,F
1355:  GOTO   34D
....................       fprintf(PC, ".\r\n");   
1356:  MOVLW  2E
1357:  MOVLB  11
1358:  MOVWF  20
1359:  MOVLP  00
135A:  MOVLB  00
135B:  CALL   5DE
135C:  MOVLP  10
135D:  MOVLW  0D
135E:  MOVLB  11
135F:  MOVWF  20
1360:  MOVLP  00
1361:  MOVLB  00
1362:  CALL   5DE
1363:  MOVLP  10
1364:  MOVLW  0A
1365:  MOVLB  11
1366:  MOVWF  20
1367:  MOVLP  00
1368:  MOVLB  00
1369:  CALL   5DE
136A:  MOVLP  10
....................       delay_ms(1000);
136B:  MOVLW  04
136C:  MOVLB  10
136D:  MOVWF  3C
136E:  MOVLW  FA
136F:  MOVWF  4A
1370:  MOVLP  00
1371:  MOVLB  00
1372:  CALL   6C4
1373:  MOVLP  10
1374:  MOVLB  10
1375:  DECFSZ 3C,F
1376:  GOTO   36E
1377:  MOVLB  00
1378:  GOTO   1DC
....................    }
....................    fprintf(PC, "_________End copy_data_________\r\n______________________________\r\n\r\n");
1379:  MOVLW  ED
137A:  MOVLB  03
137B:  MOVWF  11
137C:  MOVLW  03
137D:  MOVWF  12
137E:  MOVLP  00
137F:  MOVLB  00
1380:  CALL   603
1381:  MOVLP  10
.................... }
.................... 
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... 
.................... #include "mmj_cigs_excute_mission.h"
.................... #ifndef MMJ_CIGS_EXCUTE_MISSION_H
.................... #define MMJ_CIGS_EXCUTE_MISSION_H
.................... 
.................... // _________ values _________
.................... #define PARAMETER_LENGTH 8
.................... 
.................... #Separate
.................... int1 execute_command(Command *command);
.................... int1 handle_uplink_command(Command *command);
.................... int1 handle_status_check(Command *command);
.................... int1 handle_smf_available(Command *command);
.................... void execute_mission(unsigned int8 *content);
.................... 
.................... #include "../mmj_cigs_excute_mission.c"
.................... #include "mmj_cigs_mode.h"
.................... #ifndef MMJ_CIGS_MODE_H
.................... #define MMJ_CIGS_MODE_H
.................... 
.................... 
.................... // ___________MODE FUNCTIONS____________
.................... 
.................... #Separate
.................... void mode_measure(unsigned int8 parameter[]);
.................... 
.................... // Flash command 
.................... #Separate
.................... void mode_flash_erase_all();
.................... #Separate
.................... void mode_flash_erase_1sector();
.................... #Separate
.................... void mode_flash_copy_1sector();
.................... #Separate
.................... void mode_flash_write_1sector();
.................... #Separate
.................... void mode_flash_func2();
.................... #Separate
.................... void mode_flash_read();
.................... #Separate
.................... void mode_flash_read_address();
.................... 
.................... // IV command
.................... #Separate
.................... void mode_iv_measure();
.................... #Separate
.................... void mode_iv_measure_voltage();
.................... 
.................... 
.................... 
.................... // Development command
.................... #Separate
.................... void mode_dev_vol();
.................... #Separate
.................... void mode_dev_cur();
.................... #Separate
.................... void mode_dev_temp();   
.................... #Separate
.................... void mode_dev_pd();
.................... #Separate
.................... void mode_dev_cigs();
.................... #Separate
.................... void mode_dev_time();
.................... #Separate
.................... void mode_dev_sweep();
.................... 
.................... // ______________CMD ID________________
.................... #define ID_SWEEP 0x01
.................... 
.................... // Flash command 
.................... #define ID_FLASH_ERASE_ALL 0xA0
.................... #define ID_FLASH_ERASE_1SECTOR 0xA1
.................... #define ID_FLASH_COPY_1SECTOR 0xA2
.................... #define ID_FLASH_WRITE_1SECTOR 0xA3
.................... #define ID_FLASH_FUNC2 0xA4
.................... #define ID_FLASH_READ 0xA5
.................... #define ID_FLASH_READ_ADDRESS 0xA6
.................... 
.................... // IV command
.................... #define ID_IV_MEASURE 0xB0
.................... #define ID_IV_MEASURE_VOLTAGE 0xB1
.................... 
.................... // Development command
.................... #define ID_DEV_VOL 0xC0
.................... #define ID_DEV_CUR 0xC1
.................... #define ID_DEV_TEMP 0xC1
.................... #define ID_DEV_PD 0xC2
.................... #define ID_DEV_CIGS 0xC3
.................... #define ID_DEV_TIME 0xC4
.................... #define ID_DEV_SWEEP 0xC5
.................... 
.................... #include "../mmj_cigs_mode.c"
.................... 
.................... #endif // MMJ_CIGS_MODE_H
.................... 
.................... //------------------End of File------------------
.................... 
.................... 
.................... #separate
.................... int1 execute_command(Command *command)
.................... {
....................    fprintf(PC, "Start execute_command\r\n");
*
1000:  MOVLW  0F
1001:  MOVLB  03
1002:  MOVWF  11
1003:  MOVLW  04
1004:  MOVWF  12
1005:  MOVLP  00
1006:  MOVLB  00
1007:  CALL   603
1008:  MOVLP  10
.................... 
....................    switch (command->frame_id)
1009:  MOVLB  10
100A:  MOVF   33,W
100B:  MOVWF  04
100C:  MOVF   34,W
100D:  MOVWF  05
100E:  ADDFSR 00,FSR0
100F:  MOVF   00,W
1010:  XORLW  00
1011:  MOVLB  00
1012:  BTFSC  03.2
1013:  GOTO   01B
1014:  XORLW  01
1015:  BTFSC  03.2
1016:  GOTO   152
1017:  XORLW  03
1018:  BTFSC  03.2
1019:  GOTO   1AE
101A:  GOTO   393
....................    {
....................       case UPLINK_COMMAND:
....................          return handle_uplink_command(command);
101B:  MOVLB  10
101C:  MOVF   34,W
101D:  MOVWF  36
101E:  MOVF   33,W
101F:  MOVWF  35
*
1150:  MOVF   78,W
1151:  GOTO   395
....................       
....................       case STATUS_CHECK:
....................          return handle_status_check(command);
1152:  MOVLB  10
1153:  MOVF   34,W
1154:  MOVWF  36
1155:  MOVF   33,W
1156:  MOVWF  35
*
11AC:  MOVF   78,W
11AD:  GOTO   395
....................       
....................       case IS_SMF_AVAILABLE:
....................          return handle_smf_available(command);
11AE:  MOVLB  10
11AF:  MOVF   34,W
11B0:  MOVWF  36
11B1:  MOVF   33,W
11B2:  MOVWF  35
*
1391:  MOVF   78,W
1392:  GOTO   395
....................    }
.................... 
....................    return FALSE;
1393:  MOVLW  00
1394:  MOVWF  78
1395:  MOVLP  10
1396:  GOTO   516 (RETURN)
.................... }
.................... 
.................... 
.................... // ___________ command execution ___________
.................... int1 handle_uplink_command(Command *command)
.................... {
....................    fprintf(PC, "\t-> Uplink command\r\n");
*
1020:  MOVLW  1B
1021:  MOVLB  03
1022:  MOVWF  11
1023:  MOVLW  04
1024:  MOVWF  12
1025:  MOVLP  00
1026:  MOVLB  00
1027:  CALL   603
1028:  MOVLP  10
....................    fprintf(PC, "\t   Transmit Acknowledge\r\n");
1029:  MOVLW  26
102A:  MOVLB  03
102B:  MOVWF  11
102C:  MOVLW  04
102D:  MOVWF  12
102E:  MOVLP  00
102F:  MOVLB  00
1030:  CALL   603
1031:  MOVLP  10
....................    transmit_ack();
1032:  MOVLP  08
1033:  CALL   374
1034:  MOVLP  10
.................... 
....................    status = EXECUTING_MISSION;
1035:  MOVLW  02
1036:  MOVWF  2B
....................    execute_mission(command->content);
1037:  MOVLW  01
1038:  MOVLB  10
1039:  ADDWF  35,W
103A:  MOVWF  78
103B:  MOVLW  00
103C:  ADDWFC 36,W
103D:  MOVWF  7A
103E:  MOVF   78,W
103F:  MOVWF  38
1040:  MOVF   7A,W
1041:  MOVWF  39
1042:  MOVF   39,W
1043:  MOVWF  3B
1044:  MOVF   38,W
1045:  MOVWF  3A
.................... 
....................    if (is_empty_smf_data())
*
1130:  MOVLP  08
1131:  CALL   668
1132:  MOVLP  10
1133:  MOVF   78,F
1134:  BTFSC  03.2
1135:  GOTO   14C
....................    {
....................       if (duration_sec < sec)
1136:  MOVF   33,F
1137:  BTFSS  03.2
1138:  GOTO   146
1139:  MOVF   32,F
113A:  BTFSS  03.2
113B:  GOTO   146
113C:  MOVF   29,W
113D:  SUBWF  31,W
113E:  BTFSS  03.0
113F:  GOTO   149
1140:  BTFSS  03.2
1141:  GOTO   146
1142:  MOVF   30,W
1143:  SUBWF  28,W
1144:  BTFSC  03.0
1145:  GOTO   149
....................          status = FINISHED;
1146:  MOVLW  06
1147:  MOVWF  2B
1148:  GOTO   14B
....................       else
....................          status = IDLE;
1149:  MOVLW  03
114A:  MOVWF  2B
....................    }
114B:  GOTO   14E
....................    else
....................    {
....................       status = SMF_USE_REQ;
114C:  MOVLW  04
114D:  MOVWF  2B
....................    }
.................... 
....................    return FALSE;
114E:  MOVLW  00
114F:  MOVWF  78
.................... }
.................... 
.................... 
.................... int1 handle_status_check(Command *command)
.................... {
....................    fprintf(PC, "\t-> Status check\r\n");
*
1157:  MOVLW  34
1158:  MOVLB  03
1159:  MOVWF  11
115A:  MOVLW  04
115B:  MOVWF  12
115C:  MOVLP  00
115D:  MOVLB  00
115E:  CALL   603
115F:  MOVLP  10
....................    fprintf(PC, "\t\t-> My status is %d\r\n", status);
1160:  MOVLW  3E
1161:  MOVLB  03
1162:  MOVWF  11
1163:  MOVLW  04
1164:  MOVWF  12
1165:  BCF    03.0
1166:  MOVLW  12
1167:  MOVLB  10
1168:  MOVWF  6C
1169:  MOVLP  00
116A:  MOVLB  00
116B:  CALL   78D
116C:  MOVLP  10
116D:  MOVF   2B,W
116E:  MOVLB  10
116F:  MOVWF  3F
1170:  MOVLW  18
1171:  MOVWF  40
1172:  MOVLP  08
1173:  MOVLB  00
1174:  CALL   256
1175:  MOVLP  10
1176:  MOVLW  0D
1177:  MOVLB  11
1178:  MOVWF  20
1179:  MOVLP  00
117A:  MOVLB  00
117B:  CALL   5DE
117C:  MOVLP  10
117D:  MOVLW  0A
117E:  MOVLB  11
117F:  MOVWF  20
1180:  MOVLP  00
1181:  MOVLB  00
1182:  CALL   5DE
1183:  MOVLP  10
....................    fprintf(PC, "\t   Transmit MIS MCU Status\r\n");
1184:  MOVLW  4A
1185:  MOVLB  03
1186:  MOVWF  11
1187:  MOVLW  04
1188:  MOVWF  12
1189:  MOVLP  00
118A:  MOVLB  00
118B:  CALL   603
118C:  MOVLP  10
....................    transmit_status();
.................... 
....................    if (status == FINISHED)
*
119A:  MOVF   2B,W
119B:  SUBLW  06
119C:  BTFSS  03.2
119D:  GOTO   1AA
....................    {
....................       fprintf(PC, "finished in status_check\r\n");
119E:  MOVLW  59
119F:  MOVLB  03
11A0:  MOVWF  11
11A1:  MOVLW  04
11A2:  MOVWF  12
11A3:  MOVLP  00
11A4:  MOVLB  00
11A5:  CALL   603
11A6:  MOVLP  10
....................       return TRUE;
11A7:  MOVLW  01
11A8:  MOVWF  78
11A9:  GOTO   1AC
....................    }
.................... 
....................    return FALSE;
11AA:  MOVLW  00
11AB:  MOVWF  78
.................... }
.................... 
.................... int1 handle_smf_available(Command *command)
.................... {
....................    fprintf(PC, "\t-> is SMF available\r\n");
*
11B3:  MOVLW  67
11B4:  MOVLB  03
11B5:  MOVWF  11
11B6:  MOVLW  04
11B7:  MOVWF  12
11B8:  MOVLP  00
11B9:  MOVLB  00
11BA:  CALL   603
11BB:  MOVLP  10
....................    fprintf(PC, "\t   Transmit Acknowledge\r\n");
11BC:  MOVLW  73
11BD:  MOVLB  03
11BE:  MOVWF  11
11BF:  MOVLW  04
11C0:  MOVWF  12
11C1:  MOVLP  00
11C2:  MOVLB  00
11C3:  CALL   603
11C4:  MOVLP  10
....................    transmit_ack();
11C5:  MOVLP  08
11C6:  CALL   374
11C7:  MOVLP  10
.................... 
....................    if (command->content[0] == ALLOW)
11C8:  MOVLB  10
11C9:  MOVF   35,W
11CA:  MOVWF  04
11CB:  MOVF   36,W
11CC:  MOVWF  05
11CD:  ADDFSR 01,FSR0
11CE:  MOVF   00,F
11CF:  BTFSS  03.2
11D0:  GOTO   386
....................    {
....................       fprintf(PC, "\t\t-> allowed\r\n");
11D1:  MOVLW  81
11D2:  MOVLB  03
11D3:  MOVWF  11
11D4:  MOVLW  04
11D5:  MOVWF  12
11D6:  MOVLP  00
11D7:  MOVLB  00
11D8:  CALL   603
11D9:  MOVLP  10
....................       status = COPYING;
11DA:  MOVLW  05
11DB:  MOVWF  2B
....................       copy_data();
....................       status = FINISHED;
*
1382:  MOVLW  06
1383:  MOVWF  2B
....................    }
1384:  GOTO   38F
1385:  MOVLB  10
....................    else
....................    {
....................       fprintf(PC, "\t\t-> denied\r\n");
1386:  MOVLW  89
1387:  MOVLB  03
1388:  MOVWF  11
1389:  MOVLW  04
138A:  MOVWF  12
138B:  MOVLP  00
138C:  MOVLB  00
138D:  CALL   603
138E:  MOVLP  10
....................    }
.................... 
....................    return FALSE;
138F:  MOVLW  00
1390:  MOVWF  78
.................... }
.................... 
.................... void execute_mission(unsigned int8 *content)
*
1046:  MOVF   3A,W
1047:  MOVWF  04
1048:  MOVF   3B,W
1049:  MOVWF  05
104A:  MOVIW  [FSR0+00],W
104B:  MOVWF  3C
104C:  MOVLW  01
104D:  ADDWF  3A,W
104E:  MOVWF  78
104F:  MOVLW  00
1050:  ADDWFC 3B,W
1051:  MOVWF  7A
1052:  MOVF   78,W
1053:  MOVWF  3D
1054:  MOVF   7A,W
1055:  MOVWF  3E
.................... {
....................    // record to executed mission list
....................    unsigned int8 command_id = content[0];
....................    unsigned int8 *parameter = &content[1];
....................    
....................    if (is_executed_mission(command_id))
1056:  MOVF   3C,W
1057:  MOVWF  3F
*
1084:  MOVF   78,F
1085:  BTFSC  03.2
1086:  GOTO   0AD
....................    {
....................       fprintf(PC, "\r\nThis  mission is executed\r\n\t-> 0x%d\r\n", command_id);
1087:  MOVLW  90
1088:  MOVLB  03
1089:  MOVWF  11
108A:  MOVLW  04
108B:  MOVWF  12
108C:  BCF    03.0
108D:  MOVLW  23
108E:  MOVLB  10
108F:  MOVWF  6C
1090:  MOVLP  00
1091:  MOVLB  00
1092:  CALL   78D
1093:  MOVLP  10
1094:  MOVLB  10
1095:  MOVF   3C,W
1096:  MOVWF  3F
1097:  MOVLW  18
1098:  MOVWF  40
1099:  MOVLP  08
109A:  MOVLB  00
109B:  CALL   256
109C:  MOVLP  10
109D:  MOVLW  0D
109E:  MOVLB  11
109F:  MOVWF  20
10A0:  MOVLP  00
10A1:  MOVLB  00
10A2:  CALL   5DE
10A3:  MOVLP  10
10A4:  MOVLW  0A
10A5:  MOVLB  11
10A6:  MOVWF  20
10A7:  MOVLP  00
10A8:  MOVLB  00
10A9:  CALL   5DE
10AA:  MOVLP  10
....................       return;
10AB:  GOTO   130
10AC:  MOVLB  10
....................    }
....................    
....................    add_executed_mission(command_id);
10AD:  MOVF   3C,W
10AE:  MOVWF  3F
....................    
....................    // execution mission
....................    fprintf(PC, "\r\n____________________________________\r\n________Start execute_mission________\r\n\r\n");
*
10DD:  MOVLW  A4
10DE:  MOVLB  03
10DF:  MOVWF  11
10E0:  MOVLW  04
10E1:  MOVWF  12
10E2:  MOVLP  00
10E3:  MOVLB  00
10E4:  CALL   603
10E5:  MOVLP  10
....................    fprintf(PC, "Command ID: %X\r\n\r\n", command_id);
10E6:  MOVLW  CD
10E7:  MOVLB  03
10E8:  MOVWF  11
10E9:  MOVLW  04
10EA:  MOVWF  12
10EB:  BCF    03.0
10EC:  MOVLW  0C
10ED:  MOVLB  10
10EE:  MOVWF  6C
10EF:  MOVLP  00
10F0:  MOVLB  00
10F1:  CALL   78D
10F2:  MOVLP  10
10F3:  MOVLB  10
10F4:  MOVF   3C,W
10F5:  MOVWF  6C
10F6:  MOVLW  37
10F7:  MOVWF  6D
10F8:  MOVLP  00
10F9:  MOVLB  00
10FA:  CALL   6E7
10FB:  MOVLP  10
10FC:  MOVLW  D4
10FD:  MOVLB  03
10FE:  MOVWF  11
10FF:  MOVLW  04
1100:  MOVWF  12
1101:  BCF    03.0
1102:  MOVLW  04
1103:  MOVLB  10
1104:  MOVWF  6C
1105:  MOVLP  00
1106:  MOVLB  00
1107:  CALL   78D
1108:  MOVLP  10
....................    switch(command_id)
1109:  MOVLB  10
110A:  MOVF   3C,W
110B:  XORLW  01
110C:  MOVLB  00
110D:  BTFSC  03.2
110E:  GOTO   113
110F:  XORLW  A1
1110:  BTFSC  03.2
1111:  GOTO   11D
1112:  GOTO   11E
....................    {
....................       case ID_SWEEP:
....................          mode_measure(parameter);
1113:  MOVLB  10
1114:  MOVF   3E,W
1115:  MOVWF  40
1116:  MOVF   3D,W
1117:  MOVWF  3F
1118:  MOVLP  08
1119:  MOVLB  00
111A:  GOTO   652
111B:  MOVLP  10
....................          break;
111C:  GOTO   127
....................       case ID_FLASH_ERASE_ALL:
....................          break;
111D:  GOTO   127
....................       default:
....................          fprintf(PC, "\t\t-> Invalid CMD ID!\r\n");
111E:  MOVLW  D7
111F:  MOVLB  03
1120:  MOVWF  11
1121:  MOVLW  04
1122:  MOVWF  12
1123:  MOVLP  00
1124:  MOVLB  00
1125:  CALL   603
1126:  MOVLP  10
....................    }
....................    fprintf(PC, "\r\n_________End execute_mission_________\r\n____________________________________\r\n");
1127:  MOVLW  E3
1128:  MOVLB  03
1129:  MOVWF  11
112A:  MOVLW  04
112B:  MOVWF  12
112C:  MOVLP  00
112D:  MOVLB  00
112E:  CALL   603
112F:  MOVLP  10
.................... }
.................... 
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... 
.................... #include "./lib/flash_function.h"
.................... #ifndef FLASH_FUNCTION_H
.................... #define FLASH_FUNCTION_H
.................... 
.................... #include "flash.h"
.................... #ifndef FLASH_H
.................... #define FLASH_H
.................... ///////////////////////////////////////////////////////////////////////////////
.................... /////////////////////////GDNS_226_FlashOperation.h/////////////////////////////
.................... //////////////////////////////////ver 2.0//////////////////////////////////////
.................... /////////////////////////////last editor:T Kawai///////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... #define DEBUG
.................... //////////////////////////////port select//////////////////////////////////////
.................... #ifdef DEBUG
....................    #define DEBUG_PORT pc
.................... #endif
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define SPI STREAM////////////////////////////////
.................... #define FLASH_STREAM0 MIS_FM_STREAM     // <- Align the names to `config.h` Stream name
.................... #define FLASH_STREAM1 SMF_STREAM
.................... #define FLASH_STREAM2 SMF_STREAM // dont use
.................... #define FLASH_STREAM3 SMF_STREAM // dont use
.................... typedef enum spi_stream{
....................    SPI_0,
....................    SPI_1,
....................    SPI_2,
....................    SPI_3,
.................... }SpiStreamId;
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define Model name////////////////////////////////
.................... #define MT25QL128ABA 0x00     //Mission Flash
.................... #define MT25QL01GBBB 0x01     //SMF,CF
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////define structure member/////////////////////////////
.................... typedef struct select_stream_to_flash{
....................    SpiStreamId spi_stream_id;
....................    unsigned int8 flash_model;
....................    int16 cs_pin;
.................... }Flash;
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////    values    //////////////////////////////////////
.................... 
.................... Flash mis_fm = {SPI_0, MT25QL128ABA, SPI0_CS};
.................... Flash smf = {SPI_1, MT25QL01GBBB, SPI1_CS};
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////////////////CMD List///////////////////////////////////////
.................... #define CMD_READ_ID                     0x9F
.................... #define CMD_READ_STATUS_REGISTER        0x05
.................... #define CMD_READ                        0x03//for MT25QL128ABA
.................... #define CMD_4BYTE_READ                  0x13//for MT25QL01GBBB
.................... #define CMD_WRITE_ENABLE                0x06
.................... #define CMD_PAGE_PROGRAM                0x02//for MT25QL128ABA
.................... #define CMD_4BYTE_PAGE_PROGRAM          0x12//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_4KB_ERASE         0x20//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_4KB_ERASE   0x21//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_32KB_ERASE        0x52//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_32KB_ERASE  0x5C//for MT25QL01GBBB
.................... #define CMD_SECTOR_ERASE                0xD8//for MT25QL128ABA
.................... #define CMD_4BYTE_SECTOR_ERASE          0xDC//for MT25QL01GBBB
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////function List///////////////////////////////////////
.................... //higher all spi csPINs
.................... void flash_setting(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //bit[7:2]status register control bit,bit[1]write enable bit T:ennable F:disable,bit[0]write in progress bit T:busy F:ready
.................... int8 status_register(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //T:Flash id read successfully(connect OK),F:Flash id read failed
.................... int8 read_id(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //64kByte erase
.................... void sector_erase(Flash flash_stream, unsigned int32 sector_address);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //32kByte erase
.................... void subsector_32kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //4kByte erase
.................... void subsector_4kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                  
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read 1 Byte data
.................... int8 read_data_byte(Flash flash_stream, unsigned int32 read_address);                                               
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read multi Bytes data(max 128 MByte) and store to "read_data"
.................... void read_data_bytes(Flash flash_stream, unsigned int32 read_start_address, int8 *read_data, unsigned int32 read_amount);        
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write 1 Byte data to flash
.................... void write_data_byte(Flash flash_stream, unsigned int32 write_address,int8 write_data);                             
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write multi Bytes data(max256 Byte) in "write_data" to flash
.................... void write_data_bytes(Flash flash_stream, unsigned int32 write_start_address, int8 *write_data, unsigned int16 write_amount);              
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////end of GDNS_226_FlashOperation.h///////////////////////////
.................... #include "src/flash.c"
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... 
.................... #define DEVICE_ID_DATA_SIZE 20
.................... 
.................... 
.................... void flash_init();
.................... 
.................... 
.................... #include "./src/flash_function.c"
.................... #include "../flash.h"
.................... #ifndef FLASH_H
.................... #define FLASH_H
.................... ///////////////////////////////////////////////////////////////////////////////
.................... /////////////////////////GDNS_226_FlashOperation.h/////////////////////////////
.................... //////////////////////////////////ver 2.0//////////////////////////////////////
.................... /////////////////////////////last editor:T Kawai///////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... #define DEBUG
.................... //////////////////////////////port select//////////////////////////////////////
.................... #ifdef DEBUG
....................    #define DEBUG_PORT pc
.................... #endif
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define SPI STREAM////////////////////////////////
.................... #define FLASH_STREAM0 MIS_FM_STREAM     // <- Align the names to `config.h` Stream name
.................... #define FLASH_STREAM1 SMF_STREAM
.................... #define FLASH_STREAM2 SMF_STREAM // dont use
.................... #define FLASH_STREAM3 SMF_STREAM // dont use
.................... typedef enum spi_stream{
....................    SPI_0,
....................    SPI_1,
....................    SPI_2,
....................    SPI_3,
.................... }SpiStreamId;
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //////////////////////////////define Model name////////////////////////////////
.................... #define MT25QL128ABA 0x00     //Mission Flash
.................... #define MT25QL01GBBB 0x01     //SMF,CF
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////define structure member/////////////////////////////
.................... typedef struct select_stream_to_flash{
....................    SpiStreamId spi_stream_id;
....................    unsigned int8 flash_model;
....................    int16 cs_pin;
.................... }Flash;
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////    values    //////////////////////////////////////
.................... 
.................... Flash mis_fm = {SPI_0, MT25QL128ABA, SPI0_CS};
.................... Flash smf = {SPI_1, MT25QL01GBBB, SPI1_CS};
.................... 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////////////////CMD List///////////////////////////////////////
.................... #define CMD_READ_ID                     0x9F
.................... #define CMD_READ_STATUS_REGISTER        0x05
.................... #define CMD_READ                        0x03//for MT25QL128ABA
.................... #define CMD_4BYTE_READ                  0x13//for MT25QL01GBBB
.................... #define CMD_WRITE_ENABLE                0x06
.................... #define CMD_PAGE_PROGRAM                0x02//for MT25QL128ABA
.................... #define CMD_4BYTE_PAGE_PROGRAM          0x12//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_4KB_ERASE         0x20//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_4KB_ERASE   0x21//for MT25QL01GBBB
.................... #define CMD_SUBSECTOR_32KB_ERASE        0x52//for MT25QL128ABA
.................... #define CMD_4BYTE_SUBSECTOR_32KB_ERASE  0x5C//for MT25QL01GBBB
.................... #define CMD_SECTOR_ERASE                0xD8//for MT25QL128ABA
.................... #define CMD_4BYTE_SECTOR_ERASE          0xDC//for MT25QL01GBBB
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////function List///////////////////////////////////////
.................... //higher all spi csPINs
.................... void flash_setting(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //bit[7:2]status register control bit,bit[1]write enable bit T:ennable F:disable,bit[0]write in progress bit T:busy F:ready
.................... int8 status_register(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //T:Flash id read successfully(connect OK),F:Flash id read failed
.................... int8 read_id(Flash flash_stream);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //64kByte erase
.................... void sector_erase(Flash flash_stream, unsigned int32 sector_address);
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //32kByte erase
.................... void subsector_32kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                 
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //4kByte erase
.................... void subsector_4kByte_erase(Flash flash_stream, unsigned int32 subsector_address);                                  
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read 1 Byte data
.................... int8 read_data_byte(Flash flash_stream, unsigned int32 read_address);                                               
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //read multi Bytes data(max 128 MByte) and store to "read_data"
.................... void read_data_bytes(Flash flash_stream, unsigned int32 read_start_address, int8 *read_data, unsigned int32 read_amount);        
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write 1 Byte data to flash
.................... void write_data_byte(Flash flash_stream, unsigned int32 write_address,int8 write_data);                             
.................... ///////////////////////////////////////////////////////////////////////////////
.................... //write multi Bytes data(max256 Byte) in "write_data" to flash
.................... void write_data_bytes(Flash flash_stream, unsigned int32 write_start_address, int8 *write_data, unsigned int16 write_amount);              
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ///////////////////////////////////////////////////////////////////////////////
.................... ////////////////////end of GDNS_226_FlashOperation.h///////////////////////////
.................... #include "src/flash.c"
.................... 
.................... #endif
.................... //------------------End of File------------------
.................... 
.................... #include "../../src/include/mmj_cigs_config.h"
.................... #ifndef MMJ_CIGS_CONFIG_H
.................... #define MMJ_CIGS_CONFIG_H
.................... 
.................... #include <16F1789.h>
.................... 
.................... #device ADC=12
.................... #use delay(crystal=16MHz, clock=16MHz)
.................... #fuses NOMCLR
.................... 
.................... 
.................... 
.................... //#define SELF_DEVICE_ID CIGS_PIC
.................... 
.................... 
.................... //-------------Serial--------------------
.................... #use rs232(baud=9600,parity=N,xmit=PIN_C6,rcv=PIN_C7,bits=8,stream=BOSS)
.................... #use rs232(baud=9600,parity=N,xmit=PIN_B4,bits=8,stream=PC,FORCE_SW)
.................... 
.................... 
.................... #define SPI0_CS  PIN_D1
.................... #use spi(MASTER, CLK=PIN_C3, DI=PIN_C4, DO=PIN_C5, BAUD=400000, MODE=0, BITS=8, STREAM=MIS_FM_STREAM)
.................... // MISO PIN_C5, MOSI PIN_C4, SCK PIN_C3
.................... 
.................... 
.................... #define SPI1_CS PIN_C2
.................... #use spi(MASTER, SPI1, BAUD=400000, MODE=0, BITS=8, STREAM=SMF_STREAM)
.................... 
.................... 
.................... 
.................... //-------------I/O port--------------------
.................... // AI/O___ADC
.................... #define TEMP_TOP PIN_A5
.................... #define TEMP_BOT PIN_A3
.................... #define CIGS_VOLT PIN_A0 //PIN_A0
.................... #define CIGS_CURR PIN_A1
.................... #define PD PIN_E0
.................... 
.................... // AI/O___DAC
.................... #define LOAD PIN_A2
.................... 
.................... // DI/O___
.................... #define CIGS_CONNECT PIN_C0
.................... #define EN_NPWR PIN_C3  //Negative Power
.................... 
.................... 
.................... #endif // MMJ_CIGS_CONFIG_H
.................... 
.................... //------------------End of File------------------
.................... 
.................... 
.................... 
.................... 
.................... void flash_init()
.................... {
....................     //Flash mis_fm = {SPI_0, MT25QL128ABA, SPI0_CS};
....................     fprintf(PC, "Flash Initialize\r\n");
*
070E:  MOVLW  0B
070F:  MOVLB  03
0710:  MOVWF  11
0711:  MOVLW  05
0712:  MOVWF  12
0713:  MOVLB  00
0714:  CALL   603
....................     unsigned int8 chip_id[20] = {0}; // Array to store chip ID
0715:  MOVLB  10
0716:  CLRF   33
0717:  CLRF   34
0718:  CLRF   35
0719:  CLRF   36
071A:  CLRF   37
071B:  CLRF   38
071C:  CLRF   39
071D:  CLRF   3A
071E:  CLRF   3B
071F:  CLRF   3C
0720:  CLRF   3D
0721:  CLRF   3E
0722:  CLRF   3F
0723:  CLRF   40
0724:  CLRF   41
0725:  CLRF   42
0726:  CLRF   43
0727:  CLRF   44
0728:  CLRF   45
0729:  CLRF   46
....................     
....................     output_low(SPI0_CS);                                                  //lower the CS PIN
072A:  MOVLB  01
072B:  BCF    0F.1
072C:  MOVLB  02
072D:  BCF    0F.1
....................     delay_ms(10);                                                   //wait for flash to be ready
072E:  MOVLW  0A
072F:  MOVLB  10
0730:  MOVWF  4A
0731:  MOVLB  00
0732:  CALL   6C4
....................     spi_xfer(MIS_FM_STREAM,0x9E);                                           //READ ID COMAND   (0x9F)
0733:  MOVLB  04
0734:  BCF    15.5
0735:  MOVLW  40
0736:  MOVWF  14
0737:  MOVLW  09
0738:  MOVWF  12
0739:  MOVLW  2A
073A:  MOVWF  15
073B:  MOVLW  9E
073C:  MOVLB  10
073D:  MOVWF  4C
073E:  MOVLB  00
073F:  CALL   6DA
....................     fprintf(PC, "\t[MISF] <-  9F\r\n");                                            //print Chip ID
0740:  MOVLW  15
0741:  MOVLB  03
0742:  MOVWF  11
0743:  MOVLW  05
0744:  MOVWF  12
0745:  MOVLB  00
0746:  CALL   603
....................     for (unsigned int8 i = 0; i < 20; i++) {
0747:  MOVLB  10
0748:  CLRF   47
0749:  MOVF   47,W
074A:  SUBLW  13
074B:  BTFSS  03.0
074C:  GOTO   765
....................         chip_id[i] = spi_xfer(MIS_FM_STREAM,0x00);                                  //read chip ID
074D:  MOVLW  13
074E:  ADDWF  47,W
074F:  MOVWF  04
0750:  MOVLW  25
0751:  MOVWF  05
0752:  BTFSC  03.0
0753:  INCF   05,F
0754:  MOVLB  04
0755:  BCF    15.5
0756:  MOVLW  40
0757:  MOVWF  14
0758:  MOVLW  09
0759:  MOVWF  12
075A:  MOVLW  2A
075B:  MOVWF  15
075C:  MOVLB  10
075D:  CLRF   4C
075E:  MOVLB  00
075F:  CALL   6DA
0760:  MOVF   77,W
0761:  MOVWF  00
0762:  MOVLB  10
0763:  INCF   47,F
0764:  GOTO   749
....................         
....................     }
....................     for (unsigned int8 i = 0; i < 20; i++) {
0765:  CLRF   48
0766:  MOVF   48,W
0767:  SUBLW  13
0768:  BTFSS  03.0
0769:  GOTO   780
....................         fprintf(PC, "%X ", chip_id[i]);                                         //print chip ID
076A:  MOVLW  13
076B:  ADDWF  48,W
076C:  MOVWF  04
076D:  MOVLW  25
076E:  MOVWF  05
076F:  BTFSC  03.0
0770:  INCF   05,F
0771:  MOVF   00,W
0772:  MOVWF  4A
0773:  MOVWF  6C
0774:  MOVLW  37
0775:  MOVWF  6D
0776:  MOVLB  00
0777:  CALL   6E7
0778:  MOVLW  20
0779:  MOVLB  11
077A:  MOVWF  20
077B:  MOVLB  00
077C:  CALL   5DE
077D:  MOVLB  10
077E:  INCF   48,F
077F:  GOTO   766
....................     }
.................... 
....................     output_high(SPI0_CS);                                                 //take CS PIN higher back       
0780:  MOVLB  01
0781:  BCF    0F.1
0782:  MOVLB  02
0783:  BSF    0F.1
.................... 
....................     fprintf(PC, "\tComplete\r\n");
0784:  MOVLW  1E
0785:  MOVLB  03
0786:  MOVWF  11
0787:  MOVLW  05
0788:  MOVWF  12
0789:  MOVLB  00
078A:  CALL   603
078B:  MOVLP  10
078C:  GOTO   44C (RETURN)
.................... }
.................... 
.................... 
.................... #endif // FLASH_FUNCTION_H
.................... //------------------End of File------------------
.................... 
.................... 
.................... #endif // MMJ_CIGS_MAIN_H
.................... //------------------End of File------------------
.................... 
.................... 
.................... void main()
*
1397:  MOVLB  03
1398:  BSF    1F.3
1399:  MOVLW  A0
139A:  MOVWF  1B
139B:  MOVLW  01
139C:  MOVWF  1C
139D:  MOVLW  A6
139E:  MOVWF  1E
139F:  MOVLW  90
13A0:  MOVWF  1D
13A1:  MOVLB  01
13A2:  BCF    0D.4
13A3:  MOVLB  02
13A4:  BSF    0D.4
13A5:  MOVLB  04
13A6:  BCF    15.5
13A7:  MOVLW  40
13A8:  MOVWF  14
13A9:  MOVLW  09
13AA:  MOVWF  12
13AB:  MOVLW  2A
13AC:  MOVWF  15
13AD:  MOVLB  02
13AE:  BCF    1D.5
13AF:  BCF    1D.3
13B0:  BCF    1D.4
13B1:  MOVLB  01
13B2:  BCF    0E.5
13B3:  BSF    0E.4
13B4:  BCF    0E.3
13B5:  MOVLB  00
13B6:  CLRF   29
13B7:  CLRF   28
13B8:  BCF    2A.0
13B9:  MOVLW  03
13BA:  MOVWF  2B
13BB:  CLRF   2F
13BC:  CLRF   2E
13BD:  CLRF   2D
13BE:  CLRF   2C
13BF:  CLRF   33
13C0:  CLRF   32
13C1:  CLRF   31
13C2:  CLRF   30
13C3:  CLRF   35
13C4:  CLRF   34
13C5:  CLRF   37
13C6:  CLRF   36
13C7:  CLRF   58
13C8:  MOVLB  0C
13C9:  CLRF   2C
13CA:  CLRF   2B
13CB:  CLRF   2A
13CC:  CLRF   29
13CD:  CLRF   2E
13CE:  CLRF   2D
13CF:  CLRF   30
13D0:  CLRF   2F
13D1:  CLRF   32
13D2:  CLRF   31
13D3:  CLRF   34
13D4:  CLRF   33
13D5:  MOVLB  03
13D6:  CLRF   0C
13D7:  CLRF   0D
13D8:  CLRF   0E
13D9:  CLRF   0F
13DA:  CLRF   10
13DB:  MOVLB  02
13DC:  CLRF   12
13DD:  CLRF   11
13DE:  GOTO   409
13DF:  DATA 20,34
13E0:  DATA 60,34
13E1:  DATA 18,34
13E2:  DATA 00,34
13E3:  DATA FF,34
13E4:  DATA 60,34
13E5:  DATA 39,34
13E6:  DATA 00,34
13E7:  DATA FF,34
13E8:  DATA C0,34
13E9:  DATA 00,34
13EA:  DATA FF,34
13EB:  DATA C0,34
13EC:  DATA 00,34
13ED:  DATA 93,34
13EE:  DATA C0,34
13EF:  DATA 00,34
13F0:  DATA FF,34
13F1:  DATA 63,34
13F2:  DATA D5,34
13F3:  DATA 00,34
13F4:  DATA 05,34
13F5:  DATA C0,34
13F6:  DATA 00,34
13F7:  DATA 0C,34
13F8:  DATA 80,34
13F9:  DATA 79,34
13FA:  DATA 00,34
13FB:  DATA 01,34
13FC:  DATA 01,34
13FD:  DATA 72,34
13FE:  DATA 00,34
13FF:  DATA 00,34
1400:  DATA 09,34
1401:  DATA 01,34
1402:  DATA 00,34
1403:  DATA 02,34
1404:  DATA 01,34
1405:  DATA 09,34
1406:  DATA C0,34
1407:  DATA 00,34
1408:  DATA 00,34
1409:  MOVLW  13
140A:  MOVWF  05
140B:  MOVLW  DF
140C:  MOVWF  04
140D:  BSF    05.7
140E:  MOVIW  [FSR0++],W
140F:  MOVWF  77
1410:  XORLW  00
1411:  BTFSC  03.2
1412:  GOTO   423
1413:  MOVIW  [FSR0++],W
1414:  MOVWF  78
1415:  BTFSC  78.7
1416:  GOTO   41B
1417:  ANDLW  3F
1418:  MOVWF  07
1419:  MOVIW  [FSR0++],W
141A:  MOVWF  06
141B:  BTFSC  78.6
141C:  MOVIW  [FSR0++],W
141D:  BTFSS  78.6
141E:  MOVIW  [FSR0++],W
141F:  MOVWI  W,[FSR1++]
1420:  DECFSZ 77,F
1421:  GOTO   41D
1422:  GOTO   40E
.................... { 
....................    fprintf(PC,"\r\n============================================================\r\n");
1423:  MOVLW  24
1424:  MOVLB  03
1425:  MOVWF  11
1426:  MOVLW  05
1427:  MOVWF  12
1428:  MOVLP  00
1429:  MOVLB  00
142A:  CALL   603
142B:  MOVLP  10
....................    fprintf(PC,"This is MOMIJI CIGS PIC BBM for MIS7_BBM1.\r\n");
142C:  MOVLW  45
142D:  MOVLB  03
142E:  MOVWF  11
142F:  MOVLW  05
1430:  MOVWF  12
1431:  MOVLP  00
1432:  MOVLB  00
1433:  CALL   603
1434:  MOVLP  10
....................    fprintf(PC,"Last updated on 2025/04/25, by Inoue.\r\n\r\n");  
1435:  MOVLW  5C
1436:  MOVLB  03
1437:  MOVWF  11
1438:  MOVLW  05
1439:  MOVWF  12
143A:  MOVLP  00
143B:  MOVLB  00
143C:  CALL   603
143D:  MOVLP  10
.................... 
....................    
....................    io_init();
143E:  MOVLP  00
143F:  GOTO   653
1440:  MOVLP  10
....................    adc_init();
1441:  MOVLP  00
1442:  GOTO   66B
1443:  MOVLP  10
....................    uart_init();
1444:  MOVLP  00
1445:  GOTO   693
1446:  MOVLP  10
....................    timer_init();
1447:  MOVLP  00
1448:  GOTO   6A7
1449:  MOVLP  10
....................    flash_init();
144A:  MOVLP  00
144B:  GOTO   70E
144C:  MOVLP  10
.................... 
.................... 
....................    int1 is_finished = FALSE;
144D:  MOVLB  0F
144E:  BCF    5E.0
....................    fprintf(PC,"____CIGS PIC Start Operation_____\r\n\r\n");
144F:  MOVLW  71
1450:  MOVLB  03
1451:  MOVWF  11
1452:  MOVLW  05
1453:  MOVWF  12
1454:  MOVLP  00
1455:  MOVLB  00
1456:  CALL   603
1457:  MOVLP  10
....................    fprintf(PC,"waiting for BOSS PIC command");
1458:  MOVLW  84
1459:  MOVLB  03
145A:  MOVWF  11
145B:  MOVLW  05
145C:  MOVWF  12
145D:  MOVLP  00
145E:  MOVLB  00
145F:  CALL   603
1460:  MOVLP  10
....................    
....................    //Start loop
....................    while(!is_finished)
1461:  MOVLB  0F
1462:  BTFSC  5E.0
1463:  GOTO   55C
....................    {
....................       // handle from boss commands
....................       if(boss_receive_buffer_size > 0)
1464:  MOVLB  00
1465:  MOVF   58,F
1466:  BTFSC  03.2
1467:  GOTO   526
....................       {
....................          volatile Command command = make_receive_command(boss_receive_buffer, boss_receive_buffer_size);
1468:  MOVLW  20
1469:  MOVLB  10
146A:  MOVWF  3A
146B:  MOVLW  18
146C:  MOVWF  39
146D:  MOVLB  00
146E:  MOVF   58,W
146F:  MOVLB  10
1470:  MOVWF  3B
1471:  MOVLP  08
1472:  MOVLB  00
1473:  GOTO   020
1474:  MOVLP  10
1475:  MOVF   79,W
1476:  MOVWF  7A
1477:  MOVF   78,W
1478:  MOVWF  04
1479:  MOVF   7A,W
147A:  MOVWF  05
147B:  MOVLW  23
147C:  MOVWF  78
147D:  MOVLW  24
147E:  MOVWF  07
147F:  MOVLW  EF
1480:  MOVWF  06
1481:  MOVIW  [FSR0++],W
1482:  MOVWI  W,[FSR1++]
1483:  DECFSZ 78,F
1484:  GOTO   481
....................          
....................          fprintf(PC, "FrameID: %1X\r\n", command.frame_id);
1485:  MOVLW  93
1486:  MOVLB  03
1487:  MOVWF  11
1488:  MOVLW  05
1489:  MOVWF  12
148A:  BCF    03.0
148B:  MOVLW  09
148C:  MOVLB  10
148D:  MOVWF  6C
148E:  MOVLP  00
148F:  MOVLB  00
1490:  CALL   78D
1491:  MOVLP  10
1492:  MOVLB  0F
1493:  MOVF   5F,W
1494:  MOVLB  10
1495:  MOVWF  6C
1496:  MOVLW  B7
1497:  MOVWF  6D
1498:  MOVLP  00
1499:  MOVLB  00
149A:  CALL   6E7
149B:  MOVLP  10
149C:  MOVLW  0D
149D:  MOVLB  11
149E:  MOVWF  20
149F:  MOVLP  00
14A0:  MOVLB  00
14A1:  CALL   5DE
14A2:  MOVLP  10
14A3:  MOVLW  0A
14A4:  MOVLB  11
14A5:  MOVWF  20
14A6:  MOVLP  00
14A7:  MOVLB  00
14A8:  CALL   5DE
14A9:  MOVLP  10
....................          fprintf(PC, "payload size: %d\r\n", command.size);
14AA:  MOVLW  9B
14AB:  MOVLB  03
14AC:  MOVWF  11
14AD:  MOVLW  05
14AE:  MOVWF  12
14AF:  BCF    03.0
14B0:  MOVLW  0E
14B1:  MOVLB  10
14B2:  MOVWF  6C
14B3:  MOVLP  00
14B4:  MOVLB  00
14B5:  CALL   78D
14B6:  MOVLP  10
14B7:  MOVLB  10
14B8:  MOVF   30,W
14B9:  MOVWF  3F
14BA:  MOVLW  18
14BB:  MOVWF  40
14BC:  MOVLP  08
14BD:  MOVLB  00
14BE:  CALL   256
14BF:  MOVLP  10
14C0:  MOVLW  0D
14C1:  MOVLB  11
14C2:  MOVWF  20
14C3:  MOVLP  00
14C4:  MOVLB  00
14C5:  CALL   5DE
14C6:  MOVLP  10
14C7:  MOVLW  0A
14C8:  MOVLB  11
14C9:  MOVWF  20
14CA:  MOVLP  00
14CB:  MOVLB  00
14CC:  CALL   5DE
14CD:  MOVLP  10
....................          fprintf(PC, "payload: ");
14CE:  MOVLW  A5
14CF:  MOVLB  03
14D0:  MOVWF  11
14D1:  MOVLW  05
14D2:  MOVWF  12
14D3:  MOVLP  00
14D4:  MOVLB  00
14D5:  CALL   603
14D6:  MOVLP  10
....................          for(int8 i = 0; i < command.size; i++)
14D7:  MOVLB  10
14D8:  CLRF   32
14D9:  MOVF   30,W
14DA:  SUBWF  32,W
14DB:  BTFSC  03.0
14DC:  GOTO   4F7
....................             fprintf(PC, "%X ", command.content[i]);
14DD:  MOVLW  F0
14DE:  ADDWF  32,W
14DF:  MOVWF  04
14E0:  MOVLW  24
14E1:  MOVWF  05
14E2:  BTFSC  03.0
14E3:  INCF   05,F
14E4:  MOVF   00,W
14E5:  MOVWF  33
14E6:  MOVWF  6C
14E7:  MOVLW  37
14E8:  MOVWF  6D
14E9:  MOVLP  00
14EA:  MOVLB  00
14EB:  CALL   6E7
14EC:  MOVLP  10
14ED:  MOVLW  20
14EE:  MOVLB  11
14EF:  MOVWF  20
14F0:  MOVLP  00
14F1:  MOVLB  00
14F2:  CALL   5DE
14F3:  MOVLP  10
14F4:  MOVLB  10
14F5:  INCF   32,F
14F6:  GOTO   4D9
....................          fprintf(PC, "\r\n\r\n");
14F7:  MOVLW  AA
14F8:  MOVLB  03
14F9:  MOVWF  11
14FA:  MOVLW  05
14FB:  MOVWF  12
14FC:  MOVLP  00
14FD:  MOVLB  00
14FE:  CALL   603
14FF:  MOVLP  10
....................          
....................          clear_receive_signal(boss_receive_buffer, &boss_receive_buffer_size);
1500:  MOVLW  20
1501:  MOVLB  10
1502:  MOVWF  34
1503:  MOVLW  18
1504:  MOVWF  33
1505:  MOVLW  20
1506:  MOVWF  36
1507:  MOVLW  38
1508:  MOVWF  35
1509:  MOVLP  08
150A:  MOVLB  00
150B:  GOTO   2C9
150C:  MOVLP  10
....................             
....................          if(command.is_exist)
150D:  MOVLB  10
150E:  BTFSS  31.0
150F:  GOTO   51C
....................             is_finished = execute_command(&command);
1510:  MOVLW  24
1511:  MOVWF  34
1512:  MOVLW  EF
1513:  MOVWF  33
1514:  MOVLB  00
1515:  GOTO   000
1516:  MOVLB  0F
1517:  BCF    5E.0
1518:  BTFSC  78.0
1519:  BSF    5E.0
151A:  GOTO   527
151B:  MOVLB  10
....................          else
....................          {
....................             fprintf(PC, "\t-> Invalid command\r\n");
151C:  MOVLW  AD
151D:  MOVLB  03
151E:  MOVWF  11
151F:  MOVLW  05
1520:  MOVWF  12
1521:  MOVLP  00
1522:  MOVLB  00
1523:  CALL   603
1524:  MOVLP  10
....................             continue;
1525:  GOTO   461
1526:  MOVLB  0F
....................          }
....................       }   // check if the command is valid
....................       
....................       // check mis mcu duration seconds (used in mission.c \ void continue_mis_mcu(int16 duration_sec))
....................       if (status == IDLE)
1527:  MOVLB  00
1528:  MOVF   2B,W
1529:  SUBLW  03
152A:  BTFSS  03.2
152B:  GOTO   544
....................          if (duration_sec < sec && is_empty_smf_data())
152C:  MOVF   33,F
152D:  BTFSS  03.2
152E:  GOTO   53C
152F:  MOVF   32,F
1530:  BTFSS  03.2
1531:  GOTO   53C
1532:  MOVF   29,W
1533:  SUBWF  31,W
1534:  BTFSS  03.0
1535:  GOTO   544
1536:  BTFSS  03.2
1537:  GOTO   53C
1538:  MOVF   30,W
1539:  SUBWF  28,W
153A:  BTFSC  03.0
153B:  GOTO   544
153C:  MOVLP  08
153D:  CALL   668
153E:  MOVLP  10
153F:  MOVF   78,F
1540:  BTFSC  03.2
1541:  GOTO   544
....................             status = FINISHED;
1542:  MOVLW  06
1543:  MOVWF  2B
....................       
....................       // check `is break while loop`
....................       if(is_finished == TRUE)
1544:  MOVLB  0F
1545:  BTFSC  5E.0
....................          break;
1546:  GOTO   55C
....................          
....................       delay_ms(400);
1547:  MOVLW  02
1548:  MOVLB  10
1549:  MOVWF  33
154A:  MOVLW  C8
154B:  MOVWF  4A
154C:  MOVLP  00
154D:  MOVLB  00
154E:  CALL   6C4
154F:  MOVLP  10
1550:  MOVLB  10
1551:  DECFSZ 33,F
1552:  GOTO   54A
....................       fprintf(PC,".");
1553:  MOVLW  2E
1554:  MOVLB  11
1555:  MOVWF  20
1556:  MOVLP  00
1557:  MOVLB  00
1558:  CALL   5DE
1559:  MOVLP  10
155A:  GOTO   461
155B:  MOVLB  0F
....................    }
....................    
....................    
....................    fprintf(PC, "\r\n\r\n======\r\n\r\nFinished process.\r\nWait for BOSS PIC turn off me");
155C:  MOVLW  B8
155D:  MOVLB  03
155E:  MOVWF  11
155F:  MOVLW  05
1560:  MOVWF  12
1561:  MOVLP  00
1562:  MOVLB  00
1563:  CALL   603
1564:  MOVLP  10
....................    
....................    while (TRUE)
....................    {
....................       fprintf(PC, ".");
1565:  MOVLW  2E
1566:  MOVLB  11
1567:  MOVWF  20
1568:  MOVLP  00
1569:  MOVLB  00
156A:  CALL   5DE
156B:  MOVLP  10
....................       delay_ms(1000);
156C:  MOVLW  04
156D:  MOVLB  10
156E:  MOVWF  33
156F:  MOVLW  FA
1570:  MOVWF  4A
1571:  MOVLP  00
1572:  MOVLB  00
1573:  CALL   6C4
1574:  MOVLP  10
1575:  MOVLB  10
1576:  DECFSZ 33,F
1577:  GOTO   56F
1578:  MOVLB  00
1579:  GOTO   565
....................    }
....................    
....................    fprintf(PC, "End main\r\n");
157A:  MOVLW  D8
157B:  MOVLB  03
157C:  MOVWF  11
157D:  MOVLW  05
157E:  MOVWF  12
157F:  MOVLP  00
1580:  MOVLB  00
1581:  CALL   603
1582:  MOVLP  10
....................    
.................... }
.................... 
1583:  SLEEP
.................... //

Configuration Fuses:
   Word  1: 3F82   HS NOWDT PUT NOMCLR NOPROTECT NOCPD BROWNOUT NOCLKOUT IESO FCMEN
   Word  2: 1EFF   NOWRT NOVCAP PLL_SW STVREN BORV19 NOLPBOR NODEBUG NOLVP
